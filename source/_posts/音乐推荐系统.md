---
title: 音乐推荐系统
tags: [推荐系统, Docker, Nginx]
category:
  - [技术总结]
mathjax: true
toc: true
date: 2025-01-12 23:49:27
---
~~[演示传送门](http)~~

毕设项目，因为中间要写各种各样的文档、论文改稿，导致慢慢悠悠敲了小两个月才完成。不过这也是我第一次没跟任何视频，独立实现的基于前后端分离的项目，技术栈当然是Vue SpringBoot SpringSecurity 
<!--more-->
感觉还是独立完成一个项目最能得到锻炼，因为项目推进过程中遇到的问题简直不胜枚举，有的即便平常有过了解，但见到时却仍然手足无措；有的就是“全新gang觉”。

那么是不是平时学的“完备”一点，做项目时就能“轻松”一些嘞？目前我的观点是：平时学框架，项目补细节。本质还是实践出真知，虽然课程或者博客中介绍的内容确实全面，但光看并不会提升什么（SpringSecurity过滤器链配置、拦截器、Nginx代理我看完根本不会用）。因此，还得通过痛苦的实践来加深记忆和理解，亲力解决问题必然会收获颇丰。

最令人抓狂的还是写前端页面，在项目开始前我先去b站刷了14个小时的Vue3快速入门，然后配合element-plus 的各种封装控件完善项目。但上手第三方封装库的代价就是需要不断读文档，不断试错，而且有时容易舍本逐末：因为封装控件不可控，选择原生控件配合CSS往往更佳。最后虽然没有用到Vue3 组合式的精髓，但至少达到了“会用”的水平。

开发过程冗长无味，下面着重介绍优化和部署时的重点坑点。

### 图片加载优化

音乐推荐系统的后端存了每首歌曲的音频文件和封面图，占用了不少磁盘空间。原先的方式是前端发请求，后端返回Blob格式的数据，前端解析并存入Pinia 复用。

部署后发现图片加载速度太慢，于是用GitHub搭了个图床，配合jsDelivr 做CDN优化，加载耗时显著降低，而且后端也不需要存图片了，一举两得。

### 项目部署

老早就听过Docker 的大名，这次正好拿来练练。

项目部署需要用到MySQL 、Redis 、Nginx 、JDK17 等支持，下载到服务器之后还需要各种配置，难以管理。而使用Docker 可以将它们作为一个个容器来进行部署和管理，容器之间相互隔离，无须配置便可直接运行，大大降低运维成本。

在Ubuntu上部署音乐推荐系统的步骤，大致为：

安装Docker

拉取镜像、组网配置

构建后端镜像

后端部署

前端部署

组网配置是为了让项目用到的几个容器之间可以相互通信，因此要将它们配置到同一网桥上。

构建后端镜像需要编写Dockerfile ,内容也很简单。

镜像部署一定要配置挂载路径，可在DockerHub上查看相关镜像文档来确定容器内部路径。如MySQL 镜像中的初始化文件存放路径/docker-entrypoint-initdb.d；Nginx 镜像中前端文件存放路径/usr/share/nginx/html……

Nginx部署需要编写配置文件，用于代理打包好的前端项目；而在开发环境中，IDE直接将项目运行在Node.js 环境中，无须Nginx 。配置文件的关键部分如下：

```nginx
server {
        # 监听5173端口（Vue项目的运行端口）
        listen      5173;
        location / {
            root   /usr/share/nginx/html/music_frontend；
            # 按需检索文件是否存在
            # 不添加这一项，刷新页面后报404
            try_files $uri $uri/ /index.html;
        }
        # 请求转发
        # musicrs为后端容器名，这里代表地址
        location /api {
            proxy_pass http://musicrs:8080;
        }
    }
```

### Other

已经上传GitHub ，未来应该会加入Elasticsearch 用于歌曲搜索
