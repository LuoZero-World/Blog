<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åˆ†å¸ƒå¼é”ï¼šä¸»åŠ¨è½®è¯¢å‹vsç›‘å¬å›è°ƒå‹</title>
      <link href="/Blog/2025/05/15/fen-bu-shi-suo-zhu-dong-lun-xun-xing-vs-jian-ting-xing/"/>
      <url>/Blog/2025/05/15/fen-bu-shi-suo-zhu-dong-lun-xun-xing-vs-jian-ting-xing/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡å°†ä»‹ç»åˆ†å¸ƒå¼é”çš„ä¸¤ç§æ¨¡å‹ï¼Œå…±åˆ†ä¸‰ä¸ªç« èŠ‚ï¼Œç¬¬ä¸€ç« èŠ‚è®²è®²å¦‚ä½•é€šè¿‡<code>redis</code>å®ç°ä¸»åŠ¨è½®è¯¢å‹åˆ†å¸ƒå¼é”ï¼›ç¬¬äºŒç« èŠ‚ç®€è¦è¯´ä¸‹<code>etcd</code>ä¸­å¦‚ä½•å®ç°ç›‘å¬å›è°ƒå‹é”ï¼Œç¬¬ä¸‰ç« èŠ‚å±•ç¤ºä¸¤ç§æ¨¡å‹åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½æ¯”å¯¹ä¸èµ„æºæ¶ˆè€—æƒ…å†µã€‚</p><span id="more"></span><p>å¹¶å‘åœºæ™¯ä¸­ï¼Œâ€œé”â€ç”¨äºå¯¹ä¸´ç•Œèµ„æºè¿›è¡Œä¿æŠ¤ï¼Œè®©æ··ä¹±çš„å¹¶å‘è®¿é—®è¡Œä¸ºåœ¨ä¸´ç•ŒåŒºå˜ä¸ºç§©åºçš„ä¸²è¡Œè®¿é—®è¡Œä¸ºã€‚åœ¨æœ¬åœ°åœºæ™¯ä¸‹ï¼Œç”±äºè¿›ç¨‹å†…çº¿ç¨‹å¯ä»¥å…±äº«è¿›ç¨‹æ•°æ®ï¼Œäº’æ–¥é”çš„å®ç°è¾ƒä¸ºç®€å•ï¼›è€Œåˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è·¨åŸŸå¯¹å¤šä¸ªç‰©ç†èŠ‚ç‚¹æ‰§è¡ŒåŠ é”æ“ä½œï¼Œæ•…è€Œéœ€è¦ä¾èµ–åƒ<code>redis</code>ã€<code>mysql</code>ç­‰çŠ¶æ€å­˜å‚¨ç»„ä»¶ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå®ç°â€œåˆ†å¸ƒå¼é”â€ã€‚</p><h2 id="ä¸»åŠ¨è½®è¯¢å‹"><a href="#ä¸»åŠ¨è½®è¯¢å‹" class="headerlink" title="ä¸»åŠ¨è½®è¯¢å‹"></a>ä¸»åŠ¨è½®è¯¢å‹</h2><p>æœ¬èŠ‚åŸºäº<a href="https://github.com/redis/go-redis">go-redis</a>ï¼Œå®ç°äº†å•ç‚¹æ¨¡å¼ä¸‹ä¸»åŠ¨è½®è¯¢æ¨¡å‹çš„åˆ†å¸ƒå¼é”ï¼ŒåŒæ—¶é¢å¤–å®ç°äº†â€œçº¢é”â€çš„åŸºæœ¬åŠŸèƒ½ï¼Œä»£ç å·²æ”¾å…¥ç¬”è€…<a href="https://github.com/LuoZero-World/distributed-lock">Githubä»“åº“</a>ã€‚ç”±äºä¸ªäººæ°´å¹³æœ‰é™ï¼Œå¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ•¬è¯·è°…è§£ï¼Œå¹¶æ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ğŸ˜Š</p><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><ol><li><p><strong>åˆ›å»ºåˆ†å¸ƒå¼é”</strong><br>ç›¸æ¯”äºåˆ›å»ºé”ï¼Œè¯¥æ“ä½œæ›´ç±»ä¼¼äºâ€œåˆ›å»ºä¸é”çš„è¿æ¥â€ï¼Œä¸ºç®€åŒ–æ“ä½œå«æ³•ï¼Œä¸‹è¿°ä¸€å¾‹ä½¿ç”¨â€œåˆ›å»ºåˆ†å¸ƒå¼é”â€ã€‚ä»£ç ä¸­ï¼Œç»“æ„ä½“<code>RedisLock</code>ä¸­å‡†å¤‡äº†å°†å­˜å‚¨äº<code>Redis</code>ä¸­çš„KVå¯¹ï¼Œå…¶ä¸­keyå­—æ®µç”¨äºå”¯ä¸€æ ‡è¯†ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œè€Œvalueå­—æ®µç”¨äºæ ‡è¯†åŠ é”çš„ä¸»ä½“æ–¹èº«ä»½ï¼Œå…·ä½“ä½¿ç”¨[ä¸»æœºIP+è¿›ç¨‹ID+ Goåç¨‹ ID]å®ç°â€œèº«ä»½ç»‘å®šâ€</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RedisLock <span class="keyword">struct</span> &#123;</span><br><span class="line">    LockOptions</span><br><span class="line">    key    <span class="type">string</span></span><br><span class="line">    token  <span class="type">string</span> <span class="comment">// è¡¨ç¤ºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹[ä¸»æœº_è¿›ç¨‹_åç¨‹]æƒ³è¦è·å¾—æ­¤é”</span></span><br><span class="line">    client *redis.Client</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çœ‹é—¨ç‹—è¿è¡Œæ ‡è¯† 0æœªè¿è¡Œ 1æ­£åœ¨è¿è¡Œ</span></span><br><span class="line">    runningWatchDog <span class="type">int32</span></span><br><span class="line">    <span class="comment">//åœæ­¢çœ‹é—¨ç‹—</span></span><br><span class="line">    stopWatchDog context.CancelFunc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRedisLock</span><span class="params">(key <span class="type">string</span>, client *redis.Client, opts ...LockOption)</span></span> *RedisLock &#123;</span><br><span class="line">    rLock := RedisLock&#123;</span><br><span class="line">    key:    REDIS_LOCK_KEY_PREFIX + key,</span><br><span class="line">    token:  utils.GenerateID(),</span><br><span class="line">    client: client,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> _, opt := <span class="keyword">range</span> opts &#123;</span><br><span class="line">    opt(&amp;rLock.LockOptions)</span><br><span class="line">    &#125;</span><br><span class="line">    repairLock(&amp;rLock.LockOptions)</span><br><span class="line">    <span class="keyword">return</span> &amp;rLock</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åŠ é”</strong><br>åŠ é”æ“ä½œåˆ†ä¸ºé˜»å¡å’Œéé˜»å¡æ¨¡å¼ï¼Œå¯ä»¥åœ¨åˆ›å»ºåˆ†å¸ƒå¼é”æ—¶è¿›è¡Œé…ç½®ã€‚éé˜»å¡æ¨¡å¼ä¸‹ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡åŠ é”å°è¯•ï¼ˆ<strong>SETNXæ“ä½œä¿è¯åŸå­æ€§ï¼Œä¸å¯é‡å…¥</strong>ï¼‰ï¼Œå€˜è‹¥å¤±è´¥ï¼Œå°±ç›´æ¥è¿”å›é”™è¯¯ï¼›é˜»å¡æ¨¡å¼ä¸‹ï¼Œä¼šé€šè¿‡è®¡æ—¶å™¨ï¼Œæ¯éš”50 msæ‰§è¡Œä¸€æ¬¡åŠ é”å°è¯•ï¼Œå¦‚æœæŸæ¬¡è¯·æ±‚åŠ é”æˆåŠŸåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™è¾¾åˆ°ç­‰é”è¶…æ—¶é˜ˆå€¼æˆ–è€…ä¸­é€”å‘ç”Ÿäº†é¢„æœŸä¹‹å¤–çš„é”™è¯¯æ—¶ç»ˆæ­¢æµç¨‹ã€‚</p></li><li><p><strong>è§£é”</strong><br>è§£é”æ“ä½œåŸºäºLuaè„šæœ¬æ‰§è¡Œï¼Œä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚è„šæœ¬æ‰§è¡Œæ—¶é¦–å…ˆæ ¡éªŒå½“å‰æ“ä½œè€…æ˜¯å¦æ‹¥æœ‰é”çš„æ‰€æœ‰æƒï¼Œæ˜¯åˆ™è§£é”ï¼Œå¦åˆ™è¿”å›é”™è¯¯</p></li></ol><h3 id="æŠ€æœ¯éš¾ç‚¹"><a href="#æŠ€æœ¯éš¾ç‚¹" class="headerlink" title="æŠ€æœ¯éš¾ç‚¹"></a>æŠ€æœ¯éš¾ç‚¹</h3><ol><li><p><strong>æ­»é”é—®é¢˜</strong><br>å®¢æˆ·ç«¯åŠ é”åå› è¿›ç¨‹å´©æºƒã€ç½‘ç»œå»¶è¿Ÿç­‰é—®é¢˜æ— æ³•æ­£å¸¸é‡Šæ”¾é”ï¼Œå¯¼è‡´é”æ°¸ä¹…ä¸å¯ç”¨ã€‚å¯ä»¥åœ¨<code>Redis</code>ä¸­ä¸ºæ¯ä¸€æ¡é”è®°å½•è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ŒåŠ é”åè¶…è¿‡è¿™ä¸ªæ—¶é—´é”ä¾¿ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä½†æ˜¯å½“ä¸šåŠ¡å®é™…å¤„ç†æ—¶é—´è¶…è¿‡è¶…æ—¶æ—¶é—´æ—¶ï¼Œä¸šåŠ¡å¤„ç†æ–¹çš„é”ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚<br>åœ¨<code>Redisson</code>ä¸­çš„è§£å†³æ–¹æ¡ˆæ˜¯â€œ<strong>çœ‹é—¨ç‹—ç­–ç•¥</strong>â€ï¼Œåœ¨é”çš„æŒæœ‰æ–¹æ‰§è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†çš„è¿‡ç¨‹ä¸­æ—¶ï¼Œéœ€è¦å¼‚æ­¥å¯åŠ¨ä¸€ä¸ªçœ‹é—¨ç‹—å®ˆæŠ¤åç¨‹ï¼ŒæŒç»­ä¸ºåˆ†å¸ƒå¼é”çš„è¿‡æœŸé˜ˆå€¼è¿›è¡Œå»¶æœŸæ“ä½œã€‚</p></li><li><p><strong>å¼±ä¸€è‡´æ€§é—®é¢˜</strong><br>é¿å…å•ç‚¹æ•…éšœå¼•èµ·æ•°æ®ä¸¢å¤±é—®é¢˜ï¼Œ<code>Redis</code>ä¼šåŸºäºä¸»ä»å¤åˆ¶çš„æ–¹å¼å®ç°æ•°æ®å¤‡ä»½å¢åŠ æœåŠ¡çš„å®¹é”™æ€§ã€‚ä¸ºäº†ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§å’Œååé‡ï¼Œ<code>Redis</code>åœ¨è¿›è¡Œæ•°æ®çš„ä¸»ä»åŒæ­¥æ—¶ï¼Œé‡‡ç”¨çš„æ˜¯å¼‚æ­¥æ‰§è¡Œæœºåˆ¶ã€‚è¿™ç§å¼±ä¸€è‡´æ€§åŒæ­¥å°±ä¼šå¯¼è‡´ï¼Œå½“ä½¿ç”¨æ–¹Aåœ¨ä¸»èŠ‚ç‚¹åŠ é”æˆåŠŸåï¼Œä¸»èŠ‚ç‚¹çªç„¶å®•æœºï¼Œæ•°æ®è¿˜æœªåŒæ­¥è‡³ä»èŠ‚ç‚¹ï¼Œè€Œåä»èŠ‚ç‚¹å‡çº§ä¸ºä¸»èŠ‚ç‚¹é€ æˆé”è®°å½•ä¸¢å¤±ã€‚<br>åœ¨<code>Redisson</code>ä¸­çš„è§£å†³æ–¹æ¡ˆæ˜¯â€œ<strong>çº¢é”</strong>â€ï¼Œè¿™æ˜¯ä¸€ç§åŸºäºå¤š<code>Redis</code>èŠ‚ç‚¹çš„åˆ†å¸ƒå¼é”å¢å¼ºæ–¹æ¡ˆï¼Œé€šè¿‡å‘è‡³å°‘5ä¸ªç‹¬ç«‹èŠ‚ç‚¹å‘èµ·åŠ é”è¯·æ±‚å¹¶éœ€è·å¾—åŠæ•°ä»¥ä¸ŠæˆåŠŸå“åº”æ¥ç¡®ä¿é”çš„äº’æ–¥æ€§ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯<strong>é€šè¿‡å¤šæ•°æ´¾æŠ•ç¥¨æœºåˆ¶è§„é¿å•èŠ‚ç‚¹æ•…éšœé£é™©</strong>ã€‚è¯¥æ–¹æ¡ˆç½‘ç»œå¼€é”€è¾ƒå¤§ä¸”å®ç°å¤æ‚ï¼Œå› æ­¤åœ¨å¤šæ•°æƒ…å†µä¸‹å·²è¢«å…¶ä»–æ›¿ä»£æ–¹æ¡ˆå–ä»£ã€‚</p></li></ol><h2 id="ç›‘å¬å›è°ƒå‹"><a href="#ç›‘å¬å›è°ƒå‹" class="headerlink" title="ç›‘å¬å›è°ƒå‹"></a>ç›‘å¬å›è°ƒå‹</h2><p>ç›‘å¬å›è°ƒå‹é”åœ¨å–é”å¤±è´¥æ—¶ï¼Œå¹¶ä¸ä¼šåƒä¸»åŠ¨è½®è¯¢å‹é”æŒç»­è¯·æ±‚é”ï¼Œè€Œæ˜¯ä¼šç›‘å¬é”çš„åˆ é™¤äº‹ä»¶ï¼šå½“åˆ é™¤äº‹ä»¶å‘ç”Ÿè¯´æ˜é”è¢«é‡Šæ”¾äº†ï¼Œæ­¤æ—¶æ‰ç»§ç»­å°è¯•å–é”ã€‚<br>æœ¬èŠ‚å°†é‡ç‚¹åˆ†æç›‘å¬å›è°ƒå‹åˆ†å¸ƒå¼é”çš„ä¸€ä¸ªå·¥ç¨‹å®è·µæ¡ˆä¾‹â€”â€”<code>etcd</code>åˆ†å¸ƒå¼é”ã€‚<a href="https://github.com/etcd-io/etcd">etcd</a>æ˜¯ä¸€æ¬¾é€‚åˆç”¨äºå…±äº«é…ç½®å’ŒæœåŠ¡å‘ç°çš„åˆ†å¸ƒå¼KVå­˜å‚¨ç»„ä»¶ï¼Œåº•å±‚åŸºäºåˆ†å¸ƒå¼å…±è¯†ç®—æ³•Raftåè®®ä¿è¯äº†å­˜å‚¨æœåŠ¡çš„å¼ºä¸€è‡´æ€§å’Œé«˜å¯ç”¨ã€‚</p><h3 id="å®ç°åŸç†-1"><a href="#å®ç°åŸç†-1" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><ol><li><p><strong>åˆ›å»ºåˆ†å¸ƒå¼é”</strong><br>ç»“æ„ä½“<code>Session</code>è¡¨ç¤ºä¸€æ¬¡è®¿é—®ä¼šè¯ï¼ŒèƒŒåå¯¹åº”çš„æ˜¯ä¸€ç¬”ç§Ÿçº¦ï¼Œç”¨æˆ·è°ƒç”¨<code>NewSession</code>æ–¹æ³•æ„é€ <code>Session</code>å®ä¾‹æ—¶ï¼Œé¦–å…ˆç”³è¯·åˆ°ä¸€ä¸ªç§Ÿçº¦IDï¼Œç„¶å<strong>å¼‚æ­¥å¼€å¯ä¸€ä¸ªå®ˆæŠ¤åç¨‹ï¼Œè¿›è¡Œç§Ÿçº¦ç»­æœŸçš„ç›¸å…³å¤„ç†</strong>ã€‚<br>ç»“æ„ä½“<code>Mutex</code>è¡¨ç¤ºåˆ†å¸ƒå¼é”ï¼Œå…¶ä¸­æ ¸å¿ƒå­—æ®µåŒ…æ‹¬è®¿é—®ä¼šè¯sã€åˆ†å¸ƒå¼é”çš„å…¬å…±å‰ç¼€pfxã€pfxå’Œç§Ÿçº¦IDæ‹¼æ¥è€Œæˆçš„é”ä½¿ç”¨æ–¹keyå­—æ®µmyKeyï¼Œä»¥åŠé”ä½¿ç”¨æ–¹åœ¨pfxä¸‹å¯¹åº”çš„ç‰ˆæœ¬å­—æ®µmyRev</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Session <span class="keyword">struct</span> &#123;</span><br><span class="line">    client *v3.Client</span><br><span class="line">    opts   *sessionOptions</span><br><span class="line">    id     v3.LeaseID</span><br><span class="line"></span><br><span class="line">    cancel context.CancelFunc</span><br><span class="line">    donec  &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSession</span><span class="params">(client *v3.Client, opts ...SessionOption)</span></span> (*Session, <span class="type">error</span>) &#123;</span><br><span class="line">    lg := client.GetLogger()</span><br><span class="line">    ops := &amp;sessionOptions&#123;ttl: defaultSessionTTL, ctx: client.Ctx()&#125;</span><br><span class="line">    <span class="keyword">for</span> _, opt := <span class="keyword">range</span> opts &#123;</span><br><span class="line">        opt(ops, lg)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    id := ops.leaseID</span><br><span class="line">    <span class="keyword">if</span> id == v3.NoLease &#123;</span><br><span class="line">        resp, err := client.Grant(ops.ctx, <span class="type">int64</span>(ops.ttl))</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">        &#125;</span><br><span class="line">        id = resp.ID</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx, cancel := context.WithCancel(ops.ctx)</span><br><span class="line">    keepAlive, err := client.KeepAlive(ctx, id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> || keepAlive == <span class="literal">nil</span> &#123;</span><br><span class="line">        cancel()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    donec := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">    s := &amp;Session&#123;client: client, opts: ops, id: id, cancel: cancel, donec: donec&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// keep the lease alive until client error or cancelled context</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> <span class="built_in">close</span>(donec)</span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">range</span> keepAlive &#123;</span><br><span class="line">            <span class="comment">// eat messages until keep alive channel closes</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s,<span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Mutex <span class="keyword">struct</span> &#123;</span><br><span class="line">    s *Session</span><br><span class="line">    </span><br><span class="line">    pfx   <span class="type">string</span></span><br><span class="line">    myKey <span class="type">string</span></span><br><span class="line">    myRev <span class="type">int64</span></span><br><span class="line">    hdr   *pb.ResponseHeader</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMutex</span><span class="params">(s *Session, pfx <span class="type">string</span>)</span></span> *Mutex &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Mutex&#123;s, pfx + <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">-1</span>, <span class="literal">nil</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åŠ é”</strong><br>è°ƒç”¨<code>Mutex.tryAcquire</code>æ–¹æ³•å°è¯•æ’å…¥myKeyï¼ŒåŒæ—¶è·å–å½“å‰é”çš„å®é™…æŒæœ‰è€…ã€‚å¦‚æœå½“å‰é”ä»æœªè¢«å ç”¨ï¼Œæˆ–è€…é”æŒæœ‰è€…çš„ç‰ˆæœ¬å·ä¸è°ƒç”¨æ–¹çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œåˆ™ä»£è¡¨åŠ é”æˆåŠŸï¼›å¦åˆ™é”å·²è¢«ä»–äººå ç”¨ï¼Œè°ƒç”¨<code>waitDeletes</code>æ–¹æ³•ï¼Œç›‘å¬ç‰ˆæœ¬å·å°äºè‡ªå·±ä¸”æœ€æ¥è¿‘äºè‡ªå·±çš„é”è®°å½•æ•°æ®çš„åˆ é™¤äº‹ä»¶ã€‚å½“æ¥æ”¶åˆ°è§£é”äº‹ä»¶åï¼Œæ£€æŸ¥è‡ªèº«ç§Ÿçº¦æ˜¯å¦è¿‡æœŸï¼Œæ²¡æœ‰åˆ™åŠ é”æˆåŠŸ</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Mutex)</span></span> Lock(ctx context.Context) <span class="type">error</span> &#123;</span><br><span class="line">    resp, err := m.tryAcquire(ctx)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if no key on prefix / the minimum rev is key, already hold the lock</span></span><br><span class="line">    ownerKey := resp.Responses[<span class="number">1</span>].GetResponseRange().Kvs</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(ownerKey) == <span class="number">0</span> || ownerKey[<span class="number">0</span>].CreateRevision == m.myRev &#123;</span><br><span class="line">        m.hdr = resp.Header</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    client := m.s.Client()</span><br><span class="line">    <span class="comment">// wait for deletion revisions prior to myKey</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> early termination if the session key is deleted before other session keys with smaller revisions.</span></span><br><span class="line">    _, werr := waitDeletes(ctx, client, m.pfx, m.myRev<span class="number">-1</span>)</span><br><span class="line">    <span class="comment">// release lock key if wait failed</span></span><br><span class="line">    <span class="keyword">if</span> werr != <span class="literal">nil</span> &#123;</span><br><span class="line">        m.Unlock(client.Ctx())</span><br><span class="line">        <span class="keyword">return</span> werr</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// make sure the session is not expired, and the owner key still exists.</span></span><br><span class="line">    gresp, werr := client.Get(ctx, m.myKey)</span><br><span class="line">    <span class="keyword">if</span> werr != <span class="literal">nil</span> &#123;</span><br><span class="line">        m.Unlock(client.Ctx())</span><br><span class="line">        <span class="keyword">return</span> werr</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(gresp.Kvs) == <span class="number">0</span> &#123; <span class="comment">// is the session key lost?</span></span><br><span class="line">        <span class="keyword">return</span> ErrSessionExpired</span><br><span class="line">    &#125;</span><br><span class="line">    m.hdr = gresp.Header</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç›‘å¬</strong><br><code>waitDeletes</code>æ–¹æ³•åŸºäºä¸€ä¸ªforå¾ªç¯è‡ªæ—‹ï¼Œæ¯è½®å¤„ç†ä¸­ä¼šè·å–ç‰ˆæœ¬å·å°äºè‡ªå·±ä¸”æœ€æ¥è¿‘äºè‡ªå·±çš„åŠ é”æ–¹keyï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜è‡ªå·±çš„ç‰ˆæœ¬å·å·²ç»æ˜¯æœ€å°çš„ï¼Œé€€å‡ºç›‘å¬ï¼›å¦åˆ™è°ƒç”¨<code>waitDelete</code>æ–¹æ³•é˜»å¡ç›‘å¬è¿™ä¸ª keyçš„åˆ é™¤äº‹ä»¶ã€‚</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">waitDeletes</span><span class="params">(ctx context.Context, client *v3.Client, pfx <span class="type">string</span>, maxCreateRev <span class="type">int64</span>)</span></span> (*pb.ResponseHeader, <span class="type">error</span>) &#123;</span><br><span class="line">    getOpts := <span class="built_in">append</span>(v3.WithLastCreate(), v3.WithMaxCreateRev(maxCreateRev))</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        resp, err := client.Get(ctx, pfx, getOpts...)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(resp.Kvs) == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> resp.Header, <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        lastKey := <span class="type">string</span>(resp.Kvs[<span class="number">0</span>].Key)</span><br><span class="line">        <span class="keyword">if</span> err = waitDelete(ctx, client, lastKey, resp.Header.Revision); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">waitDelete</span><span class="params">(ctx context.Context, client *v3.Client, key <span class="type">string</span>, rev <span class="type">int64</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    cctx, cancel := context.WithCancel(ctx)</span><br><span class="line">    <span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wr v3.WatchResponse</span><br><span class="line">    wch := client.Watch(cctx, key, v3.WithRev(rev))</span><br><span class="line">    <span class="keyword">for</span> wr = <span class="keyword">range</span> wch &#123;</span><br><span class="line">        <span class="keyword">for</span> _, ev := <span class="keyword">range</span> wr.Events &#123;</span><br><span class="line">            <span class="keyword">if</span> ev.Type == mvccpb.DELETE &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err := wr.Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err := ctx.Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">&quot;lost watcher waiting for delete&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>è§£é”</strong><br>ç›´æ¥åˆ é™¤è°ƒç”¨æ–¹çš„KVå¯¹è®°å½•å³å¯ï¼Œå¦‚æœè°ƒç”¨æ–¹æ˜¯æŒæœ‰é”çš„è§’è‰²ï¼Œé‚£ä¹ˆåˆ é™¤KVå¯¹è®°å½•ä»£è¡¨çœŸæ­£æ„ä¹‰ä¸Šçš„è§£é”åŠ¨ä½œï¼›åä¹‹è°ƒç”¨æ–¹å¹¶æ— æŒæœ‰é”ï¼Œåˆ é™¤KVå¯¹å°±ä»£è¡¨é€€å‡ºäº†æŠ¢é”æµç¨‹ï¼Œä¸ä¼šå¯¹æµç¨‹äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</p></li></ol><h3 id="æŠ€æœ¯éš¾ç‚¹-1"><a href="#æŠ€æœ¯éš¾ç‚¹-1" class="headerlink" title="æŠ€æœ¯éš¾ç‚¹"></a>æŠ€æœ¯éš¾ç‚¹</h3><p>1.<strong>æ­»é”é—®é¢˜</strong><br><code>etcd</code>æä¾›äº†ç§Ÿçº¦æœºåˆ¶ï¼Œä¸€æ—¦è¾¾åˆ°ç§Ÿçº¦ä¸Šè§„å®šçš„æˆªæ­¢æ—¶é—´ï¼Œç§Ÿçº¦å°±ä¼šå¤±å»æ•ˆåŠ›ï¼Œè¿™ç±»ä¼¼äº<code>Redis</code>ä¸­çš„è¶…æ—¶æ—¶é—´ã€‚åŒæ—¶ï¼Œ<code>etcd</code>ä¸­è¿˜æä¾›äº†ç»­çº¦æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç»­çº¦æ“ä½œæ¥å»¶è¿Ÿç§Ÿçº¦çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ç±»ä¼¼äº<code>Redisson</code>ä¸­çš„çœ‹é—¨ç‹—ç­–ç•¥ã€‚</p><p>2.<strong>æƒŠç¾¤æ•ˆåº”</strong><br>ç›‘å¬å›è°ƒå‹é”çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼šå¦‚æœä¸€æŠŠåˆ†å¸ƒå¼é”çš„ç«äº‰æ¯”è¾ƒæ¿€çƒˆï¼Œé‚£ä¹ˆ<strong>é”çš„é‡Šæ”¾äº‹ä»¶å¯èƒ½åŒæ—¶è¢«å¤šä¸ªçš„å–é”æ–¹æ‰€ç›‘å¬ï¼Œä¸€æ—¦é”è¢«é‡Šæ”¾åæ‰€æœ‰çš„å–é”æ–¹éƒ½ä¼šä¸€æ‹¥è€Œä¸Š</strong>ï¼Œç„¶è€Œä¸€ä¸ªè½®æ¬¡ä¸­åªæœ‰ä¸€ä¸ªå–é”æ–¹èƒ½å¤Ÿå–é”æˆåŠŸï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå­˜åœ¨å¤§é‡æ€§èƒ½æŸè€—ï¼Œä¸”é‡Šæ”¾é”æ—¶åˆ»ç¬é—´æ¿€å¢çš„è¯·æ±‚æµé‡ä¹Ÿå¯èƒ½ä¼šå¯¹ç³»ç»Ÿç¨³å®šæ€§äº§ç”Ÿè´Ÿé¢æ•ˆåº”ã€‚<br><code>etcd</code>ä¸­åŸºäºé”å‰ç¼€å’Œç‰ˆæœ¬å·æœºåˆ¶æå‡ºçš„è§£å†³æ–¹æ¡ˆï¼šå¯¹äºå¯¹äºåŒä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œé”è®°å½•keyæ‹¥æœ‰å…±åŒçš„å‰ç¼€ï¼Œä½œä¸ºé”çš„æ ‡è¯†ã€‚åŠ é”æ–¹åŠ é”æ—¶ï¼Œä¼šä»¥é”å‰ç¼€æ‹¼æ¥ä¸Šè‡ªèº«ç§Ÿçº¦IDï¼Œç”Ÿæˆå®Œæ•´çš„keyï¼Œå› æ­¤<strong>åŠ é”æ–¹keyéƒ½æ˜¯ä¸åŒçš„</strong>ï¼Œéƒ½èƒ½æ’å…¥é”è®°å½•æ•°æ®ã€‚æ¯ä¸ªåŠ é”æ–¹æ’å…¥é”è®°å½•æ•°æ®æ—¶ï¼Œä¼šè·å¾—è‡ªèº«keyå¤„åœ¨é”å‰ç¼€èŒƒå›´ä¸‹å”¯ä¸€ä¸”é€’å¢çš„ç‰ˆæœ¬å·ã€‚<strong>åŠ é”æ–¹æ’å…¥åŠ é”è®°å½•æ•°æ®ä¸æ„å‘³ç€åŠ é”æˆåŠŸ</strong>ï¼Œè€Œæ˜¯éœ€è¦åœ¨æ’å…¥æ•°æ®åæŸ¥è¯¢ä¸€æ¬¡é”å‰ç¼€ä¸‹çš„è®°å½•åˆ—è¡¨ï¼Œåˆ¤å®šè‡ªèº«keyå¯¹åº”çš„ç‰ˆæœ¬å·æ˜¯å¦ä¸ºå…¶ä¸­æœ€å°ï¼Œæ˜¯åˆ™è¡¨ç¤ºåŠ é”æˆåŠŸï¼›å¦åˆ™ç›‘å¬ç‰ˆæœ¬å·å°äºè‡ªå·±ä½†æœ€æ¥è¿‘è‡ªå·±çš„é‚£ä¸ªkeyçš„åˆ é™¤äº‹ä»¶ã€‚<br>è¿™æ ·æ‰€æœ‰åŠ é”æ–¹ä¼š<strong>æ ¹æ®ç‰ˆæœ¬å·æ’æˆä¸€æ¡é˜Ÿåˆ—</strong>ï¼Œæ¯æ¬¡é”é‡Šæ”¾åªä¼šæƒŠåŠ¨ä¸‹ä¸€ä½ï¼ŒæƒŠç¾¤é—®é¢˜å¾—ä»¥é¿å…ã€‚</p><h2 id="å®éªŒå¯¹æ¯”"><a href="#å®éªŒå¯¹æ¯”" class="headerlink" title="å®éªŒå¯¹æ¯”"></a>å®éªŒå¯¹æ¯”</h2><p>è¯„ä»·æŒ‡æ ‡ä¸ºå¹³å‡åŠ é”æ—¶é—´ï¼Œå³ä»å‘èµ·é”è¯·æ±‚åˆ°æˆåŠŸè·å–é”çš„å¹³å‡æ—¶é—´ã€æ¯ç§’æˆåŠŸåŠ é”æ¬¡æ•°(LSPS)ã€P70&#x2F;P90&#x2F;P99å»¶è¿Ÿï¼Œä»¥åŠCPUä½¿ç”¨ç‡å·®å¼‚ã€‚æœ¬èŠ‚åªå±•ç¤ºå®è§‚ä¸Šçš„å®éªŒç»“è®ºï¼Œä¸å±•ç¤ºå…·ä½“æ•°å€¼ã€‚</p><h3 id="å»¶è¿Ÿã€ååé‡å¯¹æ¯”"><a href="#å»¶è¿Ÿã€ååé‡å¯¹æ¯”" class="headerlink" title="å»¶è¿Ÿã€ååé‡å¯¹æ¯”"></a>å»¶è¿Ÿã€ååé‡å¯¹æ¯”</h3><p>åœ¨<strong>å¹¶å‘é‡è¾ƒå°ï¼Œä½†åŠ é”é¢‘ç¹</strong>çš„åœºæ™¯ä¸‹ï¼Œä¸»åŠ¨è½®è¯¢å‹é”çš„å¹³å‡åŠ é”æ—¶é—´è¾ƒä½ï¼Œä½†æ˜¯<strong>é•¿å°¾æ•ˆåº”æ˜¾è‘—</strong>ï¼Œçº¦æœ‰10%çš„åŠ é”æ—¶é—´ä¸ºå¹³å‡æ—¶é—´çš„10-20å€ï¼›è€Œç›‘å¬å›è°ƒå‹é”çš„å¹³å‡åŠ é”æ—¶é—´åœ¨ä¸æ–­ä¸Šå‡ï¼Œæ¯ç§’åŠ é”æˆåŠŸæ•°ä¸æ–­ä¸‹é™ï¼Œè¯´æ˜å…¶<strong>å¤„ç†èƒ½åŠ›åœ¨é€æ¸ä¸‹é™</strong>ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºé¢‘ç¹è¯·æ±‚ä½¿å¾—etcdä¸­äº‹ä»¶å †ç§¯æ‰€è‡´ã€‚<br>åœ¨<strong>å¹¶å‘é‡è¾ƒå¤§</strong>çš„åœºæ™¯ä¸‹ï¼Œä¸»åŠ¨è½®è¯¢å‹é”çš„å¹³å‡åŠ é”æ—¶é—´éšç«äº‰æ•°é‡çº¿æ€§å¢é•¿ï¼Œå¹¶ä¸”éšç€ç«äº‰ç¨‹åº¦çš„æ¿€çƒˆï¼Œé•¿å°¾æ•ˆåº”æ„ˆå‘æ˜æ˜¾ã€‚åŒæ—¶å®¢æˆ·ç«¯æ•°é‡å¢åŠ 10å€ï¼ŒLSPSå‡å°‘25%ï¼›ç›‘å¬å›è°ƒå‹é”çš„å¹³å‡åŠ é”æ—¶é—´ä¸LSPSå¹¶æœªéšç€ç«äº‰ç¨‹åº¦å¢åŠ è€Œæ˜æ˜¾å˜åŒ–ï¼Œ<strong>è¾ƒä¸ºç¨³å®š</strong>ã€‚<br>ä½†æ˜¯ä¸¤ä¸ªåœºæ™¯ä¸‹ç›‘å¬å›è°ƒå‹é”çš„æ€§èƒ½å‡åŠ£äºä¸»åŠ¨è½®è¯¢å‹ï¼Œè¿™å¯èƒ½ä¸ç¬”è€…çš„å®éªŒç¯å¢ƒä»å¤„äºå•æœºçŠ¶æ€æœ‰å…³ï¼Œå¦‚ä¸å¿½ç•¥<strong>èŠ‚ç‚¹é—´çš„é€šä¿¡å»¶è¿Ÿä¸å®é™…ä»»åŠ¡å¤„ç†æ—¶é—´</strong>ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ç›‘å¬å›è°ƒå‹é”åº”è¯¥æ›´å…·ä¼˜åŠ¿ã€‚</p><h3 id="èµ„æºæ¶ˆè€—å¯¹æ¯”"><a href="#èµ„æºæ¶ˆè€—å¯¹æ¯”" class="headerlink" title="èµ„æºæ¶ˆè€—å¯¹æ¯”"></a>èµ„æºæ¶ˆè€—å¯¹æ¯”</h3><p>ç›‘å¬å›è°ƒå‹é”çš„CPUä½¿ç”¨ç‡çº¦æ¯”ä¸»åŠ¨è½®è¯¢å‹é”çº¦ä½10%-15%ï¼Œåœ¨é”ç«äº‰æ¿€çƒˆæ—¶CPUä½¿ç”¨ç‡çš„å·®è·æ›´åŠ æ˜æ˜¾</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•æ¨¡æ¿</title>
      <link href="/Blog/2025/02/23/suan-fa-mo-ban/"/>
      <url>/Blog/2025/02/23/suan-fa-mo-ban/</url>
      
        <content type="html"><![CDATA[<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h3 id="å›æº¯ç®—æ³•"><a href="#å›æº¯ç®—æ³•" class="headerlink" title="å›æº¯ç®—æ³•"></a>å›æº¯ç®—æ³•</h3><p><strong>æ„Ÿæ‚Ÿï¼š<strong>å›æº¯å¿…é¡»æœ‰ç»ˆæ­¢æ¡ä»¶ï¼Œæœ€å¥½ä¸º</strong>è¾¹ç•Œåˆ¤æ–­</strong>å’Œå…¶ä»–ä¸€äº›é€»è¾‘åˆ¤æ–­ï¼ˆå³åˆ¤æ–­ä¸ç¬¦åˆè¦æ±‚çš„æƒ…å†µï¼‰ï¼Œè¿™ä¼šå¾ˆæ–¹ä¾¿åé¢å›æº¯çš„è¿›è¡Œï¼›å½“ç„¶ï¼Œå›æº¯å‰ä¹Ÿå¯ä»¥è¿›è¡Œåˆ¤æ–­ï¼Œä»¥å…è¿›è¡Œä¸å¿…è¦çš„å›æº¯ã€‚</p><p><strong>æ‰¾å­é›†ï¼š</strong> ä»å½“å‰idxå¼€å§‹æ·»åŠ +isVï¼›<strong>å…¨æ’åˆ—ï¼š</strong> ä»0å¼€å§‹æ·»åŠ +isVï¼›å½“æœ‰é‡æ—¶ï¼Œè®°ä½ï¼šè‹¥isVä¸­ä¸Šä¸€ä¸ªå·²ç»æœç´¢å®Œå…¶å­é€’å½’æ ‘ï¼Œä¸”è¿™ä¸€ä¸ªå’Œä¸Šä¸€ä¸ªå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸€ä¸ªæ²¡æœ‰ç»§ç»­é€’å½’çš„å¿…è¦ã€‚p.s.å…¨æ’åˆ—è¿˜å¯ä»¥é€šè¿‡äº¤æ¢çš„æ–¹å¼è·å¾—ï¼Œä½†è¿™æ—¶ä¸å¥½å»é‡</p><blockquote><p>Minimax ç®—æ³•ä¸­çš„ Alpha-Beta å‰ªæ</p></blockquote><p>åˆ©ç”¨æœç´¢æ ‘æ¯ä¸ªèŠ‚ç‚¹å–å€¼çš„ä¸Šä¸‹ç•Œæ¥è¿›è¡Œå‰ªæä¼˜åŒ–ï¼Œæ³¨æ„ç‚¹ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹å…·æœ‰<strong>æœ€å¤§ä¸‹ç•Œ</strong>å’Œ<strong>æœ€å°ä¸Šç•Œ</strong>ï¼Œä¸”æ¯ä¸ªèŠ‚ç‚¹å‘ä¸Šå±‚èŠ‚ç‚¹è¿”å›è‡ªå·±çš„è®¡ç®—ç»“æœ</li><li>ä¸Šå±‚èŠ‚ç‚¹ä»¥è‡ªå·±çš„ä¸Šä¸‹ç•Œæ¥<strong>åˆå§‹åŒ–</strong>ä¸‹å±‚èŠ‚ç‚¹çš„ä¸Šä¸‹ç•Œï¼Œæœ€åˆä»¥Â±âˆè¡¨ç¤º</li><li>MinèŠ‚ç‚¹æ”¹å˜ä¸Šç•Œ(Beta)ï¼ŒMaxèŠ‚ç‚¹æ”¹å˜ä¸‹ç•Œ(Alpha)</li><li>ä¸€æ—¦æŸèŠ‚ç‚¹<strong>ä¸Šä¸‹ç•ŒçŸ›ç›¾</strong>ï¼Œè¿›è¡Œå‰ªæ</li></ol><hr><h3 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯äº†è·¯å¾„å‹ç¼©å’ŒæŒ‰ç§©åˆå¹¶çš„å¹¶æŸ¥é›†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnionFind</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] parent;</span><br><span class="line">    <span class="type">int</span>[] size;</span><br><span class="line">    <span class="comment">// å½“å‰è¿é€šåˆ†æ”¯æ•°ç›®</span></span><br><span class="line">    <span class="type">int</span> branchCount;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UnionFind</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.branchCount = n;</span><br><span class="line">        <span class="built_in">this</span>.parent = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="built_in">this</span>.size = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        Arrays.fill(size, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="comment">// è·¯å¾„å‹ç¼©</span></span><br><span class="line">        <span class="keyword">if</span>(parent[x] != x) parent[x] = find(parent[x]);</span><br><span class="line">        <span class="keyword">return</span> parent[x];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">unite</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        x = find(x);</span><br><span class="line">        y = find(y);</span><br><span class="line">        <span class="keyword">if</span> (x == y) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŒ‰ç§©åˆå¹¶</span></span><br><span class="line">        <span class="keyword">if</span> (size[x] &lt; size[y]) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> x;</span><br><span class="line">            x = y;</span><br><span class="line">            y = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        parent[y] = x;</span><br><span class="line">        size[x] += size[y];</span><br><span class="line">        --branchCount;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">connected</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> find(x) == find(y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">branchCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> branchCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ— ç§© å¹¶æŸ¥é›†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnionFind</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] parent;</span><br><span class="line">    <span class="type">int</span> branchCount;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UnionFind</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.branchCount = n;</span><br><span class="line">        <span class="built_in">this</span>.parent = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(parent[x] != x) parent[x] = find(parent[x]);</span><br><span class="line">        <span class="keyword">return</span> parent[x];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">unite</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        x = find(x);</span><br><span class="line">        y = find(y);</span><br><span class="line">        <span class="keyword">if</span> (x == y) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        parent[y] = x;</span><br><span class="line">        --branchCount;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">branchCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> branchCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="æ ‘çŠ¶æ•°ç»„"><a href="#æ ‘çŠ¶æ•°ç»„" class="headerlink" title="æ ‘çŠ¶æ•°ç»„"></a>æ ‘çŠ¶æ•°ç»„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//èŠ‚ç‚¹tree[x]è¦†ç›–çš„é•¿åº¦ä¸ºlowbit(x),å…¶çˆ¶èŠ‚ç‚¹ä¸ºtree[x+lowbit(x)]</span></span><br><span class="line"><span class="comment">// ä¸Šæ¥å…ˆæŠŠä¸‰ä¸ªæ–¹æ³•å†™å‡ºæ¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">binIndexedTree</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] tree;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ã€Œæ ‘çŠ¶æ•°ç»„ã€ï¼Œè¦é»˜è®¤æ•°ç»„æ˜¯ä» 1 å¼€å§‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">binIndexedTree</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">      tree = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) add(i + <span class="number">1</span>, nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">lowbit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &amp; -x;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥è¯¢å‰ç¼€å’Œçš„æ–¹æ³•</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> x; i &gt; <span class="number">0</span>; i -= lowbit(i)) ans += tree[i];</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨æ ‘çŠ¶æ•°ç»„ x ä½ç½®ä¸­å¢åŠ å€¼ u</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> u)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> tree.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> x; i &lt;= n; i += lowbit(i)) tree[i] += u;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š<strong>æ ‘çŠ¶æ•°ç»„åŠ¨æ€ç»´æŠ¤</strong>å‰ç¼€å’Œ</strong>ï¼Œå¯å•ç‚¹ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢ï¼ŒåŒºé—´æŸ¥è¯¢ï¼›<strong>åŒºé—´ä¿®æ”¹ä»€ä¹ˆçš„ï¼Œè¿˜æ˜¯ç”¨çº¿æ®µæ ‘å§ï¼ˆè‹¥åªæœ‰åŒºé—´ä¿®æ”¹å¯ä»¥å·®åˆ†+æ ‘çŠ¶ï¼‰</strong></p><hr><h3 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//acwing 789</span></span><br><span class="line"><span class="comment">//æ‰¾ä¸€ä¸ªæ•°åœ¨æ•°ç»„ä¸­çš„èµ·å§‹ä¸ç»“æŸä½ç½®</span></span><br><span class="line"><span class="type">int</span>[] binSearch(<span class="type">int</span> num)&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = n-<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">    <span class="comment">//æ‰¾èµ·å§‹ä½ç½®</span></span><br><span class="line">    <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l+(r-l)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(arr[mid] &lt; num) l = mid+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    res[<span class="number">0</span>] = arr[l] == num ? l : -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//æ‰¾æœ«ä½ç½®</span></span><br><span class="line">    l = <span class="number">0</span>; r = n-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l+(r-l+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(arr[mid] &gt; num) r = mid-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> l = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    res[<span class="number">1</span>] = arr[l] == num ? l : -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š<strong>äºŒåˆ†æŸ¥æ‰¾ï¼Œ<strong>å…ˆç¡®å®šæŸ¥æ‰¾çš„å‚æ•°</strong>æ˜¯å“ªä¸€ä¸ªï¼Œç¡®å®šä¸¤ä¸ªåŒºé—´ï¼Œå†ç¡®å®šä½¿ç”¨äºŒåˆ†äº§ç”Ÿçš„å¼€é”€èƒ½å¦æ¥å—ï¼ˆå¾€å¾€ä¸O(n)éå†ç»“åˆï¼‰ï¼›&#x3D;&#x3D;äºŒåˆ†æŸ¥æ‰¾çš„</strong>æœ¬è´¨</strong>æ˜¯æŸ¥æ‰¾<strong>å…·æœ‰äºŒæ®µæ€§</strong>çš„åŒºé—´çš„ç«¯ç‚¹ &#x3D;&#x3D;ï¼Œå› æ­¤æœ‰ä¸¤ä¸ªæ¨¡æ¿ï¼ŒæŒ‰éœ€ä½¿ç”¨</p><p><strong>æµ®ç‚¹æ•°äºŒåˆ†ï¼Œ</strong> ç”±äºæ¯æ¬¡<code>mid</code>ä¸ä¼šå’Œ<code>lã€r</code>é‡å¤ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒæ— é™å¾ªç¯é—®é¢˜ï¼Œ<code>while</code>åˆ¤æ–­æ¡ä»¶å¾€å¾€ä¸º<code>l-r &lt;= 1e-m</code>ï¼Œ<code>m</code>æ ¹æ®ç»éªŒï¼Œä¸€èˆ¬ä¸ºæ‰€éœ€ç²¾åº¦å‡2</p><hr><h3 id="Manachar"><a href="#Manachar" class="headerlink" title="Manachar"></a>Manachar</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="comment">//æ„é€ é©¬æ‹‰è½¦å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">preProcess</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;^$&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="string">&quot;^&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        ret += <span class="string">&quot;#&quot;</span> + s.charAt(i);</span><br><span class="line">    ret += <span class="string">&quot;#$&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countSubstrings</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">T</span> <span class="operator">=</span> preProcess(s);</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> T.length(), res = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//é©¬æ‹‰è½¦å­—ç¬¦ä¸²å„å­—æ¯çš„å›æ–‡åŠå¾„</span></span><br><span class="line">    <span class="type">int</span>[] P = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="type">int</span> <span class="variable">C</span> <span class="operator">=</span> <span class="number">0</span>, R = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i_mirror</span> <span class="operator">=</span> <span class="number">2</span> * C - i;</span><br><span class="line">        <span class="keyword">if</span> (R &gt; i) &#123;</span><br><span class="line">            P[i] = Math.min(R - i, P[i_mirror]);<span class="comment">// é˜²æ­¢è¶…å‡º R</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            P[i] = <span class="number">0</span>;<span class="comment">// ç­‰äº R çš„æƒ…å†µ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¢°åˆ°ä¹‹å‰è®²çš„ä¸‰ç§æƒ…å†µæ—¶å€™ï¼Œéœ€è¦åˆ©ç”¨ä¸­å¿ƒæ‰©å±•æ³•</span></span><br><span class="line">        <span class="keyword">while</span> (T.charAt(i + <span class="number">1</span> + P[i]) == T.charAt(i - <span class="number">1</span> - P[i])) &#123;</span><br><span class="line">            P[i]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–° R</span></span><br><span class="line">        <span class="keyword">if</span> (i + P[i] &gt; R) &#123;</span><br><span class="line">            C = i;</span><br><span class="line">            R = i + P[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//resç»Ÿè®¡æ‰€æœ‰çš„å›æ–‡å­ä¸²</span></span><br><span class="line">        res += P[i]/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span> == <span class="number">0</span>)res++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š</strong> Manacharç®—æ³•å‰ç½®é¡»çŸ¥ï¼šé©¬æ‹‰è½¦å­—ç¬¦ä¸²çš„å›æ–‡åŠå¾„&#x3D;åŸå­—ç¬¦ä¸²ä¸­å¯¹åº”å›æ–‡ä¸²é•¿åº¦  ä»é©¬æ‹‰è½¦å­—ç¬¦ä¸²çš„Cä½ç½®æ¨å¾—åŸä¸²ä¸­èµ·å§‹ä½ç½®ï¼šstart&#x3D;(Cindex-P[C])&#x2F;2;</p><p>ç„¶åå°±å¯ä»¥é€šè¿‡éå†ä¾æ¬¡æ±‚å‡ºå¯¹åº”å­—æ¯çš„å›æ–‡åŠå¾„ï¼Œéœ€è¦åŠ¨æ€ç»´æŠ¤<strong>æœ€é•¿å³ç•ŒRå’Œæœ€é•¿å³ç•Œçš„ä¸­å¿ƒCï¼Œ<strong>ç„¶åæ ¹æ®</strong>å›æ–‡ä¸²å†…</strong>çš„å¯¹ç§°æ€§æ¨å½“å‰å­—æ¯å›æ–‡åŠå¾„ã€‚</p><h3 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å­—ç¬¦ä¸²s æ¨¡å¼ä¸²p å‡ä»ä¸‹æ ‡1å¼€å§‹</span></span><br><span class="line"><span class="type">char</span>[] s, p;</span><br><span class="line"><span class="type">int</span>[] next;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="comment">//é‡ç‚¹åœ¨äºï¼Œæ¯”è¾ƒçš„æ˜¯ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼æ‰€ä»¥j+1,è€Œiå·²ç»è¡¨ç¤ºä¸‹ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="comment">//next</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>, j = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; p[i] != p[j+<span class="number">1</span>]) j = next[j];</span><br><span class="line">    <span class="keyword">if</span>(p[i] == p[j+<span class="number">1</span>]) j++;</span><br><span class="line">    next[i] = j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒ¹é…</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>, j = <span class="number">0</span>; i &lt;= m; i++)&#123;</span><br><span class="line">    <span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; s[i] != p[j+<span class="number">1</span>]) j = next[j];</span><br><span class="line">    <span class="keyword">if</span>(s[i] == p[j+<span class="number">1</span>]) j++;</span><br><span class="line">    <span class="keyword">if</span>(j == n)&#123;</span><br><span class="line">        <span class="comment">//åŒ¹é…æˆåŠŸä¸€æ¬¡</span></span><br><span class="line">        j = next[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å•è°ƒæ ˆ"><a href="#å•è°ƒæ ˆ" class="headerlink" title="å•è°ƒæ ˆ"></a>å•è°ƒæ ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å·¦ä¾§æœ€è¿‘ ä¸¥æ ¼å°äº ä½ç½®</span></span><br><span class="line"><span class="type">int</span>[] left = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">Deque&lt;Integer&gt; st = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//ä»å·¦å¾€å³</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">    <span class="keyword">while</span>(!st.isEmpty() &amp;&amp; left[st.peek()] &gt;= left[i]) st.pop();</span><br><span class="line">    <span class="comment">//é€šå¸¸å­˜å‚¨ç´¢å¼•</span></span><br><span class="line">    left[i] = st.isEmpty() ? -<span class="number">1</span> : st.peek();</span><br><span class="line">    st.push(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•è°ƒé˜Ÿåˆ—"><a href="#å•è°ƒé˜Ÿåˆ—" class="headerlink" title="å•è°ƒé˜Ÿåˆ—"></a>å•è°ƒé˜Ÿåˆ—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»å…¸ç”¨ä¾‹: æ»‘åŠ¨åŒºé—´æ±‚æœ€å€¼</span></span><br><span class="line"><span class="type">int</span>[] q = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line"><span class="type">int</span> <span class="variable">hh</span> <span class="operator">=</span> <span class="number">0</span>, tt = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœä¸€æ¬¡è¿›å…¥ä¸€ä¸ªå…ƒç´ ï¼Œç¬¬ä¸€å¥çš„whileå¯æ¢æˆif</span></span><br><span class="line">    <span class="keyword">while</span> (hh &lt;= tt &amp;&amp; check_out(q[hh])) hh ++ ;  <span class="comment">// åˆ¤æ–­é˜Ÿå¤´æ˜¯å¦æ»‘å‡ºçª—å£</span></span><br><span class="line">    <span class="keyword">while</span> (hh &lt;= tt &amp;&amp; check(q[tt], i)) tt -- ;   <span class="comment">//é˜Ÿå°¾å…ƒç´ å‡ºé˜Ÿåˆ—</span></span><br><span class="line">    q[ ++ tt] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*ps.å•è°ƒé˜Ÿåˆ—åœ¨ä¸Šé¢çš„dpå¤šé‡èƒŒåŒ…é—®é¢˜ä¸­åº”ç”¨*/</span></span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š<strong>å•è°ƒé˜Ÿåˆ—å’Œå•è°ƒæ ˆä¸­çš„å…ƒç´ ï¼Œé¡¾åæ€ä¹‰éƒ½æ˜¯å•è°ƒçš„ï¼Œå› æ­¤å¯ä»¥åœ¨å…¶ä¸­è¿›è¡Œ</strong>äºŒåˆ†</strong>ã€<strong>æ±‚æå€¼</strong>ç­‰æ“ä½œã€‚</p><hr><h3 id="æ—¶é—´æˆ³"><a href="#æ—¶é—´æˆ³" class="headerlink" title="æ—¶é—´æˆ³"></a>æ—¶é—´æˆ³</h3><p>ç”¨å¤„ï¼š<strong>åˆ¤æ–­æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹çš„ç¥–å…ˆèŠ‚ç‚¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®°å½•dfsä¸€æ£µæ ‘æ—¶,æ¯ä¸ªèŠ‚ç‚¹çš„è¿›å…¥æ—¶é—´å’Œé€€å‡ºæ—¶é—´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;Integer&gt;[] g;</span><br><span class="line">    <span class="type">int</span>[] in, out;</span><br><span class="line">    <span class="type">int</span> clock;</span><br><span class="line">    <span class="comment">//leetcode 2322ä¸ºä¾‹å­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumScore</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span>[][] edges)</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        g = <span class="keyword">new</span> <span class="title class_">ArrayList</span>[n];</span><br><span class="line">        <span class="comment">//æ ¹æ®edgeså»ºæ ‘</span></span><br><span class="line">        Arrays.setAll(g, e -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> e : edges) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> e[<span class="number">0</span>], y = e[<span class="number">1</span>];</span><br><span class="line">            g[x].add(y);</span><br><span class="line">            g[y].add(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿›å…¥æ—¶é—´</span></span><br><span class="line">        in = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="comment">//é€€å‡ºæ—¶é—´</span></span><br><span class="line">        out = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        dfs(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä¼ å…¥å½“å‰éå†åˆ°çš„èŠ‚ç‚¹x,å’Œå…¶çˆ¶èŠ‚ç‚¹y</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa)</span> &#123;</span><br><span class="line">        in[x] = ++clock;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> y : g[x])&#123;</span><br><span class="line">            <span class="comment">//yéœ€è¦æ˜¯xçš„å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (y != fa) dfs(y, x);</span><br><span class="line">        &#125;</span><br><span class="line">        out[x] = clock;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åˆ¤æ–­n1æ˜¯å¦æ˜¯n2çš„ç¥–å…ˆèŠ‚ç‚¹</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isParent</span><span class="params">(<span class="type">int</span> n1, <span class="type">int</span> n2)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(in[n1] &lt; in[n2] &amp;&amp; out[n2] &lt;= out[n1]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š<strong>dfséå†æ—¶æ¯ä¸ªèŠ‚ç‚¹åªä¼šéå†ä¸€æ¬¡ï¼Œæ ¹æ®</strong>çˆ¶å­å…³ç³»</strong>é¿å…äº†éå†ä»¥åŠéå†è¿‡çš„èŠ‚ç‚¹ï¼›å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½® isVisited[] æ¥é¿å…</p><hr><h3 id="è·³è¡¨"><a href="#è·³è¡¨" class="headerlink" title="è·³è¡¨"></a>è·³è¡¨</h3><ol><li>è·³è¡¨æ˜¯å¯ä»¥å®ç°äºŒåˆ†æŸ¥æ‰¾çš„æœ‰åºé“¾è¡¨</li><li>æ¯ä¸ªå…ƒç´ æ’å…¥æ—¶éšæœºç”Ÿæˆå®ƒçš„level <strong>ï¼ˆç´¢å¼•å±‚æ•°ï¼Œæœ€åº•å±‚ä¸º1ï¼‰</strong></li><li>æœ€åº•å±‚åŒ…å«æ‰€æœ‰çš„å…ƒç´ </li><li>å¦‚æœä¸€ä¸ªå…ƒç´ å‡ºç°åœ¨level(x)ï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå‡ºç°åœ¨xä»¥ä¸‹çš„levelä¸­</li><li>è·³è¡¨æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)ï¼Œä¸å¹³è¡¡äºŒå‰æ ‘æ¥è¿‘</li></ol><hr><h3 id="äºŒç»´å·®åˆ†"><a href="#äºŒç»´å·®åˆ†" class="headerlink" title="äºŒç»´å·®åˆ†"></a>äºŒç»´å·®åˆ†</h3><p>ä¸€ç»´å·®åˆ†æ•°ç»„æ±‚åŸæ•°ç»„ï¼Œé€šè¿‡å‰ç¼€å’Œå¾—åˆ°ï¼›äºŒç»´è‡ªç„¶ä¹Ÿæ˜¯æ±‚äºŒç»´å‰ç¼€å’Œï¼šå³ä»çŸ©é˜µå·¦ä¸Šè§’å¼€å§‹ç®—èµ·ï¼Œåˆ°å½“å‰ä½ç½®æ‰€å›´æˆå°å·®åˆ†çŸ©é˜µå†…çš„æ•°å­—å’Œã€‚</p><p>åŒºåŸŸæ”¹å˜æ—¶çš„è§„åˆ™ï¼š</p><img src="/Blog/img/0fe56b8bd48550b327275f6d9cdf35e7.jpg" alt="å¾®ä¿¡å›¾ç‰‡_20230313103218.jpg" style="zoom:50%;" /><hr><h3 id="ç¦»æ•£åŒ–"><a href="#ç¦»æ•£åŒ–" class="headerlink" title="ç¦»æ•£åŒ–"></a>ç¦»æ•£åŒ–</h3><p>å°†é¢˜ç›®ä¸­æ‰€æœ‰ç»™å‡ºçš„æ•°å­—ï¼Œ<strong>æ’åºå»é‡</strong>ï¼Œå†æ˜ å°„åˆ°<code>1 ~ n</code>çš„åŒºé—´ä¸­ï¼Œå› æ­¤éœ€è¦å€ŸåŠ©<strong>äºŒåˆ†æŸ¥æ‰¾</strong>å¾—åˆ°åŒºé—´ä½ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å»é‡</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">unique</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> waitTodc.size(), res = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(waitTodc.get(i) != waitTodc.get(i-<span class="number">1</span>)) &#123;</span><br><span class="line">          waitTodc.set(res, waitTodc.get(i));</span><br><span class="line">          res++;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥æ‰¾æ˜ å°„åçš„åŒºé—´ä½ç½®</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> num)</span>&#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = len-<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (l+r)/<span class="number">2</span>;</span><br><span class="line">      <span class="keyword">if</span>(num &lt;= waitTodc.get(mid)) r = mid;</span><br><span class="line">      <span class="keyword">else</span> l = mid+<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="keyword">return</span> l+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br/><h2 id="æ•°å­¦"><a href="#æ•°å­¦" class="headerlink" title="æ•°å­¦"></a>æ•°å­¦</h2><h3 id="åŸƒæ°ç­›æ³•"><a href="#åŸƒæ°ç­›æ³•" class="headerlink" title="åŸƒæ°ç­›æ³•"></a>åŸƒæ°ç­›æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç­›é™¤æ¯ä¸ªè´¨æ•°çš„å€æ•° O(nlog(logn))</span></span><br><span class="line"><span class="comment">//n*(1/1+1/2+...1/n)</span></span><br><span class="line"><span class="type">int</span>[] primes;</span><br><span class="line"><span class="type">int</span> cnt;</span><br><span class="line"><span class="type">boolean</span>[] st;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">get_primes</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!st[i])&#123;</span><br><span class="line">      primes[cnt++] = i;</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+i; j &lt;= n; j += i) st[j] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿æ€§ç­›æ³•"><a href="#çº¿æ€§ç­›æ³•" class="headerlink" title="çº¿æ€§ç­›æ³•"></a>çº¿æ€§ç­›æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¹æ®æ¯ä¸ªæ•°çš„æœ€å°è´¨å› å­ï¼Œç­›é™¤æ¯ä¸ªåˆæ•°</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">get_primes</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!st[i]) primes[cnt++] = i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; primes[j] &lt;= n/i; j++)&#123;</span><br><span class="line">      <span class="comment">//primes[j] ä¸€å®šæ˜¯ primes[j]*i çš„æœ€å°è´¨å› å­</span></span><br><span class="line">      st[primes[j]*i] = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">if</span>(i % primes[j] == <span class="number">0</span>) <span class="keyword">break</span>;   <span class="comment">//å»æ‰è¿™å¥å°±æ˜¯åŸƒæ°ç­›æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¬§æ‹‰å‡½æ•°"><a href="#æ¬§æ‹‰å‡½æ•°" class="headerlink" title="æ¬§æ‹‰å‡½æ•°"></a>æ¬§æ‹‰å‡½æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¡¨ç¤º1~nä¸­å’Œnäº’è´¨çš„æ•°çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment">//n*(1-1/p1)*(1-1/p2)*...(1-1/pm) ,p1ã€...pmå‡ä¸ºè´¨å› å­</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">phi</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> x;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= x / i; i ++ )</span><br><span class="line">        <span class="keyword">if</span> (x % i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            res = res / i * (i - <span class="number">1</span>);  <span class="comment">//(i-1)/i * res</span></span><br><span class="line">            <span class="keyword">while</span> (x % i == <span class="number">0</span>) x /= i;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//å› ä¸ºforå¾ªç¯é€€å‡ºååªéå†äº†æ¯”sqrt(x)å°çš„è´¨å› æ•°ï¼Œå› æ­¤è¿˜å¯èƒ½ç•™ä¸‹ä¸€ä¸ªè´¨å› æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">1</span>) res = res / x * (x - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¹Ÿå¯é€šè¿‡çº¿æ€§ç­›æ³•æ±‚æ¬§æ‹‰å‡½æ•°ï¼Œè¿™é‡Œä¸å†åˆ—ä¸¾</strong></p><p><strong>æ¬§æ‹‰å®šç†ï¼š</strong> $a^{phi(n)} &#x3D; 1 (modn)$ï¼Œå…¶ä¸­<code>aã€n</code>äº’è´¨</p><p><strong>è´¹é©¬å®šç†ï¼š</strong>$a^{n-1}&#x3D;1(modn)$ï¼Œæ¬§æ‹‰å®šç†çš„åŸºç¡€ä¸Šï¼Œ<code>n</code><strong>åˆæ˜¯è´¨æ•°</strong></p><h3 id="å¿«é€Ÿå¹‚"><a href="#å¿«é€Ÿå¹‚" class="headerlink" title="å¿«é€Ÿå¹‚"></a>å¿«é€Ÿå¹‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ¬è´¨å°±æ˜¯å°†å¾…æ±‚æ•°a^næ‹†æˆa^1*a^2*...*a^(2^logn)</span></span><br><span class="line"><span class="type">long</span> <span class="title function_">qmi</span><span class="params">(<span class="type">long</span> a, <span class="type">int</span> b, <span class="type">int</span> p)</span>&#123;</span><br><span class="line">      <span class="type">long</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">      <span class="keyword">while</span>(b &gt; <span class="number">0</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span>((b&amp;<span class="number">1</span>) == <span class="number">1</span>) res = res*a%p;</span><br><span class="line">          a = a*a%p;</span><br><span class="line">          b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> res%p;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­å›½å‰©ä½™å®šç†"><a href="#ä¸­å›½å‰©ä½™å®šç†" class="headerlink" title="ä¸­å›½å‰©ä½™å®šç†"></a>ä¸­å›½å‰©ä½™å®šç†</h3><p><em>å‰ç½®çŸ¥è¯†ï¼š</em></p><ol><li><p>&#x3D;&#x3D;ä¹˜æ³•é€†å…ƒ&#x3D;&#x3D;        <img src="/Blog/img/010e58fd12336484c1f9c64e155e4db2.png" alt="screen-capture" style="zoom:50%;" /></p><p>å½“<code>n</code>ä¸ºè´¨æ•°æ—¶ï¼Œæ ¹æ®<strong>è´¹é©¬å®šç†</strong>ï¼Œå¯çŸ¥$a^{n-2}$å³ä¸º<code>a</code>çš„ä¹˜æ³•é€†å…ƒï¼Œä¾¿ä¸éœ€æ‰©å±•æ¬§å‡ é‡Œå¾—</p></li><li><p>&#x3D;&#x3D;æ‰©å±•çš„æ¬§å‡ é‡Œå¾—ç®—æ³•&#x3D;&#x3D;</p><ol><li><p>æœ€å¤§å…¬çº¦æ•°è¡¨ç¤ºå®šç†ï¼ˆ<strong>è£´èœ€å®šç†</strong>ï¼‰</p><p><img src="/Blog/img/7dca99e400eabad2c0ab33d8f611ce1b.png" alt="screen-capture"></p></li><li><p>æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•</p><p>åœ¨æ‰§è¡Œæ¬§å‡ é‡Œå¾—ç®—æ³•æ—¶ï¼Œåˆ©ç”¨æ¯ä¸€æ­¥è®¡ç®—çš„ä½™æ•°å’Œå•†ï¼Œè¿­ä»£çš„è®¡ç®—æ¯ä¸€æ­¥çš„<code>s</code>å’Œ<code>t</code>ï¼Œæœ€åæ±‚å‡º$s_nã€t_n$</p><p><strong>ç”¨ä¹‹æ±‚ä¹˜æ³•é€†å…ƒ</strong>    <img src="/Blog/img/f33f00e05f3daca129317f39dc85b606.png" alt="screen-capture" style="zoom:50%;" /></p></li></ol></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸­å›½å‰©ä½™å®šç†</span></span><br><span class="line"><span class="comment">//m1, m2, ..., m_n ä¸¤ä¸¤äº’è´¨ï¼Œåˆ™ä¸‹è¿°åŒä½™æ–¹ç¨‹ç»„å¿…æœ‰å”¯ä¸€è§£é›†</span></span><br><span class="line"><span class="comment">//å¦‚æœå­˜åœ¨ä¸äº’è´¨çš„m_jï¼Œåˆ™æ— éœ€ç†ä¼šé‚£ä¸€ä¸ªåŒä½™æ–¹ç¨‹</span></span><br><span class="line"><span class="comment">//              xâ‰¡a1( mod m1)</span></span><br><span class="line"><span class="comment">//              xâ‰¡a2( mod m2)</span></span><br><span class="line"><span class="comment">//              ...</span></span><br><span class="line"><span class="comment">//              xâ‰¡a_n( mod m_n)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CRT</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span>[] mod, remainder;</span><br><span class="line">  <span class="type">long</span> <span class="variable">M</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//M = sum(m1, m2, ..., m_n)</span></span><br><span class="line">  <span class="comment">//remainder = [a1, a2, ..., a_n]</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">CRT</span><span class="params">(<span class="type">int</span>[] mod, <span class="type">int</span>[] remainder)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.mod = mod;</span><br><span class="line">    <span class="built_in">this</span>.remainder = remainder;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> m : mod) M *= m;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ±‚ (mod m)ä¸‹çš„è§£ï¼Œæ˜“çŸ¥è¯¥è§£å”¯ä¸€</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">solute</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> mod.length;</span><br><span class="line">    <span class="type">long</span>[] mod_k = <span class="keyword">new</span> <span class="title class_">long</span>[n];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) mod_k[i] = M/mod[i];</span><br><span class="line">    <span class="comment">//æ±‚mod_kä¸­å„å…ƒç´  é€†å…ƒ</span></span><br><span class="line">    <span class="type">long</span>[] inverseE = <span class="keyword">new</span> <span class="title class_">long</span>[n];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) inverseE[i] = (exgcd(mod_k[i], mod[i]))[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="type">long</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">      res += (remainder[i]*mod_k[i]*inverseE[i]) ;</span><br><span class="line">      res %= M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¿”å› [0] [1], ä½¿å¾—a*[0]+b*[1] = gcd(a, b)</span></span><br><span class="line">  <span class="type">long</span>[] exgcd(<span class="type">long</span> a, <span class="type">long</span> b)&#123;</span><br><span class="line">    <span class="keyword">if</span>(b == <span class="number">0L</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">long</span>[]&#123;<span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">long</span>[] res = exgcd(b, a%b);</span><br><span class="line">    <span class="comment">//b*[0] + (a-(a/b)*b)*[1] = gcd(a, b)</span></span><br><span class="line">    <span class="comment">//a*[1] + b*([0]-(a/b)*[1]) = gcd(a, b)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">long</span>[]&#123;res[<span class="number">1</span>], res[<span class="number">0</span>] - a/b*res[<span class="number">1</span>]&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ±‚ç»„åˆæ•°"><a href="#æ±‚ç»„åˆæ•°" class="headerlink" title="æ±‚ç»„åˆæ•°"></a>æ±‚ç»„åˆæ•°</h3><ol><li><strong>é€’æ¨ï¼š</strong>$C_a^b&#x3D;C_{a-1}^b+C_{a-1}^{b-1}$ï¼Œ<code>O(n^2)</code></li><li>**é¢„å¤„ç†ï¼š**æ±‚å‡ºæ‰€æœ‰é˜¶ä¹˜ï¼Œä»¥åŠæ‰€æœ‰é˜¶ä¹˜çš„é€†å…ƒï¼ˆæ¨¡pï¼‰ï¼Œ<code>O(nlogn)</code></li><li><strong>å¢å¡æ–¯å®šç†ï¼š</strong>$C_a^b&#x3D;C_{a%p}^{b%p}*C_{a&#x2F;p}^{b&#x2F;p}$ï¼Œ <code>O(logp[n]*p)</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">lucas</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(a &lt; p &amp;&amp; b &lt; p) <span class="keyword">return</span> C(a, b);</span><br><span class="line">  <span class="keyword">return</span> C(a%p, b%p) * lucas(a/p, b/p) % mod;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><strong>è´¨æ•°ç›¸ä¹˜ï¼š<strong>ç”¨äºåœ¨</strong>ä¸å–æ¨¡</strong>çš„æƒ…å†µä¸‹æ±‚è§£é«˜ç²¾åº¦ç­”æ¡ˆ</li></ol><h2 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h2><ul><li><p>å‰ç½®æ€è€ƒï¼šè®¾ç½®çŠ¶æ€ï¼ˆ<strong>å˜é‡è¶Šå¤šï¼Œç»´åº¦è¶Šé«˜ï¼›æ ¹æ®æœ€åä¸€æ­¥æ¨æµ‹</strong>ï¼‰ï¼›æœ‰æ— <strong>åæ•ˆæ€§</strong>ï¼ˆå³æŸä¸€ç‰¹å®šçŠ¶æ€è½¬ç§»æ—¶ï¼Œæ˜¯å¦å—å‰ç½®çŠ¶æ€çš„æ¡ä»¶çº¦æŸï¼‰ï¼›è¾¹ç•Œåˆ¤æ–­ã€åˆå§‹åŒ–</p></li><li><p>çº¿æ€§åŠ¨æ€è§„åˆ’ </p><p><strong>å­åºåˆ—ï¼ˆä¸ä¸€å®šè¿ç»­ï¼‰ï¼šdp[i]è¡¨ç¤ºè€ƒè™‘å‰iä¸ªå…ƒç´ â€¦</strong></p><p><strong>å­ä¸²ã€å­æ•°ç»„ï¼ˆè¿ç»­ï¼‰ï¼šdp[i]è¡¨ç¤ºä»¥ç¬¬iä¸ªå…ƒç´ ç»“å°¾â€¦</strong></p><p><strong>æœ‰æ­£è´Ÿã€ä¸Šå‡ä¸‹é™ç­‰ï¼š0ï¼Œ1åŒºåˆ†ï¼Œè¿›è¡Œè½¬ç§»</strong></p><p>ç›®å‰å‘ç°ç‰¹ä¾‹ <em>æœ€é•¿ä¸Šå‡å­åºåˆ—</em></p></li><li><p><strong>é—«æ°DPåˆ†æ</strong></p><p><img src="/Blog/img/91996e0c978552cd355532b2369211f5.jpg" alt="4B8264F9FC5BA563A2B3B5A16981A353.jpg"></p></li><li><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong> çŠ¶æ€ä¸ªæ•° * è½¬ç§»ä¸ªæ•°</p></li></ul><br/><h3 id="èƒŒåŒ…é—®é¢˜"><a href="#èƒŒåŒ…é—®é¢˜" class="headerlink" title="èƒŒåŒ…é—®é¢˜"></a>èƒŒåŒ…é—®é¢˜</h3><p>å¸¸ç”¨$dp[i][j]$è¡¨ç¤º<strong>å‰iä¸ªç‰©å“åœ¨å®¹é‡ä¸è¶…j</strong>çš„æƒ…å†µä¸‹çš„æœ€å¤§ä»·å€¼</p><ol><li><p><strong>01èƒŒåŒ…</strong></p><p>å¼ºè°ƒ<strong>æ¯ä»¶ç‰©å“åªèƒ½é€‰æ‹©ä¸€æ¬¡</strong>ï¼Œä¸€ç»´ç©ºé—´ä¼˜åŒ–æ—¶<strong>ä»å¤§åˆ°å°</strong>éå†</p></li><li><p><strong>å®Œå…¨èƒŒåŒ…</strong></p><p>å¼ºè°ƒ<strong>æ¯ä»¶ç‰©å“å¯ä»¥æ— é™é€‰æ‹©</strong></p><p>ä¸€ç»´ç©ºé—´ä¼˜åŒ–æ—¶ï¼Œé€šè¿‡æ¢å…ƒå¯è¾¾åˆ°é™ä½æ—¶é—´å¤æ‚åº¦çš„æ•ˆæœï¼Œä½†è¦<strong>ä»å°åˆ°å¤§</strong>éå†</p></li><li><p><strong>å¤šé‡èƒŒåŒ…</strong></p><p>å¼ºè°ƒ<strong>æ¯ä»¶ç‰©å“åªèƒ½é€‰æœ‰é™æ¬¡</strong></p><p> ä¸€ç»´ç©ºé—´ä¼˜åŒ–æœ‰ï¼š</p></li><li><p>äºŒè¿›åˆ¶ä¼˜åŒ– (é€€åŒ–ä¸º01èƒŒåŒ…)ã€</p><p><strong>e.g. å®¹é‡1ä»·å€¼1 æœ‰7ä¸ª -&gt; å®¹é‡1ä»·å€¼1+å®¹é‡2ä»·å€¼2+å®¹é‡4ä»·å€¼4</strong></p></li><li><p><strong>å•è°ƒé˜Ÿåˆ—</strong>ä¼˜åŒ– æŒ‰ä½™æ•°ä»å°åˆ°å¤§éå†</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å•è°ƒé˜Ÿåˆ—ç»´æŠ¤</span></span><br><span class="line"><span class="comment">//æ§åˆ¶é˜Ÿåˆ—å¤§å°-&gt;æ ¹æ®é˜Ÿåˆ—ç»´æŠ¤çš„æœ€å€¼æ¥è¿›è¡Œæ“ä½œ e.g. dp -&gt;æ›´æ–°é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="comment">//æ•°é‡s,ä½“ç§¯v,ä»·å€¼w</span></span><br><span class="line">  <span class="comment">//æœ‰Nä¸ªç‰©å“,æ±‚åœ¨Cçš„ç©ºé—´å†…çš„æœ€å¤§ä»·å€¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxValue</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> C, <span class="type">int</span>[] s, <span class="type">int</span>[] v, <span class="type">int</span>[] w)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[C + <span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span>[] g = <span class="keyword">new</span> <span class="title class_">int</span>[C + <span class="number">1</span>]; <span class="comment">// è®°å½•ä¸Šä¸€æ¬¡çš„ç»“æœ</span></span><br><span class="line">        <span class="type">int</span>[] q = <span class="keyword">new</span> <span class="title class_">int</span>[C + <span class="number">1</span>]; <span class="comment">// ä¼˜å…ˆé˜Ÿåˆ—ï¼ŒåŠ¨æ€ç»´æŠ¤ æ½œåŠ›ä»å¤§åˆ°å°çš„!å®¹é‡!</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æšä¸¾ç‰©å“</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">vi</span> <span class="operator">=</span> v[i];</span><br><span class="line">            <span class="type">int</span> <span class="variable">wi</span> <span class="operator">=</span> w[i];</span><br><span class="line">            <span class="type">int</span> <span class="variable">si</span> <span class="operator">=</span> s[i];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†ä¸Šæ¬¡ç®—çš„ç»“æœå­˜å…¥è¾…åŠ©æ•°ç»„ä¸­</span></span><br><span class="line">            g = dp.clone();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æšä¸¾ä½™æ•°</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; vi; j++) &#123;</span><br><span class="line">                <span class="comment">// åˆå§‹åŒ–é˜Ÿåˆ—ï¼Œhead å’Œ tail åˆ†åˆ«æŒ‡å‘é˜Ÿåˆ—å¤´éƒ¨å’Œå°¾éƒ¨</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">head</span> <span class="operator">=</span> <span class="number">0</span>, tail = -<span class="number">1</span>;</span><br><span class="line">                <span class="comment">// æšä¸¾åŒä¸€ä½™æ•°æƒ…å†µä¸‹ï¼Œæœ‰å¤šå°‘ç§æ–¹æ¡ˆã€‚</span></span><br><span class="line">                <span class="comment">// ä¾‹å¦‚ä½™æ•°ä¸º 1 çš„æƒ…å†µä¸‹æœ‰ï¼š1ã€vi + 1ã€2 * vi + 1ã€3 * vi + 1 ...</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> j; k &lt;= C; k+=vi) &#123;</span><br><span class="line">                    dp[k] = g[k];</span><br><span class="line">                    <span class="comment">// å°†ä¸åœ¨çª—å£èŒƒå›´å†…çš„å€¼å¼¹å‡º</span></span><br><span class="line">                    <span class="keyword">if</span> (head &lt;= tail &amp;&amp; q[head] &lt; k - si * vi) head++;</span><br><span class="line">                    <span class="comment">// å¦‚æœé˜Ÿåˆ—ä¸­å­˜åœ¨å…ƒç´ ï¼Œç›´æ¥ä½¿ç”¨é˜Ÿå¤´æ¥æ›´æ–°</span></span><br><span class="line">                    <span class="keyword">if</span> (head &lt;= tail) dp[k] = Math.max(dp[k], g[q[head]] + (k - q[head]) / vi * wi);</span><br><span class="line">                    <span class="comment">// å½“å‰å€¼æ¯”å¯¹å°¾å€¼æ›´ä¼˜ï¼Œé˜Ÿå°¾å…ƒç´ æ²¡æœ‰å­˜åœ¨å¿…è¦ï¼Œé˜Ÿå°¾å‡ºé˜Ÿ</span></span><br><span class="line">                    <span class="comment">// ç”¨å‡æ³• è¡¨æ˜ä¸¤è€…éƒ½æ˜¯ä»dp[k]è½¬ç§»è€Œæ¥</span></span><br><span class="line">                    <span class="keyword">while</span> (head &lt;= tail &amp;&amp; g[q[tail]] - (q[tail] - j) / vi * wi &lt;= g[k] - (k - j) / vi * wi) tail--;</span><br><span class="line">                    <span class="comment">// å°†æ–°ä¸‹æ ‡å…¥é˜Ÿ </span></span><br><span class="line">                    q[++tail] = k;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[C];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><p><strong>åˆ†ç»„èƒŒåŒ…</strong></p><p>å¼ºè°ƒ<strong>æ¯ç»„ç‰©å“ä¸­åªèƒ½é€‰ä¸€ä¸ªç‰©å“</strong>ï¼Œå› æ­¤ä»¥å½“å‰è¿™ä¸€ç»„ç‰©å“ä¸­é€‰å“ªä¸ªç‰©å“ä½œä¸ºåˆ’åˆ†å­é›†çš„ä¾æ®ï¼Œè¿›è¡ŒçŠ¶æ€è½¬ç§»</p></li></ol><br/><h3 id="æ•°å­—ä¸‰è§’å½¢dp"><a href="#æ•°å­—ä¸‰è§’å½¢dp" class="headerlink" title="æ•°å­—ä¸‰è§’å½¢dp"></a>æ•°å­—ä¸‰è§’å½¢dp</h3><p>äºŒç»´æ•°ç»„ï¼Œå·¦ä¸Šåˆ°å³ä¸‹ï¼Œæ±‚è·¯å¾„æœ€å¤§å€¼</p><p><strong>ç°åœ¨æ‰©å±•åˆ°ä¸¤æ¡è·¯å¾„ï¼Œä½†ä¸€ä¸ªæ–¹æ ¼çš„æ•°åªèƒ½å–ä¸€æ¬¡ï¼Œæ±‚è·¯å¾„æœ€å¤§å€¼</strong></p><p>çŠ¶æ€è®¾ç½®<code>f[i1, j1, i2, j2]</code>ï¼Œä»£è¡¨ä¸¤æ¡è·¯å¾„å½“å‰åœç•™çš„ä½ç½®ï¼Œæ¯æ¡è·¯å¾„å¯ä»ä¸Šã€å·¦ä¸¤æ–¹å‘è½¬ç§»ï¼Œå› æ­¤<strong>ä¸¤æ¡è·¯å¾„ä¸‹</strong>æœ‰<strong>å››ç§</strong>è½¬ç§»çŠ¶æ€ã€‚</p><p>å¦‚ä½•è§£å†³æ‰€èµ°æ–¹æ ¼ä¼šä¸ä¼šé‡å¤ï¼Ÿå½“<code>i1+j1=i2+j2</code>æˆç«‹æ—¶ï¼Œä¸¤æ¡è·¯å¾„çš„å½“å‰åœç•™ä½ç½®<strong>å¯èƒ½</strong>é‡å¤ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™ä¸¤æ¡è·¯å¾„<strong>åŒæ—¶</strong>ä»å·¦ä¸Šå‡ºå‘ï¼Œæ­¥é¢‘ä¸€è‡´ï¼Œé‚£ä¹ˆçŠ¶æ€å¯ç®€åŒ–ä¸º<code>f[k, i1, i2]</code>ï¼Œå…¶ä¸­<code>k=i1+j1</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çŠ¶æ€è½¬ç§»æ–¹ç¨‹</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">2</span>; k &lt;= <span class="number">2</span>*n; k++)&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">1</span>; i1 &lt;= n; i1++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">1</span>; i2 &lt;= n; i2++)&#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">j1</span> <span class="operator">=</span> k-i1, j2 = k-i2;</span><br><span class="line">        <span class="keyword">if</span>(j1 &gt;= <span class="number">1</span> &amp;&amp; j1 &lt;= n &amp;&amp; j2 &gt;= <span class="number">1</span> &amp;&amp; j2 &lt;= n)&#123;</span><br><span class="line">          <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> w[i1][k-i1];</span><br><span class="line">          <span class="comment">//ä¸é‡å¤</span></span><br><span class="line">          <span class="keyword">if</span>(i1 != i2) t += w[i2][k-i2];</span><br><span class="line">          <span class="comment">//ä¸‹ ä¸‹</span></span><br><span class="line">          f[k][i1][i2] = f[k-<span class="number">1</span>][i1-<span class="number">1</span>][i2-<span class="number">1</span>]+t;</span><br><span class="line">          <span class="comment">//ä¸‹ å·¦</span></span><br><span class="line">          f[k][i1][i2] = Math.max(f[k][i1][i2], f[k-<span class="number">1</span>][i1-<span class="number">1</span>][i2]+t);</span><br><span class="line">          <span class="comment">//...</span></span><br><span class="line">          <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">f[<span class="number">2</span>*n][n][n];</span><br></pre></td></tr></table></figure><br/><h3 id="çŠ¶å‹dp"><a href="#çŠ¶å‹dp" class="headerlink" title="çŠ¶å‹dp"></a>çŠ¶å‹dp</h3><p>**tipï¼š**å½“ç»“æœéœ€è¦å¤šä¸ªç»Ÿè®¡<code>f[][]</code>çš„å€¼æ—¶ï¼Œä¸å¦¨è®©<code>f</code>çš„ç¬¬ä¸€ä¸ªç»´åº¦<code>+1</code>ï¼Œç„¶åç»“æœç›´æ¥å¯ä»¥æ˜¯<code>f[n+1][]</code></p><br/><h3 id="åŒºé—´dp"><a href="#åŒºé—´dp" class="headerlink" title="åŒºé—´dp"></a>åŒºé—´dp</h3><p><strong>tipï¼š<strong>è‹¥åŒºé—´ä¸º</strong>ç¯</strong>ï¼Œå¯å°†ç¯å±•å¼€ä¸ºé“¾ï¼Œå¹¶å°†é“¾é•¿æ‰©å±•ä¸€å€</p><br/><h3 id="æ ‘å½¢dp"><a href="#æ ‘å½¢dp" class="headerlink" title="æ ‘å½¢dp"></a>æ ‘å½¢dp</h3><blockquote><p>æ‰¾æ ‘çš„ç›´å¾„ï¼ˆè¾¹æƒå‡ä¸ºæ­£ï¼‰</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. ä»»å–ä¸€ç‚¹åšä¸ºèµ·ç‚¹ï¼Œæ‰¾åˆ°è·ç¦»è¯¥ç‚¹æœ€è¿œçš„ä¸€ä¸ªç‚¹u</span><br><span class="line">(å¯è¯æ˜è¯¥ç‚¹ä¸€å®šæ˜¯æŸæ¡ç›´å¾„çš„ç«¯ç‚¹)</span><br><span class="line">2. å†æ‰¾åˆ°è·ç¦»uçš„æœ€è¿œçš„ä¸€ç‚¹</span><br></pre></td></tr></table></figure><p><strong>è‹¥åŒ…å«è´Ÿæƒè¾¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åº”è¯¥æšä¸¾å…¨éƒ¨è·¯å¾„ï¼Œæ‰¾å‡ºæœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="comment">//  å°†æ‰€æœ‰è·¯å¾„æŒ‰ç‚¹åˆ†ç±»(ç‚¹å¯è§†ä¸ºæ ¹ï¼Œå› ä¸ºå›¾ä¸ºæ— å‘å›¾ï¼Œæ‰€ä»¥æ¯ä¸ªç‚¹éƒ½å¯ä½œä¸ºæ ¹)</span></span><br><span class="line"><span class="comment">//  é‚£ä¹ˆæšä¸¾æ‰€æœ‰ç‚¹ï¼Œå¯¹äºæ¯ä¸ªç‚¹å†æšä¸¾ä»¥å…¶ä¸ºæ ¹çš„æ ‘çš„ç›´å¾„å³å¯</span></span><br><span class="line">dfs(<span class="type">int</span> node, <span class="type">int</span> fa)&#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">dist</span> <span class="operator">=</span> <span class="number">0</span>;     <span class="comment">//è¡¨ç¤ºå‘ä¸‹èµ°çš„æœ€é•¿è·ç¦»</span></span><br><span class="line">  <span class="type">int</span> <span class="variable">d1</span> <span class="operator">=</span> <span class="number">0</span>, d2 = <span class="number">0</span>    <span class="comment">//æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="comment">/*éå†nodeçš„æ¯ä¸€ä¸ªç›¸é‚»èŠ‚ç‚¹ snode*/</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(snode == fa) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> dfs(snode, node) + <span class="comment">/*node -&gt; snode çš„è·ç¦»*/</span></span><br><span class="line">    dist = Math.max(dist, d);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(d &gt;= d1) d2 = d1, d1 = d;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(d &gt; d2) d2 = d;</span><br><span class="line">  &#125;</span><br><span class="line">  ans = Math.max(ans, d1+d2);     <span class="comment">//d1+d2å³ä¸ºä»¥nodeä¸ºæ ¹çš„æ ‘çš„ç›´å¾„</span></span><br><span class="line">  <span class="keyword">return</span> dist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ¢æ ¹dp</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. æŒ‡å®šä»»æ„ä¸€ä¸ªæ ¹èŠ‚ç‚¹</span><br><span class="line">2. ä¸€æ¬¡dfséå†ï¼Œç»Ÿè®¡å‡ºå½“å‰å­æ ‘å†…çš„èŠ‚ç‚¹å¯¹å½“å‰èŠ‚ç‚¹çš„è´¡çŒ®</span><br><span class="line">3. ä¸€æ¬¡dfséå†ï¼Œç»Ÿè®¡å‡ºå½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å¯¹å½“å‰èŠ‚ç‚¹çš„è´¡çŒ®ï¼Œç„¶ååˆå¹¶ç»Ÿè®¡ç­”æ¡ˆ</span><br><span class="line">å…·ä½“é¢˜ç›®è§&lt;ç¼–ç¨‹é¢˜&gt;ä¸­çš„&lt;æ ‘çš„ä¸­å¿ƒ&gt;</span><br></pre></td></tr></table></figure><br/><h3 id="å­åºåˆ—"><a href="#å­åºåˆ—" class="headerlink" title="å­åºåˆ—"></a>å­åºåˆ—</h3><p>å¯¹äºä»»æ„ç»™å®šåºåˆ—ï¼Œå…¶<strong>æœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦</strong>ç­‰äºä½¿ç”¨<strong>éä¸Šå‡å­åºåˆ—</strong>å°†æ•´ä¸ªåºåˆ—è¦†ç›–çš„<strong>æœ€å°æ•°é‡</strong>ï¼Œå› ä¸ºä¸¤è€…çš„è´ªå¿ƒåšæ³•å®Œå…¨ç›¸åŒï¼ˆDilworthå®šç†ï¼‰</p><br/><h3 id="æ•°ä½dp"><a href="#æ•°ä½dp" class="headerlink" title="æ•°ä½dp"></a>æ•°ä½dp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//idx å½“å‰åˆ¤æ–­åˆ°å“ªä¸€ä½</span></span><br><span class="line"><span class="comment">//mask æ ‡è®°å“ªäº›å·²ç»ç”¨è¿‡</span></span><br><span class="line"><span class="comment">//isLimit å½“å‰ä½æ˜¯å¦å—åˆ°çº¦æŸ å¦‚æœå‰å‡ ä½å‡å’Œnå‰å‡ ä½ç­‰åŒåˆ™æ”¶åˆ°çº¦æŸï¼Œå¦åˆ™æœ€å¤§å¯9</span></span><br><span class="line"><span class="comment">//isJump æ˜¯å¦å¯ä»¥è·³è¿‡ ç”¨äºé™åˆ¶é¦–å‘æ•°å­—ä¸ä¸º0</span></span><br><span class="line"><span class="comment">//å‡½æ•°è¡¨ç¤º æ„é€ ä»é«˜åˆ°ä½ç¬¬ idx ä½åŠå…¶ä¹‹åæ•°ä½çš„åˆæ³•æ–¹æ¡ˆæ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> idx, <span class="type">int</span> mask, <span class="type">boolean</span> isLimit, <span class="type">boolean</span> isJump)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(idx == s.length) <span class="keyword">return</span> isJump ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//å¯ä»¥è®°å¿†åŒ–æœç´¢çš„æƒ…å†µï¼šä¸å—é™</span></span><br><span class="line">    <span class="comment">//å› ä¸ºå—é™å’Œä¸å—é™çš„æƒ…å†µä¸‹ï¼Œdpå€¼ä¸åŒï¼Œä½†å—é™æƒ…å†µä¸‹dpå€¼å”¯ä¸€</span></span><br><span class="line">    <span class="keyword">if</span>(!isLimit &amp;&amp; <span class="comment">/* !isJump &amp;&amp; */</span>dp[idx][mask] &gt;= <span class="number">0</span>) <span class="keyword">return</span> dp[idx][mask];</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(isJump) res = f(idx+<span class="number">1</span>, mask, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> isJump ? <span class="number">1</span> : <span class="number">0</span>, up = isLimit ? å—é™å€¼ : <span class="number">9</span>; d &lt;= up; d++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(((mask &gt;&gt; d) &amp; <span class="number">1</span>) == <span class="number">0</span>) </span><br><span class="line">            res += f(idx+<span class="number">1</span>, mask|(<span class="number">1</span> &lt;&lt; d), isLimit &amp;&amp; d == up, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¯ä»¥è®°å¿†åŒ–</span></span><br><span class="line">    <span class="keyword">if</span>(!isLimit <span class="comment">/* &amp;&amp; !isJump */</span>) dp[idx][mask] = res;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//ä¼ªä»£ç æ¨¡æ¿</span><br><span class="line">//å¯é€‰å‚æ•°-å…·ä½“é¢˜ç›®å…·ä½“åˆ†æ preï¼šä¸Šä¸€ä½ leadï¼šå‰å¯¼0æ˜¯å¦å­˜åœ¨ </span><br><span class="line">//cnt:æŸäº›æ•°å­—å‡ºç°çš„æ¬¡æ•° sum:æœç´¢åˆ°å½“å‰æŸæ•°å­—ä¹‹å’Œ</span><br><span class="line">int N = æœ€é•¿ä½æ•°;</span><br><span class="line">int dp[N][N], a[N];</span><br><span class="line">int dfs(int pos, /*å¯é€‰å‚æ•° int pre, int lead,*/int limit) &#123;</span><br><span class="line">    if (!pos) &#123;</span><br><span class="line">        è¾¹ç•Œæ¡ä»¶(æœ‰æ—¶ç›´æ¥ return 1)</span><br><span class="line">    &#125;</span><br><span class="line">    if (!limit &amp;&amp; !lead &amp;&amp; dp[pos][pre] != -1) return dp[pos][pre];</span><br><span class="line">    int res = 0, up = limit ? a[pos] : æ— é™åˆ¶ä½;</span><br><span class="line">    for (int i = 0; i &lt;= up; i ++) &#123;</span><br><span class="line">        if (ä¸åˆæ³•æ¡ä»¶) continue;</span><br><span class="line">        res += dfs(pos - 1, æœªå®šå‚æ•°, lead &amp;&amp; !i, limit &amp;&amp; i == up);</span><br><span class="line">    &#125;</span><br><span class="line">    return limit ? res : (lead ? res : dp[pos][sum] = res);</span><br><span class="line">&#125;</span><br><span class="line">int cal(int x) &#123;</span><br><span class="line">    memset(dp, -1, sizeof dp);    </span><br><span class="line">    len = 0;</span><br><span class="line">    while (x) a[++ len] = x % è¿›åˆ¶, x /= è¿›åˆ¶;</span><br><span class="line">    return dfs(len, æœªå®šå‚æ•°, 1, 1);</span><br><span class="line">&#125;</span><br><span class="line">signed main() &#123;</span><br><span class="line">    cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">    cout &lt;&lt; cal(r) - cal(l - 1) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š</strong> æ•°ä½dpç»å¸¸ç”¨äº<strong>çŠ¶æ€å‹ç¼©</strong>ï¼Œæ­¤æ—¶ä¸å†æ˜¯çº¿æ€§dpï¼Œå¾ˆéš¾ç”¨forå¾ªç¯éå†ï¼ˆåŠ¨æ€è§„åˆ’æœ¬è´¨ä¸Šæ˜¯æ±‚è§£çš„ä¸€ç§<strong>æ‹“æ‰‘åº</strong>ï¼‰ï¼Œå› æ­¤å°±ç”¨åˆ°<strong>è®°å¿†åŒ–æœç´¢</strong>(e.g. LCP69)</p><h2 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h2><h3 id="Morriséå†"><a href="#Morriséå†" class="headerlink" title="Morriséå†"></a>Morriséå†</h3><p>åœ¨è¿­ä»£ç‰ˆçš„å‰ã€ä¸­ã€ååºéå†ä¸­ï¼Œå¼¹æ ˆçš„ç›®çš„å°±æ˜¯æ‰¾åˆ°å½“å‰èŠ‚ç‚¹çš„â€œåç»­â€èŠ‚ç‚¹ã€‚è€ŒMorrisç®—æ³•ï¼Œå°±æ˜¯åœ¨éå†çš„è¿‡ç¨‹ä¸­**â€œçº¿ç´¢åŒ–â€**ï¼Œä»è€Œä¼˜åŒ–äº†æ ˆç©ºé—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»¥Morrisä¸­åºéå†ä¸ºä¾‹</span></span><br><span class="line"><span class="comment">//çº¿ç´¢åŒ–ï¼šæ‰¾predecessor --&gt; predecessor.right = root</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode cur)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">predecessor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// predecessor èŠ‚ç‚¹å°±æ˜¯å½“å‰ cur èŠ‚ç‚¹å‘å·¦èµ°ä¸€æ­¥ï¼Œç„¶åä¸€ç›´å‘å³èµ°è‡³æ— æ³•èµ°ä¸ºæ­¢</span></span><br><span class="line">                predecessor = cur.left;</span><br><span class="line">                <span class="keyword">while</span> (predecessor.right != <span class="literal">null</span> &amp;&amp; predecessor.right != cur) &#123;</span><br><span class="line">                    predecessor = predecessor.right;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// è®© predecessor çš„å³æŒ‡é’ˆæŒ‡å‘ rootï¼Œç»§ç»­éå†å·¦å­æ ‘</span></span><br><span class="line">                <span class="keyword">if</span> (predecessor.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                    predecessor.right = cur;</span><br><span class="line">                    cur = cur.left;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è¯´æ˜å·¦å­æ ‘å·²ç»è®¿é—®å®Œäº†ï¼Œæˆ‘ä»¬éœ€è¦æ–­å¼€é“¾æ¥</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    res.add(cur.val);</span><br><span class="line">                    predecessor.right = <span class="literal">null</span>;</span><br><span class="line">                    cur = cur.right;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœæ²¡æœ‰å·¦å­©å­ï¼Œåˆ™ç›´æ¥è®¿é—®å³å­©å­</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res.add(cur.val);</span><br><span class="line">                cur = cur.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—å…¸æ ‘-Trie"><a href="#å­—å…¸æ ‘-Trie" class="headerlink" title="å­—å…¸æ ‘ Trie"></a>å­—å…¸æ ‘ Trie</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Trie</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Trie[] children;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isEnd;</span><br><span class="line">    <span class="comment">//è¿˜å¯ä»¥æ·»åŠ wordå­—æ®µ </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Trie</span><span class="params">()</span> &#123;</span><br><span class="line">        children = <span class="keyword">new</span> <span class="title class_">Trie</span>[<span class="number">26</span>];</span><br><span class="line">        isEnd = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="type">Trie</span> <span class="variable">node</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; word.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> word.charAt(i);</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> ch - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (node.children[index] == <span class="literal">null</span>) &#123;</span><br><span class="line">                node.children[index] = <span class="keyword">new</span> <span class="title class_">Trie</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            node = node.children[index];</span><br><span class="line">        &#125;</span><br><span class="line">        node.isEnd = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">search</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="type">Trie</span> <span class="variable">node</span> <span class="operator">=</span> searchPrefix(word);</span><br><span class="line">        <span class="keyword">return</span> node != <span class="literal">null</span> &amp;&amp; node.isEnd;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">startsWith</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> searchPrefix(prefix) != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é¿å…æŸ¥æ‰¾å’ŒæŸ¥å¤´çš„ä»£ç é‡å¤</span></span><br><span class="line">    <span class="keyword">private</span> Trie <span class="title function_">searchPrefix</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">        <span class="type">Trie</span> <span class="variable">node</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; prefix.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> prefix.charAt(i);</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> ch - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (node.children[index] == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            node = node.children[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š<strong>ä¸»è¦ç”¨äº</strong>å¤„ç†å‰ç¼€</strong>ä»¥åŠè¯é¢‘ç»Ÿè®¡</p><p><strong>æ˜“é”™ï¼š</strong> å­˜åœ¨wordå­—æ®µ å¹¶åœ¨insert()ä¸­è¦ä¿®æ”¹å®ƒæ—¶ï¼Œåˆ‡è®°ä¿®æ”¹çš„æ˜¯å½“å‰èŠ‚ç‚¹çš„wordå­—æ®µï¼Œå†™æ³•åº”è¯¥æ˜¯<code>node.word = ...</code> ï¼Œå®¹æ˜“é”™å†™ä¸º<code>word = ...</code></p><br/><h2 id="å›¾è®º"><a href="#å›¾è®º" class="headerlink" title="å›¾è®º"></a>å›¾è®º</h2><h3 id="é‚»æ¥è¡¨å­˜å‚¨-ä¸‰æ•°ç»„"><a href="#é‚»æ¥è¡¨å­˜å‚¨-ä¸‰æ•°ç»„" class="headerlink" title="é‚»æ¥è¡¨å­˜å‚¨(ä¸‰æ•°ç»„)"></a>é‚»æ¥è¡¨å­˜å‚¨(ä¸‰æ•°ç»„)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AdjacencyList</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] e, next, head;</span><br><span class="line">    <span class="type">boolean</span>[] v;</span><br><span class="line">    <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>, n;            <span class="comment">//ä»…ä»£è¡¨å½“å‰æ•°ç»„å­˜æ”¾çš„ä¸‹æ ‡ï¼Œä¸nodeå€¼æ— å…³</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//nä¸ªèŠ‚ç‚¹ ï¼š1-n</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AdjacencyList</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">        <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> n+<span class="number">5</span>;</span><br><span class="line">        e = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>*N];      <span class="comment">//e[idx]=node</span></span><br><span class="line">        next = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>*N];    <span class="comment">//next[idx] = idx2</span></span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">int</span>[N];    <span class="comment">//head[node] = idx</span></span><br><span class="line">        v = <span class="keyword">new</span> <span class="title class_">boolean</span>[N];</span><br><span class="line">        </span><br><span class="line">        Arrays.fill(head, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ è¾¹ n1-&gt;n2</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> n1, <span class="type">int</span> n2)</span>&#123;</span><br><span class="line">        e[idx] = n2;</span><br><span class="line">        next[idx] = head[n1];       <span class="comment">//å‘å¤´æ·»åŠ </span></span><br><span class="line">        head[n1] = idx++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> node)</span>&#123;</span><br><span class="line">        v[node] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> head[node]; i != -<span class="number">1</span>; i = next[i])&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">node2</span> <span class="operator">=</span> e[i];</span><br><span class="line">            <span class="keyword">if</span>(!v[node2])&#123;</span><br><span class="line">                <span class="comment">//......</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‹“æ‰‘åº"><a href="#æ‹“æ‰‘åº" class="headerlink" title="æ‹“æ‰‘åº"></a>æ‹“æ‰‘åº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¥ä¸Š</span></span><br><span class="line"><span class="comment">//q[] æ¨¡æ‹Ÿé˜Ÿåˆ—  d[node]ä»£è¡¨èŠ‚ç‚¹å…¥åº¦</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰æ‹“æ‰‘åº  æ‰§è¡Œå®Œqä¸­åºåˆ—å³ä¸ºæ‹“æ‰‘åº(å¦‚æœæœ‰çš„è¯)</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">topoSort</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">hh</span> <span class="operator">=</span> <span class="number">0</span>, tt = -<span class="number">1</span>;        <span class="comment">//é˜Ÿå¤´é˜Ÿå°¾</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(d[n] == <span class="number">0</span>) q[++tt] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(hh &lt;= tt)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> q[hh++];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> head[t]; i != -<span class="number">1</span>; i = next[i])&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">node</span> <span class="operator">=</span> e[i];</span><br><span class="line">            d[node]--;</span><br><span class="line">            <span class="keyword">if</span>(d[node] == <span class="number">0</span>) q[++tt] = node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tt == n-<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ€çŸ­è·¯é—®é¢˜"><a href="#æœ€çŸ­è·¯é—®é¢˜" class="headerlink" title="æœ€çŸ­è·¯é—®é¢˜"></a>æœ€çŸ­è·¯é—®é¢˜</h3><p><img src="/Blog/img/1e1e6cd6cf3298e009c6e8fb2fbc7ab7.jpg" alt="IMG_20230327_201754.jpg"></p><h3 id="Dijkstra"><a href="#Dijkstra" class="headerlink" title="Dijkstra"></a>Dijkstra</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€‚ç”¨äºç¨ å¯†å›¾</span></span><br><span class="line"><span class="type">int</span>[][] g;  <span class="comment">// å­˜å‚¨æ¯æ¡è¾¹</span></span><br><span class="line"><span class="type">int</span>[] dist;  <span class="comment">// å­˜å‚¨1å·ç‚¹åˆ°æ¯ä¸ªç‚¹çš„æœ€çŸ­è·ç¦»</span></span><br><span class="line"><span class="type">boolean</span>[] st;   <span class="comment">// å­˜å‚¨æ¯ä¸ªç‚¹çš„æœ€çŸ­è·¯æ˜¯å¦å·²ç»ç¡®å®š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ±‚1å·ç‚¹åˆ°nå·ç‚¹çš„æœ€çŸ­è·¯ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›-1</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">dijkstra</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    Arrays.fill(dist, <span class="number">0x3f3f3f3f</span>);</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> -<span class="number">1</span>;     <span class="comment">// åœ¨è¿˜æœªç¡®å®šæœ€çŸ­è·¯çš„ç‚¹ä¸­ï¼Œå¯»æ‰¾è·ç¦»æœ€å°çš„ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j ++ )</span><br><span class="line">            <span class="keyword">if</span> (!st[j] &amp;&amp; (t == -<span class="number">1</span> || dist[t] &gt; dist[j]))</span><br><span class="line">                t = j;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨tæ›´æ–°å…¶ä»–ç‚¹çš„è·ç¦»</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j ++ )</span><br><span class="line">            dist[j] = Math.min(dist[j], dist[t] + g[t][j]);</span><br><span class="line"></span><br><span class="line">        st[t] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dist[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€»å¾—æ¥çœ‹ï¼Œå¯»æ‰¾æœ€å°ç‚¹éœ€è¦</strong>$O(n^2)$ï¼Œ<strong>æ›´æ–°èŠ‚ç‚¹è·ç¦»éœ€è¦</strong>$O(m)$ï¼Œå› æ­¤åœ¨é¢å¯¹<strong>ç¨€ç–å›¾</strong>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—æé«˜å¯»æ‰¾æœ€å°ç‚¹çš„é€Ÿåº¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, idx;      <span class="comment">// ç‚¹çš„æ•°é‡</span></span><br><span class="line"><span class="type">int</span>[] h, w, e, ne;       <span class="comment">// é‚»æ¥è¡¨å­˜å‚¨æ‰€æœ‰è¾¹</span></span><br><span class="line"><span class="type">int</span>[] dist;        <span class="comment">// å­˜å‚¨æ‰€æœ‰ç‚¹åˆ°1å·ç‚¹çš„è·ç¦»</span></span><br><span class="line"><span class="type">boolean</span>[] st;     <span class="comment">// å­˜å‚¨æ¯ä¸ªç‚¹çš„æœ€çŸ­è·ç¦»æ˜¯å¦å·²ç¡®å®š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ±‚1å·ç‚¹åˆ°nå·ç‚¹çš„æœ€çŸ­è·ç¦»ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›-1</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">dijkstra</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    Arrays.fill(dist, <span class="number">0x3f3f3f3f</span>);</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; heap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a, b) -&gt; a[<span class="number">0</span>]-b[<span class="number">0</span>]);</span><br><span class="line">    heap.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">1</span>&#125;);      <span class="comment">// firstå­˜å‚¨è·ç¦»ï¼Œsecondå­˜å‚¨èŠ‚ç‚¹ç¼–å·</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!heap.isEmpty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span>[] t = heap.poll();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">ver</span> <span class="operator">=</span> t[<span class="number">1</span>], distance = t[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(ver == n) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (st[ver]) <span class="keyword">continue</span>;</span><br><span class="line">        st[ver] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> h[ver]; i != -<span class="number">1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> e[i];</span><br><span class="line">            <span class="keyword">if</span> (dist[j] &gt; distance + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                dist[j] = distance + w[i];</span><br><span class="line">                heap.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;dist[j], j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dist[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Bellman-ford"><a href="#Bellman-ford" class="headerlink" title="Bellman-ford"></a>Bellman-ford</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”±äºä¸éœ€è¦ç”¨ä¸åˆ°è¾¹ä¸è¾¹çš„å…³ç³»ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªå¤šç»´æ•°ç»„æˆ–è€…ç±»æ¥å­˜å‚¨</span></span><br><span class="line"><span class="comment">//è¿™é‡Œä»ç„¶ç”¨é‚»æ¥è¡¨å­˜å‚¨</span></span><br><span class="line"><span class="type">int</span>[] e, ne, h, w, dist;</span><br><span class="line"><span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>, n, m, k;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">Bellmanford</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//éå†kæ¬¡ æ¯éå†ä¸€æ¬¡å»¶ç”³ä¸€æ¬¡</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++)&#123;</span><br><span class="line">      <span class="comment">//é˜²æ­¢ä¸²è”ç°è±¡(ä¸€æ¬¡éå†ä¸­å»¶ç”³äº†å¤šæ¬¡)</span></span><br><span class="line">      <span class="type">int</span>[] dist2 = Arrays.copyOf(dist, n+<span class="number">5</span>);</span><br><span class="line">      <span class="comment">//æ¯æ¬¡éƒ½éå†ä¸€éæ‰€æœ‰è¾¹</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="number">1</span>; n1 &lt;= n; n1++)&#123;</span><br><span class="line">          <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> h[n1]; j != -<span class="number">1</span>; j = ne[j])&#123;</span><br><span class="line">              <span class="type">int</span> <span class="variable">n2</span> <span class="operator">=</span> e[j], del = w[j];</span><br><span class="line">              <span class="keyword">if</span>(dist[n2] &gt; dist2[n1]+del)&#123;</span><br><span class="line">                  dist[n2] = dist2[n1]+del;</span><br><span class="line">              &#125; </span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="comment">//å› ä¸ºæœ‰è´Ÿæƒè¾¹ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡è¿”å›-1æ¥åˆ¤æ–­æ‰¾åˆ°ä¸å¦</span></span><br><span class="line">  <span class="keyword">if</span>(dist[n] &gt; <span class="number">0x3f3f3f3f</span>/<span class="number">2</span>) System.out.println(<span class="string">&quot;impossible&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SPFA"><a href="#SPFA" class="headerlink" title="SPFA"></a>SPFA</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŸºäºBellman-Ford,æˆ‘ä»¬æƒ³åˆ°æ¯æ¬¡ä¸éœ€è¦éå†æ‰€æœ‰çš„è¾¹</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨é˜Ÿåˆ—ï¼Œéå†é‚£äº›åˆšæ›´æ–°è¿‡å€¼çš„è¾¹çš„åç»§ï¼Œè¿™ä¾¿æ˜¯å®½æœä¼˜åŒ–</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">spfa</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    Arrays.fill(dist, <span class="number">0x3f3f3f3f</span>);</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    Queue&lt;Integer&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    q.add(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!q.isEmpty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> q.poll();</span><br><span class="line">        st[v] = <span class="literal">false</span>;      <span class="comment">//è¡¨ç¤ºå½“å‰ç‚¹æ˜¯å¦åœ¨é˜Ÿåˆ—ä¸­ï¼ŒDijkstraä¸­ä»£è¡¨æ˜¯å¦åœ¨æœ€çŸ­é›†ä¸­</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> h[v]; i != -<span class="number">1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> e[i];</span><br><span class="line">            <span class="keyword">if</span> (dist[j] &gt; dist[v] + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                dist[j] = dist[v] + w[i];</span><br><span class="line">                <span class="keyword">if</span>(!st[j])&#123;</span><br><span class="line">                    q.offer(j);</span><br><span class="line">                    st[j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dist[n] == <span class="number">0x3f3f3f3f</span>) System.out.println(<span class="string">&quot;impossible&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> System.out.println(dist[n]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é€šè¿‡SPFAåˆ¤æ–­è´Ÿç¯ï¼š</strong> å¦å¼€è¾Ÿæ•°ç»„<code>cnt</code>ï¼Œè®°å½•ä»æºç‚¹åˆ°è¾¾å½“å‰ç‚¹æ‰€ç»è¿‡çš„<strong>è·¯å¾„æ•°</strong>ï¼Œå½“ä¸”åªå½“<code>dist</code>æ›´æ–°æ—¶æ‰æ›´æ–°<code>cnt</code>ã€‚å› æ­¤å¦‚æœå‡ºç°<code>cnt</code>ä¸­æŸä¸ªå€¼å¤§äº<strong>æ€»ç‚¹æ•°</strong>ï¼Œæ ¹æ®å®¹æ–¥åŸç†ï¼Œå¿…ç„¶å­˜åœ¨è´Ÿç¯ã€‚</p><h3 id="Floyd"><a href="#Floyd" class="headerlink" title="Floyd"></a>Floyd</h3><p><strong>æ€æƒ³ï¼š</strong> åŸºäºåŠ¨æ€è§„åˆ’ï¼Œ<code>d[k][i][j]</code>è¡¨ç¤ºåœ¨åªç»è¿‡å‰<code>k</code>ä¸ªèŠ‚ç‚¹æ‰€æ„æˆçš„è·¯å¾„çš„å‰æä¸‹ï¼Œä»èŠ‚ç‚¹<code>i</code>åˆ°èŠ‚ç‚¹<code>j</code>çš„æœ€çŸ­è·ç¦»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¼˜åŒ–æœ€é«˜ç»´</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">1</span>; k &lt;= n; k++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(d[i][j] &gt; d[i][k]+d[k][j]) d[i][j] = d[i][k]+d[k][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h3><p><img src="/Blog/img/8f20a5322f5e22b82669ec3724f5d27d.jpg" alt="529c3138e9bb91b0fc0f9e74856df0a.jpg"></p><h3 id="Prim"><a href="#Prim" class="headerlink" title="Prim"></a>Prim</h3><p><strong>æ€æƒ³ï¼š</strong> åŒ<em>dijkstra</em>ï¼Œæ¯æ¬¡éå†éƒ½æ˜¯æ‰¾ä¸€ä¸ªè·ç¦»æœ€è¿‘çš„ç‚¹åŠ å…¥é›†åˆï¼Œä½†æ˜¯è¿™é‡Œçš„è·ç¦»æœ€è¿‘æ˜¯æŒ‡ç‚¹è·ç¦»æ•´ä¸ªé›†åˆçš„è·ç¦»æœ€è¿‘ï¼Œå› æ­¤æ›´æ–°<code>dist[]</code>æ—¶éœ€è¦æ³¨æ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[][] g;      <span class="comment">//è·ç¦»çŸ©é˜µ</span></span><br><span class="line"><span class="type">int</span>[] dist;     <span class="comment">//æ¯ä¸ªç‚¹ä¸é›†åˆçš„è·ç¦»</span></span><br><span class="line"><span class="type">boolean</span>[] st;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">prim</span><span class="params">()</span>&#123;</span><br><span class="line">    Arrays.fill(dist, <span class="number">0x3f3f3f3f</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//æ·»åŠ næ¬¡</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">minv</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!st[j] &amp;&amp; (minv == -<span class="number">1</span> || dist[j] &lt; dist[minv])) minv = j;</span><br><span class="line">        &#125;</span><br><span class="line">        st[minv] = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//æ‰¾ä¸åˆ°åˆé€‚çš„ç‚¹ï¼Œæ— æ³•æ„é€ </span></span><br><span class="line">        <span class="keyword">if</span>(dist[minv] == <span class="number">0x3f3f3f3f</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res += dist[minv];</span><br><span class="line">        <span class="comment">//æœ€åæ›´æ–°è·ç¦»</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++) dist[j] = Math.min(dist[j], g[minv][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Kruskal"><a href="#Kruskal" class="headerlink" title="Kruskal"></a>Kruskal</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">List&lt;<span class="type">int</span>[]&gt; lists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  <span class="comment">//[a-&gt;b, w]</span></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">kruskal</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æŒ‰æƒå€¼ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">    Collections.sort(lists, (a, b)-&gt;a[<span class="number">2</span>]-b[<span class="number">2</span>]);</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>, num = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//éœ€è¦è€ƒè™‘ä¸¤ä¸ªç‚¹æ˜¯å¦åœ¨åŒä¸€ä¸ªè¿é€šå—ä¸­</span></span><br><span class="line">    <span class="type">UnionFind</span> <span class="variable">uset</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UnionFind</span>(n+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++)&#123;</span><br><span class="line">        <span class="type">int</span>[] e = lists.get(i);</span><br><span class="line">        <span class="keyword">if</span>(uset.unite(e[<span class="number">0</span>], e[<span class="number">1</span>]))&#123;</span><br><span class="line">            res += e[<span class="number">2</span>];</span><br><span class="line">            num++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(num &lt; n-<span class="number">1</span>) System.out.println(<span class="string">&quot;impossible&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> System.out.println(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒˆç‰™åˆ©ç®—æ³•ï¼ˆæ±‚äºŒåˆ†å›¾æœ€å¤§åŒ¹é…ï¼‰"><a href="#åŒˆç‰™åˆ©ç®—æ³•ï¼ˆæ±‚äºŒåˆ†å›¾æœ€å¤§åŒ¹é…ï¼‰" class="headerlink" title="åŒˆç‰™åˆ©ç®—æ³•ï¼ˆæ±‚äºŒåˆ†å›¾æœ€å¤§åŒ¹é…ï¼‰"></a>åŒˆç‰™åˆ©ç®—æ³•ï¼ˆæ±‚äºŒåˆ†å›¾æœ€å¤§åŒ¹é…ï¼‰</h3><p><strong>äºŒåˆ†å›¾å½“ä¸”ä»…å½“å›¾ä¸­ä¸å«å¥‡æ•°ç¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] e, ne, h, matches;    <span class="comment">//n2é›†åˆä¸­å…ƒç´ åŒ¹é…åˆ°å“ªä¸ªn1é›†åˆä¸­çš„å…ƒç´ </span></span><br><span class="line"><span class="type">int</span> idx, n1;</span><br><span class="line">Kattio kio;</span><br><span class="line"><span class="type">boolean</span>[] st;   <span class="comment">//å¯¹äºå½“å‰n1é›†åˆä¸­è¿™ä¸ªå…ƒç´ ï¼Œç›¸åº”n2é›†åˆä¸­æŸä¸ªå…ƒç´ æ˜¯å¦è¢«è€ƒè™‘è¿‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hungarian</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n1; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(find(i)) res++;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> u)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> h[u]; i != -<span class="number">1</span>; i = ne[i])&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> e[i];</span><br><span class="line">        <span class="keyword">if</span>(!st[v])&#123;</span><br><span class="line">            st[v] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(matches[v] == <span class="number">0</span> || find(matches[v]))&#123;</span><br><span class="line">                matches[v] = u;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯å‘å¼æœç´¢ï¼šA"><a href="#å¯å‘å¼æœç´¢ï¼šA" class="headerlink" title="å¯å‘å¼æœç´¢ï¼šA*"></a>å¯å‘å¼æœç´¢ï¼šA*</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»¥ç½‘æ ¼å¯»è·¯ä¸ºä¾‹ start-&gt;goal</span></span><br><span class="line">frontier = PriorityQueue()  </span><br><span class="line">frontier.put(start, <span class="number">0</span>)</span><br><span class="line">came_from = <span class="built_in">dict</span>()  <span class="comment">#è®°å½•ç›¸é‚»èŠ‚ç‚¹çš„åˆ°è¾¾å…³ç³»</span></span><br><span class="line">cost_so_far = <span class="built_in">dict</span>()  <span class="comment">#å½“å‰è·¯å¾„ä»£ä»·</span></span><br><span class="line">came_from[start] = <span class="literal">None</span> </span><br><span class="line">cost_so_far[start] = <span class="number">0</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> frontier.empty():</span><br><span class="line">   current = frontier.get()</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> current == goal:  <span class="comment">#ç²¾å¦™çš„ä¸€æ­¥</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">   <span class="comment">#éå†æ‰€æœ‰é‚»å±…(ä¸‹ä¸€ç§æƒ…å†µ)</span></span><br><span class="line">   <span class="keyword">for</span> <span class="built_in">next</span> <span class="keyword">in</span> graph.neighbors(current):</span><br><span class="line">      new_cost = cost_so_far[current] + graph.cost(current, <span class="built_in">next</span>)</span><br><span class="line">      <span class="comment">#æ¯”è¾ƒçš„æ˜¯å½“å‰ä»£ä»·ï¼Œè€Œä¸æ˜¯æ€»ä»£ä»·ï¼ï¼ï¼</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">next</span> <span class="keyword">not</span> <span class="keyword">in</span> cost_so_far <span class="keyword">or</span> new_cost &lt; cost_so_far[<span class="built_in">next</span>]:</span><br><span class="line">         cost_so_far[<span class="built_in">next</span>] = new_cost</span><br><span class="line">         <span class="comment">#æ€»ä»£ä»·ï¼šå½“å‰ä»£ä»·+é¢„ä¼°ä»£ä»·</span></span><br><span class="line">         priority = new_cost + heuristic(goal, <span class="built_in">next</span>)</span><br><span class="line">         frontier.put(<span class="built_in">next</span>, priority)</span><br><span class="line">         came_from[<span class="built_in">next</span>] = current</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¡ç®—é¢„ä¼°ä»£ä»·        </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">heuristic</span>(<span class="params">a, b</span>):</span><br><span class="line">   <span class="comment"># Manhattan distance on a square grid</span></span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">abs</span>(a.x - b.x) + <span class="built_in">abs</span>(a.y - b.y)</span><br><span class="line">   <span class="comment"># Chebyshev Distance</span></span><br><span class="line">   <span class="comment"># return Math.max(b.x, b.y)</span></span><br><span class="line">   <span class="comment"># Euclidean Distance</span></span><br><span class="line">   <span class="comment"># return Math.sqrt(Math.pow(a.x-b.x, 2)+Math.pow(a.y-b.y, 2))</span></span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š</strong> <em>Dijkstra</em> + <em>Greedy Best First Search</em></p><p><strong>A star</strong>ç®—æ³•ä¼˜ç‚¹åœ¨äºå¯¹ç¯å¢ƒååº”è¿…é€Ÿï¼Œæœç´¢è·¯å¾„ç›´æ¥ï¼Œæ˜¯ä¸€ç§ç›´æ¥çš„æœç´¢ç®—æ³•ï¼Œå› æ­¤è¢«å¹¿æ³›åº”ç”¨äºè·¯å¾„è§„åˆ’é—®é¢˜ã€‚å…¶ç¼ºç‚¹æ˜¯å®æ—¶æ€§å·®ï¼Œæ¯ä¸€èŠ‚ç‚¹è®¡ç®—é‡å¤§ã€è¿ç®—æ—¶é—´é•¿ï¼Œè€Œä¸”éšç€èŠ‚ç‚¹æ•°çš„å¢å¤šï¼Œç®—æ³•æœç´¢æ•ˆç‡é™ä½ï¼Œ<strong>è€Œä¸”A starç®—æ³•å¹¶æ²¡æœ‰å®Œå…¨éå†æ‰€æœ‰å¯è¡Œè§£ï¼Œæ‰€å¾—åˆ°çš„ç»“æœä¸ä¸€å®šæ˜¯æœ€ä¼˜è§£ã€‚</strong></p><p><strong>é€‰å¯¹ä¼°å€¼å‡½æ•°å¾ˆé‡è¦ï¼Œä¸€èˆ¬ç”¨åˆ‡æ¯”é›ªå¤«è·ç¦»</strong></p><br/><h2 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h2><h3 id="Gosperâ€™s-Hack"><a href="#Gosperâ€™s-Hack" class="headerlink" title="Gosperâ€™s Hack"></a>Gosperâ€™s Hack</h3><p>ç”¨å¤„ï¼šç”Ÿæˆ $n$ å…ƒé›†åˆä¸­çš„æ‰€æœ‰ $k$ å…ƒå­é›†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** e.g. GospersHack(2, 4) ä¾æ¬¡ç”Ÿæˆï¼š</span></span><br><span class="line"><span class="comment"> *  0011 0101 0110</span></span><br><span class="line"><span class="comment"> *  1001 1010 1100</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">GospersHack</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> (<span class="number">1</span> &lt;&lt; k) - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> (<span class="number">1</span> &lt;&lt; n);</span><br><span class="line">    <span class="keyword">while</span> (cur &lt; limit) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">lb</span> <span class="operator">=</span> cur &amp; -cur;  <span class="comment">//lowbit</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> cur + lb;   <span class="comment">//å·¦åŠéƒ¨åˆ†</span></span><br><span class="line">        cur = (((r ^ cur) &gt;&gt; <span class="number">2</span>) / lb) | r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br/><h3 id="æ•°ç»„å…ƒç´ ä½è¿ç®—"><a href="#æ•°ç»„å…ƒç´ ä½è¿ç®—" class="headerlink" title="æ•°ç»„å…ƒç´ ä½è¿ç®—"></a>æ•°ç»„å…ƒç´ ä½è¿ç®—</h3><p>è¯¥æ¨¡æ¿å¯ä»¥åšåˆ°ï¼š</p><ol><li>æ±‚å‡º<strong>æ‰€æœ‰å­æ•°ç»„</strong>çš„æŒ‰ä½æˆ–çš„ç»“æœï¼Œä»¥åŠå€¼ç­‰äºè¯¥ç»“æœçš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚</li><li>æ±‚æŒ‰ä½æˆ–ç»“æœç­‰äº<strong>ä»»æ„ç»™å®š</strong>æ•°å­—çš„å­æ•°ç»„çš„ æœ€çŸ­é•¿åº¦&#x2F;æœ€é•¿é•¿åº¦ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//leetcode 2411</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] smallestSubarrays(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">var</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">var</span> <span class="variable">ors</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;<span class="type">int</span>[]&gt;(); <span class="comment">// æŒ‰ä½æˆ–çš„å€¼ + å¯¹åº”å­æ•°ç»„çš„å³ç«¯ç‚¹çš„æœ€å°å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            ors.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, i&#125;);</span><br><span class="line">            <span class="type">var</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> or : ors) &#123;</span><br><span class="line">                or[<span class="number">0</span>] |= nums[i];</span><br><span class="line">                <span class="keyword">if</span> (ors.get(k)[<span class="number">0</span>] == or[<span class="number">0</span>])</span><br><span class="line">                    ors.get(k)[<span class="number">1</span>] = or[<span class="number">1</span>]; <span class="comment">// åˆå¹¶ç›¸åŒå€¼ï¼Œä¸‹æ ‡å–æœ€å°çš„</span></span><br><span class="line">                <span class="keyword">else</span> ors.set(++k, or);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å› ä¸ºæ˜¯åŸåœ°å»é‡ï¼Œæ‰€ä»¥è¦åˆ é™¤å†—ä½™çš„å…ƒç´ </span></span><br><span class="line">            <span class="comment">//ä¹Ÿå¯ä»¥ ors.subList(0, k+1)ï¼Œä½†è€—æ—¶</span></span><br><span class="line">            </span><br><span class="line">            ors.subList(k + <span class="number">1</span>, ors.size()).clear();</span><br><span class="line">            <span class="comment">// æœ¬é¢˜åªç”¨åˆ°äº† ors[0]ï¼Œå¦‚æœé¢˜ç›®æ”¹æˆä»»æ„ç»™å®šæ•°å€¼ï¼Œå¯ä»¥åœ¨ ors ä¸­æŸ¥æ‰¾</span></span><br><span class="line">            ans[i] = ors.get(<span class="number">0</span>)[<span class="number">1</span>] - i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br/><h2 id="RMQï¼ˆåŒºé—´æœ€å€¼ï¼‰"><a href="#RMQï¼ˆåŒºé—´æœ€å€¼ï¼‰" class="headerlink" title="RMQï¼ˆåŒºé—´æœ€å€¼ï¼‰"></a>RMQï¼ˆåŒºé—´æœ€å€¼ï¼‰</h2><h3 id="STè¡¨"><a href="#STè¡¨" class="headerlink" title="STè¡¨"></a>STè¡¨</h3><blockquote><p>ST è¡¨æ˜¯ç”¨äºè§£å†³ å¯é‡å¤è´¡çŒ®é—®é¢˜ çš„æ•°æ®ç»“æ„ã€‚</p></blockquote><p><strong>ç®—æ³•æ€æƒ³ï¼š</strong> åŸºäºå€å¢çš„æ€æƒ³ï¼Œä»¤<code>f[i][j]</code>ä»£è¡¨åŒºé—´$[i, i+2^j-1]$çš„æœ€å¤§å€¼ï¼Œè½¬ç§»æ–¹ç¨‹ä¹Ÿå®¹å†™å‡ºï¼š<code>f[i][j] = max(f[i][j-1], f[i+2^(j-1)][j-1])</code></p><p>å¯¹äºæ¯ä¸ªè¯¢é—®<code>[l, r]</code>,å› ä¸ºé—®é¢˜<strong>å¯é‡å¤è´¡çŒ®</strong>ï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸ºä¸¤éƒ¨åˆ†æ±‚æœ€å¤§å€¼å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//logå‡½æ•°é¢„å¤„ç†</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">pre</span><span class="params">()</span>&#123;</span><br><span class="line">        log2[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt; MAXN; i++)&#123;</span><br><span class="line">            log2[i] = log2[i/<span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">build</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        f[i][<span class="number">0</span>] = nextInt();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ ¸å¿ƒä»£ç </span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; (<span class="number">1</span>&lt;&lt;j) &lt;= n; j++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i+(<span class="number">1</span>&lt;&lt;j)-<span class="number">1</span> &lt;= n; i++)&#123;</span><br><span class="line">            f[i][j] = op(f[i][j-<span class="number">1</span>], f[i+(<span class="number">1</span>&lt;&lt;(j-<span class="number">1</span>))][j-<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span>&#123;</span><br><span class="line">  <span class="comment">//æ ¸å¿ƒä»£ç </span></span><br><span class="line">  <span class="type">int</span> <span class="variable">del</span> <span class="operator">=</span> log2[r-l+<span class="number">1</span>];</span><br><span class="line">  <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> op(f[l][del], f[r-(<span class="number">1</span>&lt;&lt;del)+<span class="number">1</span>][del]);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br/><h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><h3 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">void quick_sort(int q[], int l, int r)</span><br><span class="line">&#123;</span><br><span class="line">    if(l &gt;= r) return;</span><br><span class="line">    //å¤„ç†å½“å‰åŒºé—´</span><br><span class="line">    int i = l - 1, j = r + 1, x = q[l+r+1 &gt;&gt; 1];    //æ³¨æ„æ˜¯å‘ä¸Šå–æ•´,å› ä¸ºå‘ä¸‹å–æ•´å¯èƒ½ä½¿å¾—xå–åˆ°q[l]</span><br><span class="line">    while(i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        do i++; while(q[i] &lt; x);</span><br><span class="line">        do j--; while(q[j] &gt; x);</span><br><span class="line">        if(i &lt; j) swap(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    //å­åŒºé—´åˆ†æ²»</span><br><span class="line">    quick_sort(q, l, i - 1), quick_sort(q, i, r); //å¿…é¡»æ˜¯ l~i-1 i~rï¼Œä¿è¯ä¸€ä¸ª&lt;=xã€ä¸€ä¸ª&gt;=x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ„Ÿæ‚Ÿï¼š</strong> è¾¹ç•Œé—®é¢˜å¤ªå¤æ‚ï¼Œç”¨æ—¶ç›´æ¥æ•²æ¨¡æ¿ï¼›<strong>å¿«æ’æœ¬è´¨</strong>å°±æ˜¯åˆ†æ²»ï¼Œæ¯ä¸€æ­¥åˆ†æ²»çš„<strong>å…³é”®</strong>åœ¨äºå¦‚ä½•å°†æ‰€åˆ†åŒºé—´<strong>åˆ†æˆä¸¤ä»½</strong>ï¼Œè‹¥åˆ’åˆ†æ ‡å‡†æ˜¯<code>x</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›®æ ‡æ˜¯å°†åŒºé—´åˆ†ä¸º<code>&gt;= x</code>å’Œ<code>&lt;= x</code>ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p><p>é¦–å…ˆè¯´æ˜ä¸¤ä¸ªæ¸¸æ ‡<code>iã€j</code>çš„å«ä¹‰ï¼šå½“å¾ªç¯ç»“æŸæ—¶ï¼Œ<code>i</code>å‰é¢çš„<code>&lt;= x</code>ï¼ˆä¸æ˜¯<code>&lt; x</code>ï¼‰ï¼Œè€ŒåŒ…æ‹¬<code>i</code>åŠå…¶åé¢çš„<code>&gt;= x</code>ï¼›<code>j</code>åŒç†ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†åœ¨å­åŒºé—´åˆ†æ²»æ—¶çš„ä¼ å‚åŸå› äº†ã€‚</p><p>å†è¯´<strong>è¾¹ç•Œé—®é¢˜</strong>ï¼šåˆ†æ²»æœ€æ€•<strong>æ— é™åˆ†æ²»</strong>ï¼Œå³å°†<code>n</code>åˆ†æˆ<code>0</code>å’Œ<code>n</code>ã€‚æ‰€ä»¥å½“æˆ‘ä»¬è¿›è¡Œå­åŒºé—´åˆ†æ²»æ—¶ï¼Œè‹¥ç”¨<code>i</code>åˆ’åˆ†ï¼Œåˆ™<code>x</code>ä¸èƒ½é€‰åŒºé—´å·¦å€¼ï¼›è‹¥ç”¨<code>j</code>åˆ’åˆ†ï¼Œåˆ™<code>x</code>ä¸èƒ½é€‰åŒºé—´å³å€¼ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e.g. ç”¨ i åˆ’åˆ†ï¼Œé€‰æ‹©åŒºé—´å·¦å€¼ä½œä¸º xï¼Œè¯•è¯•è¿™ä¸ªä¾‹å­: [1 2]</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œå½“å¾…æ’åºæ•°ç»„é•¿åº¦ä¸º2æ—¶æ‰ä¼šå‡ºç°æ— é™é€’å½’ï¼Œå®Œå…¨å¯ä»¥<strong>åœ¨æ•°ç»„é•¿åº¦å°äºæŸä¸ªé˜ˆå€¼æ—¶ï¼Œä½¿ç”¨æ’å…¥æ’åº</strong>ï¼Œä»¥æ­¤æ¥è§„é¿æ— é™é€’å½’ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> å›¾è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›«å›µåæ£ä¸2024åè®°</title>
      <link href="/Blog/2025/01/12/hu-lun-tun-zao-yu-hou-ji/"/>
      <url>/Blog/2025/01/12/hu-lun-tun-zao-yu-hou-ji/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç§‘ä¸ç ”ç©¶ç”Ÿä¸¤ä¸ªé˜¶æ®µçš„äº¤æ¥ä»ªå¼ï¼Œæš‚å®šäº2024è¿™ä¸€å¹´ã€‚</p><p>ä»¿ä½›å¤©å…‰ä¹ç ´ï¼Œæœ¬ç§‘å››å¹´å·²ç„¶æˆä¸ºäº†å›å¿†ï¼Œå¾å¾é€€åœºã€‚è¶ç€æ–°çš„ä¸€åˆ‡è¿˜æœªå¼€å§‹ï¼Œè¶ç€ç ´æ™“æ—¶åˆ†ä»å¼¥ç•™ç€çš„ææƒšï¼Œåƒçº¦å®šä¿—æˆçš„é‚£æ ·ï¼ŒåŒé¾„äººä»¬éƒ½è¸ä¸Šäº†è¿™ä¸€åœºç»ˆæœ«æ—…è¡Œã€‚</p><span id="more"></span><p>äºæ˜¯ä¾¿åŒèˆå‹å»äº†åæ¸…å®«ï¼Œçˆ¬ä¸Šè‹ç¿ è‘±éƒçš„éªŠå±±è°ˆç¬‘é£ç”Ÿï¼›åè½¦åˆ°é’æµ·æ¹–ã€èŒ¶å¡ç›æ¹–ï¼Œç©¿ç€ç›æ¹–é´åœ¨â€œå¤©ä¸äº‘ä¸å±±ä¸æ°´ï¼Œä¸Šä¸‹ä¸€ç™½â€é—´è‚†æ„æ¼«æ­¥ï¼›ä¹‹åé¢†ç•¥åˆ°è€å›å±±ä¸Šçš„é“å®¶åº•è•´ã€æ„Ÿå¹é¸¡å† æ´ä¸­çš„é¬¼æ–§ç¥å·¥ã€å¬é—»ç™½é©¬å¯ºé‡Œæ³•éŸ³å½»å½»,é¦™çƒŸè¢…è¢…â€¦â€¦</p><p>ç„¶åä¾¿ç©¿ä¸Šå­¦å£«æœï¼Œèµ°ä¸Šçº¢æ¯¯ï¼Œæ§èµ·æ¯•ä¸šè¯ä¹¦ï¼Œåœ¨ä¸€ç‰‡æ¬¢å£°ç¬‘è¯­ä¸­ï¼Œå°†è‡ªå·±å®šæ ¼åœ¨é‚£ä¸€å¸§ã€‚ç›¸æœºç¯å…‰é—ªè¿‡ï¼Œæ»¤èµ°äº†æœ€åçš„ä¸€ä¸ææƒšã€‚</p><p>æ•°å£°é£ç¬›ç¦»äº­æ™šï¼Œå›å‘æ½‡æ¹˜æˆ‘å‘ç§¦ã€‚</p><p>æ—¶é—´æ¥åˆ°å¤å­£ï¼Œä»¥å¾€æ˜¯æ”¾æš‘å‡çš„æ—¥å­ã€‚</p><p>è·‘æ­¥ã€æ’¸é“ã€åˆ·ç•ªï¼Œå¸¦ç€å¯¹ç ”ç©¶ç”Ÿç”Ÿæ´»çš„æœŸè®¸ï¼Œå›«å›µåæ£åœ°ï¼Œä¾¿åº¦è¿‡äº†æ•´ä¸ªå¤å­£ã€‚</p><p>ä½†æ˜¯å½¼æ—¶çš„æˆ‘ï¼Œè¿˜æœªæ„è¯†åˆ°äº‹æƒ…çš„ä¸¥é‡æ€§ã€‚ç°åœ¨çœ‹æ¥ï¼Œ23å¹´é‚£ç¯‡æœ«å°¾çš„ä¸œæ‹‰è¥¿æ‰¯ï¼Œä¹Ÿå¹¶éå…¨æ˜¯æ— ç—…å‘»åŸã€‚</p><p>å†æ¬¡å¼€å­¦ï¼Œèº«ä»½å·²ç»è½¬å˜ã€‚ä»€ä¹ˆä»è¢«åŠ¨çŒè¾“åˆ°ä¸»åŠ¨æ¢ç´¢ã€ä»€ä¹ˆä»åŒå¿ƒååŠ›åˆ°è¸½è¸½ç‹¬è¡Œâ€¦â€¦æœ¬ç§‘ç”Ÿåˆ°ç ”ç©¶ç”Ÿçš„è½¬å˜ï¼Œå¤©èŠ±ä¹±å ã€ä¸èƒœæšä¸¾ï¼Œä»¿ä½›æˆé•¿åªåœ¨ä¸€ç¬é—´å®Œæˆã€‚</p><p>ç¡®å®å¦‚æ­¤ã€‚ç ”ä¸€ä¸ŠåŠå¹´ç»™æˆ‘å°è±¡æœ€æ·±åˆ»çš„æ˜¯ï¼Œè¦æ±‚åŒå­˜å¼‚ï¼ˆç‹—å¤´ï¼‰ã€‚å­˜ä»€ä¹ˆå¼‚ï¼Œåªèƒ½è¯´é“ä¸åŒä¸ç›¸ä¸ºè°‹ã€‚</p><p>ä¸å¦‚åœ¨æ­¤ç«‹ä¸€ä¸ª25å¹´çš„ç›®æ ‡ï¼šå®Œæˆæ¯•ä¸šè¦æ±‚çš„ä¸€ç¯‡è®ºæ–‡ï¼Œæ‹¿åˆ°ä¸€ä»½ä¸é”™çš„å®ä¹ ï¼</p><p>äº‹å·²è‡³æ­¤ï¼Œé‚£å°±å…ˆå½“ä¸€ä¸ªç‹¬è¡Œä¾ å§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2024 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éŸ³ä¹æ¨èç³»ç»Ÿ</title>
      <link href="/Blog/2024/06/12/yin-le-tui-jian-xi-tong/"/>
      <url>/Blog/2024/06/12/yin-le-tui-jian-xi-tong/</url>
      
        <content type="html"><![CDATA[<p><del><a href="http">æ¼”ç¤ºä¼ é€é—¨</a></del></p><p>æ¯•è®¾é¡¹ç›®ï¼Œå› ä¸ºä¸­é—´è¦å†™å„ç§å„æ ·çš„æ–‡æ¡£ã€è®ºæ–‡æ”¹ç¨¿ï¼Œå¯¼è‡´æ…¢æ…¢æ‚ æ‚ æ•²äº†å°ä¸¤ä¸ªæœˆæ‰å®Œæˆã€‚ä¸è¿‡è¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ²¡è·Ÿä»»ä½•è§†é¢‘ï¼Œç‹¬ç«‹å®ç°çš„åŸºäºå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼ŒæŠ€æœ¯æ ˆå½“ç„¶æ˜¯Vue SpringBoot SpringSecurity </p><span id="more"></span><p>æ„Ÿè§‰è¿˜æ˜¯ç‹¬ç«‹å®Œæˆä¸€ä¸ªé¡¹ç›®æœ€èƒ½å¾—åˆ°é”»ç‚¼ï¼Œå› ä¸ºé¡¹ç›®æ¨è¿›è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ç®€ç›´ä¸èƒœæšä¸¾ï¼Œæœ‰çš„å³ä¾¿å¹³å¸¸æœ‰è¿‡äº†è§£ï¼Œä½†è§åˆ°æ—¶å´ä»ç„¶æ‰‹è¶³æ— æªï¼›æœ‰çš„å°±æ˜¯â€œå…¨æ–°gangè§‰â€ã€‚</p><p>é‚£ä¹ˆæ˜¯ä¸æ˜¯å¹³æ—¶å­¦çš„â€œå®Œå¤‡â€ä¸€ç‚¹ï¼Œåšé¡¹ç›®æ—¶å°±èƒ½â€œè½»æ¾â€ä¸€äº›å˜ï¼Ÿç›®å‰æˆ‘çš„è§‚ç‚¹æ˜¯ï¼šå¹³æ—¶å­¦æ¡†æ¶ï¼Œé¡¹ç›®è¡¥ç»†èŠ‚ã€‚æœ¬è´¨è¿˜æ˜¯å®è·µå‡ºçœŸçŸ¥ï¼Œè™½ç„¶è¯¾ç¨‹æˆ–è€…åšå®¢ä¸­ä»‹ç»çš„å†…å®¹ç¡®å®å…¨é¢ï¼Œä½†å…‰çœ‹å¹¶ä¸ä¼šæå‡ä»€ä¹ˆï¼ˆSpringSecurityè¿‡æ»¤å™¨é“¾é…ç½®ã€æ‹¦æˆªå™¨ã€Nginxä»£ç†æˆ‘çœ‹å®Œæ ¹æœ¬ä¸ä¼šç”¨ï¼‰ã€‚å› æ­¤ï¼Œè¿˜å¾—é€šè¿‡ç—›è‹¦çš„å®è·µæ¥åŠ æ·±è®°å¿†å’Œç†è§£ï¼Œäº²åŠ›è§£å†³é—®é¢˜å¿…ç„¶ä¼šæ”¶è·é¢‡ä¸°ã€‚</p><p>æœ€ä»¤äººæŠ“ç‹‚çš„è¿˜æ˜¯å†™å‰ç«¯é¡µé¢ï¼Œåœ¨é¡¹ç›®å¼€å§‹å‰æˆ‘å…ˆå»bç«™åˆ·äº†14ä¸ªå°æ—¶çš„Vue3å¿«é€Ÿå…¥é—¨ï¼Œç„¶åé…åˆelement-plus çš„å„ç§å°è£…æ§ä»¶å®Œå–„é¡¹ç›®ã€‚ä½†ä¸Šæ‰‹ç¬¬ä¸‰æ–¹å°è£…åº“çš„ä»£ä»·å°±æ˜¯éœ€è¦ä¸æ–­è¯»æ–‡æ¡£ï¼Œä¸æ–­è¯•é”™ï¼Œè€Œä¸”æœ‰æ—¶å®¹æ˜“èˆæœ¬é€æœ«ï¼šå› ä¸ºå°è£…æ§ä»¶ä¸å¯æ§ï¼Œé€‰æ‹©åŸç”Ÿæ§ä»¶é…åˆCSSå¾€å¾€æ›´ä½³ã€‚æœ€åè™½ç„¶æ²¡æœ‰ç”¨åˆ°Vue3 ç»„åˆå¼çš„ç²¾é«“ï¼Œä½†è‡³å°‘è¾¾åˆ°äº†â€œä¼šç”¨â€çš„æ°´å¹³ã€‚</p><p>å¼€å‘è¿‡ç¨‹å†—é•¿æ— å‘³ï¼Œä¸‹é¢ç€é‡ä»‹ç»ä¼˜åŒ–å’Œéƒ¨ç½²æ—¶çš„é‡ç‚¹å‘ç‚¹ã€‚</p><h3 id="å›¾ç‰‡åŠ è½½ä¼˜åŒ–"><a href="#å›¾ç‰‡åŠ è½½ä¼˜åŒ–" class="headerlink" title="å›¾ç‰‡åŠ è½½ä¼˜åŒ–"></a>å›¾ç‰‡åŠ è½½ä¼˜åŒ–</h3><p>éŸ³ä¹æ¨èç³»ç»Ÿçš„åç«¯å­˜äº†æ¯é¦–æ­Œæ›²çš„éŸ³é¢‘æ–‡ä»¶å’Œå°é¢å›¾ï¼Œå ç”¨äº†ä¸å°‘ç£ç›˜ç©ºé—´ã€‚åŸå…ˆçš„æ–¹å¼æ˜¯å‰ç«¯å‘è¯·æ±‚ï¼Œåç«¯è¿”å›Blobæ ¼å¼çš„æ•°æ®ï¼Œå‰ç«¯è§£æå¹¶å­˜å…¥Pinia å¤ç”¨ã€‚</p><p>éƒ¨ç½²åå‘ç°å›¾ç‰‡åŠ è½½é€Ÿåº¦å¤ªæ…¢ï¼Œäºæ˜¯ç”¨GitHubæ­äº†ä¸ªå›¾åºŠï¼Œé…åˆjsDelivr åšCDNä¼˜åŒ–ï¼ŒåŠ è½½è€—æ—¶æ˜¾è‘—é™ä½ï¼Œè€Œä¸”åç«¯ä¹Ÿä¸éœ€è¦å­˜å›¾ç‰‡äº†ï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚</p><h3 id="é¡¹ç›®éƒ¨ç½²"><a href="#é¡¹ç›®éƒ¨ç½²" class="headerlink" title="é¡¹ç›®éƒ¨ç½²"></a>é¡¹ç›®éƒ¨ç½²</h3><p>è€æ—©å°±å¬è¿‡Docker çš„å¤§åï¼Œè¿™æ¬¡æ­£å¥½æ‹¿æ¥ç»ƒç»ƒã€‚</p><p>é¡¹ç›®éƒ¨ç½²éœ€è¦ç”¨åˆ°MySQL ã€Redis ã€Nginx ã€JDK17 ç­‰æ”¯æŒï¼Œä¸‹è½½åˆ°æœåŠ¡å™¨ä¹‹åè¿˜éœ€è¦å„ç§é…ç½®ï¼Œéš¾ä»¥ç®¡ç†ã€‚è€Œä½¿ç”¨Docker å¯ä»¥å°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªä¸ªå®¹å™¨æ¥è¿›è¡Œéƒ¨ç½²å’Œç®¡ç†ï¼Œå®¹å™¨ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œæ— é¡»é…ç½®ä¾¿å¯ç›´æ¥è¿è¡Œï¼Œå¤§å¤§é™ä½è¿ç»´æˆæœ¬ã€‚</p><p>åœ¨Ubuntuä¸Šéƒ¨ç½²éŸ³ä¹æ¨èç³»ç»Ÿçš„æ­¥éª¤ï¼Œå¤§è‡´ä¸ºï¼š</p><p>å®‰è£…Docker</p><p>æ‹‰å–é•œåƒã€ç»„ç½‘é…ç½®</p><p>æ„å»ºåç«¯é•œåƒ</p><p>åç«¯éƒ¨ç½²</p><p>å‰ç«¯éƒ¨ç½²</p><p>ç»„ç½‘é…ç½®æ˜¯ä¸ºäº†è®©é¡¹ç›®ç”¨åˆ°çš„å‡ ä¸ªå®¹å™¨ä¹‹é—´å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œå› æ­¤è¦å°†å®ƒä»¬é…ç½®åˆ°åŒä¸€ç½‘æ¡¥ä¸Šã€‚</p><p>æ„å»ºåç«¯é•œåƒéœ€è¦ç¼–å†™Dockerfile ,å†…å®¹ä¹Ÿå¾ˆç®€å•ã€‚</p><p>é•œåƒéƒ¨ç½²ä¸€å®šè¦é…ç½®æŒ‚è½½è·¯å¾„ï¼Œå¯åœ¨DockerHubä¸ŠæŸ¥çœ‹ç›¸å…³é•œåƒæ–‡æ¡£æ¥ç¡®å®šå®¹å™¨å†…éƒ¨è·¯å¾„ã€‚å¦‚MySQL é•œåƒä¸­çš„åˆå§‹åŒ–æ–‡ä»¶å­˜æ”¾è·¯å¾„&#x2F;docker-entrypoint-initdb.dï¼›Nginx é•œåƒä¸­å‰ç«¯æ–‡ä»¶å­˜æ”¾è·¯å¾„&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;htmlâ€¦â€¦</p><p>Nginxéƒ¨ç½²éœ€è¦ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œç”¨äºä»£ç†æ‰“åŒ…å¥½çš„å‰ç«¯é¡¹ç›®ï¼›è€Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒIDEç›´æ¥å°†é¡¹ç›®è¿è¡Œåœ¨Node.js ç¯å¢ƒä¸­ï¼Œæ— é¡»Nginx ã€‚é…ç½®æ–‡ä»¶çš„å…³é”®éƒ¨åˆ†å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="comment"># ç›‘å¬5173ç«¯å£ï¼ˆVueé¡¹ç›®çš„è¿è¡Œç«¯å£ï¼‰</span></span><br><span class="line">        <span class="attribute">listen</span>      <span class="number">5173</span>;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   /usr/share/nginx/html/music_frontendï¼›</span><br><span class="line">            <span class="comment"># æŒ‰éœ€æ£€ç´¢æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            <span class="comment"># ä¸æ·»åŠ è¿™ä¸€é¡¹ï¼Œåˆ·æ–°é¡µé¢åæŠ¥404</span></span><br><span class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># è¯·æ±‚è½¬å‘</span></span><br><span class="line">        <span class="comment"># musicrsä¸ºåç«¯å®¹å™¨åï¼Œè¿™é‡Œä»£è¡¨åœ°å€</span></span><br><span class="line">        <span class="section">location</span> /api &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://musicrs:8080;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h3><p>å·²ç»ä¸Šä¼ GitHub ï¼Œæœªæ¥åº”è¯¥ä¼šåŠ å…¥Elasticsearch ç”¨äºæ­Œæ›²æœç´¢</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¨èç³»ç»Ÿ </tag>
            
            <tag> Docker </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼</title>
      <link href="/Blog/2024/05/23/java-duo-xian-cheng-she-ji-mo-shi/"/>
      <url>/Blog/2024/05/23/java-duo-xian-cheng-she-ji-mo-shi/</url>
      
        <content type="html"><![CDATA[<h3 id="å¤šçº¿ç¨‹è¯„ä»·æ ‡å‡†"><a href="#å¤šçº¿ç¨‹è¯„ä»·æ ‡å‡†" class="headerlink" title="å¤šçº¿ç¨‹è¯„ä»·æ ‡å‡†"></a>å¤šçº¿ç¨‹è¯„ä»·æ ‡å‡†</h3><ul><li><p><strong>å®‰å…¨æ€§</strong>â€”â€”ä¸æŸåå¯¹è±¡&#x3D;&#x3D;ã€å¿…é¡»ã€‘&#x3D;&#x3D;</p></li><li><p><strong>ç”Ÿå­˜æ€§&#x2F;æ´»æ€§</strong>â€”â€”å¿…è¦çš„å¤„ç†èƒ½å¤Ÿè¢«æ‰§è¡Œ&#x3D;&#x3D;ã€å¿…é¡»ã€‘&#x3D;&#x3D;</p></li><li><p><strong>å¯å¤ç”¨æ€§</strong>â€”â€”ç±»å¯é‡å¤åˆ©ç”¨ï¼Œe.g. JUC</p></li><li><p><strong>æ€§èƒ½</strong>â€”â€”èƒ½å¿«é€Ÿã€å¤§æ‰¹é‡å¤„ç†ï¼šååé‡ã€å“åº”æ€§ã€å®¹é‡</p></li></ul><h3 id="I-Single-Threaded-Executionæ¨¡å¼"><a href="#I-Single-Threaded-Executionæ¨¡å¼" class="headerlink" title="I.Single Threaded Executionæ¨¡å¼"></a>I.Single Threaded Executionæ¨¡å¼</h3><p>è¯¥æ¨¡å¼ä¼šå°†ä¿®æ”¹æˆ–å¼•ç”¨å®ä¾‹çŠ¶æ€çš„åœ°æ–¹è®¾ç½®ä¸º<strong>ä¸´ç•ŒåŒº</strong>ï¼Œç”¨äºå®ç°å¯¹ä¸´ç•Œèµ„æºçš„ä¿æŠ¤ï¼Œå³ç¡®ä¿åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå¤„ç†ã€‚ä½¿ç”¨æ—¶åº”ç¡®å®š<strong>ä¿æŠ¤å¯¹è±¡</strong>ã€<strong>ä»¥ä»€ä¹ˆå•ä½ä¿æŠ¤</strong>ã€<strong>ä½¿ç”¨å“ªä¸ªé”ä¿æŠ¤</strong></p><blockquote><p>synchronized</p></blockquote><p> <code>char</code> <code>int</code> ç­‰åŸºæœ¬ç±»å‹ï¼Œä»¥åŠå¯¹è±¡ç­‰å¼•ç”¨ç±»å‹çš„<strong>è¯»å†™æ“ä½œ</strong>æ˜¯åŸå­çš„ï¼Œè€Œ<code>long</code> <code>double</code>åœ¨32ä½JVMä¸Šçš„è¯»å†™ä¸æ˜¯åŸå­çš„, è€Œåœ¨64ä½JVMä¸Šæ˜¯åŸå­çš„</p><blockquote><p>JUC-Semaphore</p></blockquote><p>å½“æˆ‘ä»¬æƒ³è¦ç¡®ä¿æŸä¸ªåŒºåŸŸâ€œæœ€å¤šåªèƒ½ç”±Nä¸ªçº¿ç¨‹â€æ‰§è¡Œï¼Œå°±éœ€è¦ç”¨<strong>è®¡æ•°ä¿¡å·é‡</strong>æ¥æ§åˆ¶</p><br/><p><strong>è¯¾åä¹ é¢˜</strong></p><ol><li><p>åœ¨<strong>Single Threaded Execution</strong> æ¨¡å¼ä¸­ï¼Œæ»¡è¶³ä¸‹è¿°æ¡ä»¶æ—¶ï¼Œæ­»é”ä¾¿ä¼šå‘ç”Ÿï¼š</p><ul><li>å­˜åœ¨å¤šä¸ª<code>SharedResource</code>è§’è‰²</li><li>è¯·æ±‚å’Œä¿æŒã€ä¸å¯å‰¥å¤º</li><li>è·å–<code>SharedResouce</code>è§’è‰²çš„é”çš„é¡ºåºä¸å›ºå®šï¼ˆå¾ªç¯ç­‰å¾…ï¼‰</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬ç ´åä»»ä¸€æ¡ä»¶ä¾¿å¯é˜²æ­¢æ­»é”å‘ç”Ÿï¼Œè€ƒè™‘<strong>å“²å­¦å®¶è¿›é¤é—®é¢˜</strong>ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¦‚ä¸‹çš„è§£å†³æ€è·¯ï¼š</p><ul><li>å°†ç­·å­<strong>æ‰“åŒ…</strong>ï¼Œä»¥åŒ…ä½œä¸ºç«äº‰å•ä½ã€‚</li><li>æ¯ä¸ªäººéƒ½æŒ‰ç…§ ç­·1 -&gt; ç­·2 â€¦ çš„é¡ºåºç«äº‰ã€‚</li></ul><p>å¾ªç¯ç­‰å¾…çš„å‰æä¾¿æ˜¯æœ‰å¤šä¸ªèµ„æºï¼Œå³æ¡ä»¶ä¸‰çš„å‰ææ˜¯æ¡ä»¶ä¸€</p></li></ol><br/><h3 id="II-Immutable"><a href="#II-Immutable" class="headerlink" title="II.Immutable"></a>II.Immutable</h3><p>è¯¥æ¨¡å¼æ—¨åœ¨ä½¿ç”¨<strong>ç¡®ä¿å®ä¾‹çŠ¶æ€ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ç±»</strong>ï¼Œè¿™æ ·åœ¨è®¿é—®è¿™äº›å®ä¾‹å˜é‡æ—¶æ— é¡»æ‰§è¡Œäº’æ–¥å¤„ç†ï¼Œæ•…è€Œå¯ä»¥æé«˜æ€§èƒ½</p><blockquote><p>ä½•æ—¶ä½¿ç”¨Immutable</p></blockquote><ul><li>å®ä¾‹åˆ›å»ºåï¼ŒçŠ¶æ€ä¸å†å‘ç”Ÿæ”¹å˜</li><li>å®ä¾‹æ˜¯å…±äº«çš„ï¼Œä¸”è¢«é¢‘ç¹è®¿é—®</li></ul><blockquote><p>è€ƒè™‘æˆå¯¹çš„mutableå’Œimmutable</p></blockquote><p>ä¸ºæé«˜æ€§èƒ½ï¼Œå°†ç±»åˆ†ä¸º<code>mutable</code>å’Œ<code>immutable</code>ä¸¤ç§å®ç°ï¼›e.g. <code>String</code>å’Œ<code>StringBuffer</code></p><br/><h3 id="III-Guarded-Suspension"><a href="#III-Guarded-Suspension" class="headerlink" title="III.Guarded Suspension"></a>III.Guarded Suspension</h3><p>è¯¥æ¨¡å¼ç±»ä¼¼äºâ€œé™„åŠ <strong>æ¡ä»¶</strong>çš„<code>synchronized</code>â€æ¨¡å¼ï¼Œç›¸å½“äºåœ¨<code>Single Threaded Execution</code>æ¨¡å¼çš„åŸºç¡€ä¸Šå¼•å…¥äº†<strong>åŒæ­¥æœºåˆ¶</strong>ï¼šå³æ¶ˆè´¹è€…åº”è¯¥åœ¨é˜Ÿåˆ—ä¸ä¸ºç©ºæ˜¯æ‰èƒ½å–ï¼Œç”Ÿäº§è€…åœ¨é˜Ÿåˆ—ä¸æ»¡æ—¶æ‰èƒ½æ”¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¼ªä»£ç å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GuardObject</span>&#123;</span><br><span class="line">    syn <span class="title function_">guardedMethod</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">while</span>(å®ˆæŠ¤æ¡ä»¶) wait();</span><br><span class="line">      ç›®æ ‡å¤„ç†</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    syn <span class="title function_">stateChangedMethod</span><span class="params">()</span>&#123;</span><br><span class="line">      ç›®æ ‡å¤„ç†</span><br><span class="line">      notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br/><p><strong>è¯¾åä¹ é¢˜</strong></p><ol><li><code>wait()</code> å’Œ <code>notifyAll()</code> æ“ä½œçš„éƒ½æ˜¯<code>this</code>çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œå’Œä½ <code>GuardObject</code>ä¸­çš„è‡ªå®šä¹‰å­—æ®µï¼ˆe.g. queueï¼‰æ¯«æ— å…³ç³»</li><li>åœ¨å®ç°<strong>åŒæ­¥æœºåˆ¶</strong>æ—¶ï¼Œå…·æœ‰å¯¹ç§°æ€§çš„ä»£ç å¾ˆæœ‰å¯èƒ½å¯¼è‡´æ­»é”ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸å¦¨åŠ å…¥ä¸€ä¸ª<strong>ç§å­</strong>ï¼Œä»è€Œä¿è¯ä»£ç æ­£å¸¸è¿è¡Œ&#x2F;æ­£å¸¸ç»“æŸ</li></ol><br/><h3 id="IV-Balking"><a href="#IV-Balking" class="headerlink" title="IV.Balking"></a>IV.Balking</h3><p>è¯¥æ¨¡å¼ä¸<code>Guarded Suspension</code>æ¨¡å¼ç±»ä¼¼ï¼Œä¹Ÿå­˜åœ¨å®ˆæŠ¤æ¡ä»¶ã€‚ä½†è¯¥æ¨¡å¼ä¸‹å®ˆæŠ¤æ¡ä»¶ä¸æˆç«‹æ—¶ï¼Œåˆ™<strong>ç«‹åˆ»ä¸­æ–­è¿”å›</strong></p><blockquote><p>ä½¿ç”¨æ—¶æœº</p></blockquote><ul><li>å¹¶ä¸éœ€è¦æ‰§è¡Œï¼Œå› ä¸ºä¹‹å‰å·²ç»æ‰§è¡Œè¿‡äº†</li><li>è‹¥å®ˆæŠ¤æ¡ä»¶ä¸æˆç«‹ï¼Œæƒ³ç«‹å³è¿”å›å¹¶è¿›å…¥ä¸‹ä¸€æ­¥</li><li>å®ˆæŠ¤æ¡ä»¶ä»…åœ¨ç¬¬ä¸€æ¬¡æˆç«‹æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¼ªä»£ç </span></span><br><span class="line"><span class="comment">//initializedå­—æ®µçŠ¶æ€ä»…å˜åŒ–ä¸€æ¬¡ï¼Œç§°ä¹‹ä¸ºã€é—­é”ã€‘</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GuardObject</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">initialized</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    syn <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(initialized) <span class="keyword">return</span>;   <span class="comment">//balking</span></span><br><span class="line">      å…·ä½“å¤„ç†</span><br><span class="line">      initialized = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¶…æ—¶ guarded timed</p></blockquote><p>ä»‹äº<code>Balking</code>å’Œ<code>Guarded Suspension</code>ï¼Œæˆ‘ä»¬é€‰æ‹©åœ¨å®ˆæŠ¤æ¡ä»¶æˆç«‹ä¹‹å‰ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåˆ°æ—¶æ¡ä»¶è¿˜æœªæˆç«‹ï¼Œåˆ™ç›´æ¥<code>balk</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GuardObject</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">ready</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> timeout;</span><br><span class="line">    </span><br><span class="line">    syn <span class="title function_">execute</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();  <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">      <span class="keyword">while</span>(!ready)&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();  <span class="comment">//å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">rest</span> <span class="operator">=</span> timeout-(now-start);        <span class="comment">//å‰©ä½™æ—¶é—´</span></span><br><span class="line">        <span class="keyword">if</span>(rest &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TimeoutException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        wait(rest);</span><br><span class="line">      &#125;</span><br><span class="line">      å…·ä½“å¤„ç†</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    syn <span class="title function_">setExecutable</span><span class="params">(<span class="type">boolean</span> on)</span>&#123;</span><br><span class="line">      ready = on;</span><br><span class="line">      notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br/><h3 id="V-Producer-Consumer"><a href="#V-Producer-Consumer" class="headerlink" title="V.Producer-Consumer"></a>V.Producer-Consumer</h3><p>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå½“ä¸¤è€…åªæœ‰ä¸€ä¸ªæ—¶ï¼Œç§°ä¹‹ä¸º<code>pipe</code>æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„ç›®çš„æ˜¯è®©<strong>ç”Ÿäº§è€…å¯ä»¥å®‰å…¨åœ°å°†æ•°æ®äº¤ç»™æ¶ˆè´¹è€…</strong>ï¼Œæ•…è€Œå¼•å…¥ä¸€ä¸ªâ€œä¸­é—´è§’è‰²â€œï¼Œè´Ÿè´£çº¿ç¨‹åè°ƒè¿è¡Œ</p><p><strong>é‡è¦å¯ç¤ºï¼šçº¿ç¨‹åè°ƒè¿è¡Œéœ€è¦è€ƒè™‘â€æ”¾åœ¨ä¸­é—´çš„ä¸œè¥¿â€œï¼›ç°åœºäº’æ–¥å¤„ç†éœ€è¦è€ƒè™‘â€åº”è¯¥ä¿æŠ¤çš„ä¸œè¥¿â€œ</strong></p><blockquote><p>InterruptedException</p></blockquote><ul><li><code>sleep</code>ã€<code>join</code>çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Œç«‹é©¬åœ¨è¯¥çº¿ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸</li><li><code>wait</code>çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Œéœ€è¦åœ¨è¯¥çº¿ç¨‹é‡æ–°è·å–é”ä¹‹åæ‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆå³åœ¨<strong>å…¥å£é˜Ÿåˆ—</strong>ä¸­çš„çº¿ç¨‹ä¸ä¼šè¢«ä¸­æ–­ï¼‰</li><li><strong><code>interrupt</code>ä¸éœ€è¦è·å–çº¿ç¨‹çš„é”ï¼›<code>notify/notifyAll</code>éœ€è¦è·å–çº¿ç¨‹çš„é”</strong></li></ul><blockquote><p>JUC-BolckingQueue</p></blockquote><ul><li><code>ArrayBlockingQueue</code> <code>LinkedBlockingQueue</code></li><li><code>PriorityBlockingQueue</code></li><li><code>DelayQueue</code>ï¼šåœ¨å…ƒç´ æŒ‡å®šæ—¶é—´åˆ°æœŸåæ‰å¯ä»¥<code>take</code>ï¼Œåˆ°æœŸæ—¶é—´æœ€é•¿çš„å…ƒç´ å…ˆè¢«<code>take</code></li><li><code>SynchronousQueue</code>ï¼šç”¨äºæ‰§è¡Œ<code>Producer</code>è§’è‰²åˆ°<code>Consumer</code>è§’è‰²çš„<strong>ç›´æ¥ä¼ é€’</strong>ï¼Œå³æœ‰ä¸€æ–¹æ²¡å‡†å¤‡å¥½æ—¶ï¼Œå¦ä¸€æ–¹è°ƒç”¨æ¥å£ä¼šè¢«é˜»å¡</li></ul><blockquote><p>JUC-Exchanger</p></blockquote><p>ç”¨äºè®©ä¸¤ä¸ªçº¿ç¨‹å®‰å…¨åœ°äº¤æ¢å¯¹è±¡</p><br/><p><strong>è¯¾åä¹ é¢˜ï¼š</strong></p><ol><li>å¦‚ä½•å®ç° æ¸…é™¤â€œä¸­é—´è§’è‰²â€çš„æ‰€ç»´æŠ¤çš„æ•°æ®<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">syn <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>&#123;</span><br><span class="line">    æ¸…é™¤æ“ä½œ...</span><br><span class="line">    notifyAll();    <span class="comment">//æ¸…é™¤å®Œè¦é€šçŸ¥æ‰€æœ‰ç­‰å¾…é˜Ÿåˆ—ä¸Šçš„çº¿ç¨‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><br/><h3 id="VI-Read-Write-Lock"><a href="#VI-Read-Write-Lock" class="headerlink" title="VI.Read-Write Lock"></a>VI.Read-Write Lock</h3><p>è¯»è€…å†™è€…æ¨¡å¼ï¼Œ<strong>å¯¹ä¸åŒç§ç±»çº¿ç¨‹çš„äº’æ–¥å¤„ç†åˆ†å¼€è€ƒè™‘</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–ï¼Œè¯»å–æ—¶ä¸èƒ½å†™å…¥ï¼›ä¸€ä¸ªçº¿ç¨‹å†™å…¥æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è¯»å–æˆ–å†™å…¥</p><p>è¯¥æ¨¡å¼é€‚ç”¨äº<strong>è¯»å–æ“ä½œç¹é‡</strong>ã€<strong>è¯»å–é¢‘ç‡æ¯”å†™å…¥é¢‘ç‡é«˜</strong>æ—¶çš„æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ReadWriteLock</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">readingReaders</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">waitingWriters</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">writingWriters</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">preferWriter</span> <span class="operator">=</span> <span class="literal">true</span>;    <span class="comment">//é˜²æ­¢å†™çº¿ç¨‹â€œé¥¿æ­»â€</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">readLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line">    <span class="keyword">while</span>(writingWriters &gt; <span class="number">0</span> || (preferWriter &amp;&amp; waitingWriters &gt; <span class="number">0</span>))&#123;</span><br><span class="line">      wait();</span><br><span class="line">    &#125;</span><br><span class="line">    readingReaders++;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">readUnLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line">    readingReaders--;</span><br><span class="line">    preferWriter = <span class="literal">true</span>;</span><br><span class="line">    notifyAll();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">writeLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line">    waitingWriters++;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">while</span>(readingReaders &gt; <span class="number">0</span> || writingWriters &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        wait();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">      waitingWriters--;</span><br><span class="line">    &#125;</span><br><span class="line">    writingWriters++;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">writeUnLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line">    writingWriters--;</span><br><span class="line">    preferWriter = <span class="literal">false</span>;</span><br><span class="line">    notifyAll();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>JUC-ReadWriteLock</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReadWriteLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">readLock</span> <span class="operator">=</span> lock.readLock();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">writeLock</span> <span class="operator">=</span> lock.writeLock();</span><br></pre></td></tr></table></figure><p><code>ReentrantReadWriteLock</code>ä¸»è¦ç‰¹å¾ï¼š</p><ul><li><p><strong>å…¬å¹³æ€§</strong></p><p>è®©ç­‰å¾…æ—¶é—´ä¹…çš„çº¿ç¨‹ä¼˜å…ˆè·å¾—é”</p></li><li><p><strong>å¯é‡å…¥æ€§</strong></p><p><code>Reader</code>è§’è‰²çš„çº¿ç¨‹å¯ä»¥è·å¾—â€œç”¨äºå†™å…¥çš„é”â€ï¼Œ<code>Writer</code>å¯è·å¾—â€œç”¨äºè¯»å–çš„é”â€</p></li><li><p><strong>é”é™çº§</strong></p></li></ul><br/><p><strong>è¯¾åä¹ é¢˜ï¼š</strong></p><ol><li><p><code>waitingWriters</code>å’Œ<code>preferWriters</code>å­—æ®µçš„å«ä¹‰ï¼š</p><p>é˜²æ­¢<code>ReaderThread</code>æˆ–è€…<code>WriterThread</code>ä¸ä¼š**â€œé¥¿æ­»â€**ï¼š<code>waitingWriters &gt; 0</code>å¯ä»¥è®©<code>ReaderThread</code>çº¿ç¨‹ç­‰å¾…ï¼Œé˜²æ­¢<code>WriterThread</code>é¥¿æ­»ï¼›å†åŠ ä¸Š<code>preferWriters</code>æ§åˆ¶ä¸¤ç±»è¿›ç¨‹å“ªä¸€ç±»æ›´ä¼˜å…ˆï¼Œé˜²æ­¢<code>ReaderThread</code>é¥¿æ­»</p></li></ol><br/><h3 id="VII-Thread-Per-Message"><a href="#VII-Thread-Per-Message" class="headerlink" title="VII.Thread-Per-Message"></a>VII.Thread-Per-Message</h3><p>è¯¥æ¨¡å¼æ˜¯ä¸ºæ¯ä¸ªå‘½ä»¤æˆ–è¯·æ±‚<strong>æ–°åˆ†é…ä¸€ä¸ªçº¿ç¨‹</strong>ï¼Œç”±è¿™ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œå…·ä½“å¤„ç†ï¼Œå®ç°<strong>è°ƒç”¨ä¸æ‰§è¡Œç›¸åˆ†ç¦»</strong>ã€‚</p><p>ç›®çš„åœ¨äºæé«˜ç¨‹åºå“åº”æ€§ï¼Œæ˜¯å¦é€‰ç”¨å–å†³äº<strong>çº¿ç¨‹å¯åŠ¨è€—æ—¶</strong>ä¸<strong>å…·ä½“æ“ä½œè€—æ—¶</strong>é—´çš„å‡è¡¡</p><blockquote><p>JUC-Executor</p></blockquote><img src="/Blog/img/6453e32b98ce084a632551d3ff5ac185.jpg" alt="æ‰«æä»¶_Creates interface.jpg" style="zoom:20%;" /><ul><li><code>ThreadFactory</code> å°†çº¿ç¨‹åˆ›å»ºæŠ½è±¡åŒ–ï¼Œ<code>Executor</code> å°†çº¿ç¨‹æ‰§è¡ŒæŠ½è±¡åŒ–</li><li><code>ExecutorService</code> å°†<strong>è¢«å¤ç”¨</strong>çš„çº¿ç¨‹æŠ½è±¡åŒ–ï¼ˆæ‰€è°“æŠ½è±¡åŒ–ï¼Œå°±æ˜¯å¯¹å¤–éšè—äº†å®ç°ç»†èŠ‚ï¼‰</li><li><code>cheduleExecutorService</code> å°†è¢«è°ƒåº¦çš„çº¿ç¨‹çš„æ‰§è¡ŒæŠ½è±¡åŒ–</li></ul><p><strong>ï¼è¯¾åä¹ é¢˜ 7-5ã€7-7</strong></p><br/><h3 id="VIII-Worker-Thread-Thread-Pool"><a href="#VIII-Worker-Thread-Thread-Pool" class="headerlink" title="VIII.Worker Thread&#x2F;Thread Pool"></a>VIII.Worker Thread&#x2F;Thread Pool</h3><p>è¯¥æ¨¡å¼ç±»ä¼¼äº<code>Thread-Per-Message</code>å’Œ<code>Produce-Consumer</code>æ¨¡å¼çš„ç»“åˆã€‚å¯¹äºå‰è€…ï¼Œä¼˜åŠ¿åœ¨äºæ–°çº¿ç¨‹æ˜¯äº‹å…ˆå¯åŠ¨çš„(å­˜åœ¨äº<strong>çº¿ç¨‹æ± </strong>ä¸­)ï¼Œæ•…è€Œå¯ä»¥<strong>èŠ‚çœçº¿ç¨‹å¯åŠ¨æ—¶é—´</strong>ï¼›å¯¹äºåè€…ï¼Œå¼•å…¥çš„çº¿ç¨‹æ± å°±ç›¸å½“äº<code>Consumer</code>è§’è‰²å·¥ä½œçš„ç¯å¢ƒï¼Œé‡Œé¢æœ‰<code>Channel</code>è§’è‰²å’Œ<code>Consumer</code>è§’è‰²</p><blockquote><p>Runnableçš„æ„ä¹‰</p></blockquote><p>Runnableå¯¹è±¡å¯ä»¥ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’ï¼Œå¯ä»¥æ”¾å…¥é˜Ÿåˆ—ï¼Œå¯ä»¥è·¨è¶Šç½‘ç»œä¼ é€’ï¼Œä¹Ÿå¯ä»¥è¢«ä¿å­˜è‡³æ–‡ä»¶ä¸­ã€‚æ•…è€Œæˆ‘ä»¬å¯ä»¥å°†å…¶çœ‹ä½œ<code>Command</code>æ¨¡å¼ä¸‹çš„<code>Command</code>è§’è‰²</p><p><strong>!è¯¾åä¹ é¢˜8-5ã€8-6</strong></p><br/><h3 id="IX-Future"><a href="#IX-Future" class="headerlink" title="IX.Future"></a>IX.Future</h3><p><code>Thread-Per-Message</code>å°†è€—è´¹æ—¶é—´çš„å¤„ç†äº¤ç»™å…¶ä»–çº¿ç¨‹ï¼Œå¯æé«˜å“åº”æ€§ã€‚ä½†æ˜¯åœ¨å°†å¤„ç†è½¬äº¤å‡ºå»çš„æ—¶å€™ï¼Œå¤„ç†ç»“æœä»ç„¶æœªçŸ¥ï¼Œè€Œç­‰å¾…å¤„ç†ç»“æœçš„è¯ç¨‹åºå“åº”æ€§ä¼šé™ä½</p><p><code>Future</code>æ„ä¹‰ä¾¿åœ¨äºï¼Œå¯ä»¥**åœ¨ä¸ç”¨é™ä½å“åº”æ€§çš„å‰æä¸‹è·å–ç»“æœï¼Œ**åšåˆ°â€œå‡†å¤‡è¿”å›å€¼â€å’Œâ€œä½¿ç”¨è¿”å›å€¼â€ç›¸åˆ†ç¦»</p><blockquote><p>Futureè§’è‰²çš„å˜ç§</p></blockquote><ul><li><strong>ä¸è®©ä¸»çº¿ç¨‹ä¹…ç­‰</strong>ã€‚è‹¥<code>RealData</code>çš„å®ä¾‹è¿˜æœªå‡†å¤‡å¥½ï¼Œä¸»çº¿ç¨‹è°ƒç”¨<code>getContent</code>æ–¹æ³•æ—¶ä¼šè¿›è¡Œç­‰å¾…(<code>Guarded Suspension</code>)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Balking</code>ï¼Œç„¶åç¨å¾®æ‰§è¡Œäº›å…¶ä»–æ“ä½œå†å»è°ƒç”¨<code>getContent</code></li><li>**ä¼šå‘ç”Ÿå˜åŒ–ã€‚**é€šå¸¸æƒ…å†µä¸‹ï¼Œâ€œè¿”å›å€¼â€ä»…ä¼šè¢«è®¾ç½®åˆ°Futureè§’è‰²ä¸­ä¸€æ¬¡ï¼Œå³Futureè§’è‰²çš„çŠ¶æ€åªä¼šæ”¹å˜ä¸€æ¬¡ã€‚ä½†æœ‰æ—¶ä¹Ÿä¼šæœ‰ç»™Futureè§’è‰²è®¾ç½®â€œå½“å‰è¿”å›å€¼â€çš„éœ€æ±‚ï¼Œè¿™æ˜¯æˆ‘ä»¬å¯ä»¥è€ƒè™‘åå¤è®¾ç½®â€œè¿”å›å€¼â€ã€‚</li></ul><blockquote><p>JUC-Futureï¼ˆä»£ç è§VScodeï¼‰</p></blockquote><p><img src="/Blog/img/ae6fd5b57d3126d5e5cc12aaa63267f1.png" alt="screen-capture"></p><br/><h3 id="X-Two-Phase-Termination"><a href="#X-Two-Phase-Termination" class="headerlink" title="X.Two-Phase Termination"></a>X.Two-Phase Termination</h3><p>è¯¥æ¨¡å¼å¯ä»¥åšåˆ°â€ä¼˜é›…åœ°ç»“æŸçº¿ç¨‹â€ï¼Œå…¶è¦ç‚¹åœ¨äºï¼šå®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹**ï¼ˆå®‰å…¨æ€§ï¼‰<strong>ã€å¿…å®šè¿›è¡Œç»ˆæ­¢å¤„ç†</strong>ï¼ˆç”Ÿå­˜æ€§ï¼‰<strong>ã€å‘å‡ºç»ˆæ­¢è¯·æ±‚åå°½å¿«æ‰§è¡Œç»ˆæ­¢å¤„ç†</strong>ï¼ˆå“åº”æ€§ï¼‰**</p><blockquote><p>ç»ˆæ­¢å¤„ç†</p></blockquote><ul><li><p>æœªæ•è·çš„å¼‚å¸¸å¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Thread.setDefaultUncaughtExceptionHandler(</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Thread</span>.UncaughtExceptionHandler()&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uncaughtException</span><span class="params">(Thread thread, Throwable e)</span>&#123;</span><br><span class="line">      <span class="comment">//æ‰§è¡Œæœªæ•è·å¼‚å¸¸çš„å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></li><li><p>é€€å‡ºé’©å­</p><p><strong>æŒ‡javaè™šæ‹Ÿæœºé€€å‡ºæ—¶å¯åŠ¨çš„çº¿ç¨‹ï¼Œä½¿ç”¨å…¶æ¥ç¼–å†™ç¨‹åºå®Œå…¨ç»ˆæ­¢æ—¶çš„ç»ˆæ­¢å¤„ç†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Runtime.getRuntime().addShutdownHook(</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="comment">//ç»ˆæ­¢å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>JUC-CountDownLatch</p></blockquote><p>å®ç°â€ç­‰å¾…<strong>æŒ‡å®šæ¬¡æ•°</strong>çš„<code>CountDown</code>æ–¹æ³•è¢«è°ƒç”¨â€è¿™ä¸€åŠŸèƒ½</p><blockquote><p>JUC-CyclicBarrier</p></blockquote><p><code>CountDownLatch</code>åªèƒ½è¿›è¡Œå€’æ•°è®¡æ•°ï¼Œè€Œ<code>CyclicBarrier</code>å¯ä»¥<strong>å‘¨æœŸæ€§</strong>çš„åˆ›å»ºå±éšœï¼Œç¢°åˆ°å±éšœçš„çº¿ç¨‹æ˜¯æ— æ³•ç»§ç»­å‰è¿›çš„ã€‚å±éšœçš„è§£é™¤æ¡ä»¶æ˜¯**åˆ°è¾¾å±éšœå¤„çš„çº¿ç¨‹ä¸ªæ•°è¾¾åˆ°äº†æŒ‡å®šä¸ªæ•°ï¼Œ**è¿™æ ·å±éšœè§£é™¤ï¼Œè¿™ç°‡çº¿ç¨‹ä¾¿ä¼šä¸€èµ·â€œå†²å‡ºå»â€</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> JUC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023è¿™ä¸€å¹´</title>
      <link href="/Blog/2023/12/28/2023-zhe-yi-nian/"/>
      <url>/Blog/2023/12/28/2023-zhe-yi-nian/</url>
      
        <content type="html"><![CDATA[<p>è¥¿å®‰å…¥å†¬åçš„ç¬¬ä¸€åœºé›ªï¼Œæ­£å¥½è½åœ¨äº†æˆ‘çš„è¡Œæç®±ä¸Šã€‚</p><p>å†™ä¸‹è¿™ç¯‡éšç¬”çš„æ—¶å€™ï¼Œæˆ‘å·²ç»å’Œ7&#x2F;8çš„å¤§å­¦ç”Ÿæ´»æ‹œæ‹œäº†ï¼Œæ„Ÿè§‰æ—¶é—´æœç„¶è¿˜æ˜¯ä»¥äººä¸å¯é¢„çŸ¥çš„é€Ÿåº¦æµé€ç€ã€‚æœ¬æ¥è®¡åˆ’æŒ‰ç€åˆ«äººåšå®¢çš„æ ·å­ï¼Œåˆ†æ¨¡å—åšä¸ªå¹´åº¦æ€»ç»“å•¥çš„ï¼Œæƒ³äº†æƒ³ä¹Ÿç”­è´¹é‚£å·¥å¤«äº†ï¼Œç®€å•æ‰¯æ‰¯å§ã€‚</p><span id="more"></span><p>å¹´åˆçœ‹2023ï¼Œæ˜¯æ°´åˆ°æ¸ æˆçš„è¯ï¼Œç°åœ¨çœ‹2023å°±æ˜¯è‹¦å°½ç”˜æ¥äº†ã€‚æ–°æ˜¥ä¼Šå§‹ï¼Œå¹´å‘³æ­£æµ“ç€ï¼Œäººä¾¿èººå®¶é‡Œäº†ï¼šè¿‡æ•ï¼Œè¿˜æ˜¯æ¿€ç´ è¿‡æ•ï¼Œæ¿€ç´ è¿˜æ˜¯æŠ—è¿‡æ•æ¿€ç´ ã€‚</p><p>çªç„¶æƒ³åˆ°é«˜ä¸­è¿˜èƒŒè¿‡è¿‡æ•ååº”ï¼šå‘ä½œè¿…é€Ÿã€ååº”å¼ºçƒˆã€æ¶ˆé€€è¾ƒå¿«ã€‚é‚£å°±å¿«æŠ˜è…¾äº†æˆ‘ä¿©æœˆï¼Œæ¸…æ˜æ‰å»çš„å­¦æ ¡(å½“ç„¶å½»åº•å¥½å…¨é‚£æ˜¯æš‘å‡å‰äº†)ã€‚ä¸¥é‡é‚£ä¼šï¼Œå¤©å¤©æ„Ÿè§‰è‡ªå·±åœ¨å¿å—ç€ä»€ä¹ˆæå¤§çš„è‹¦éš¾ï¼Œç°åœ¨æ¥çœ‹è¿˜æŒºæœ‰æ„æ€çš„ï¼šåƒæˆ‘è¿™æ ·çš„äººï¼Œæ€»æ˜¯åœ¨é­å—ç—…ç—›çš„åŒæ—¶ï¼Œå¤¸å¤§å…¶å¨åŠ›ï¼Œå¯è¿™æ°æ°ä¸æ˜¯æ‚²è§‚ï¼Œåè€Œæ˜¯å› ä¸ºæœ‰ä¿¡å¿ƒèƒ½æŒºè¿‡è‹¦ç—›ï¼Œç­‰ä¸€åˆ‡ç»“æŸäº†ï¼Œä¾¿ä¼šæƒ³ï¼šè¿™ä¹ˆç³Ÿç³•çš„äº‹æƒ…æˆ‘éƒ½æŒºè¿‡å»äº†ï¼Œè¿˜çœŸäº†ä¸èµ·ã€‚</p><p>è¿·è¿·ç³Šç³Šåœ°å»äº†å­¦æ ¡ï¼Œæ‰“äº†ä¸¤åœºè“æ¡¥æ¯ï¼Œå‚åŠ äº†å¤§å­¦ç”Ÿè®¡ç®—æœºè®¾è®¡å¤§èµ›ï¼Œæ”¶æ‹¾æ”¶æ‹¾å°±æ”¾æš‘å‡äº†ã€‚</p><p>å‡æœŸä¹Ÿæ˜¯å…¨éƒ¨çŒ®ç»™äº†è€ƒç ”å¤ä¹ ï¼šæ•°ä¸€è‹±ä¸€ï¼Œä¸“ä¸šè¯¾ã€‚ä»æ²¡æƒ³è¿‡å‚åŠ å¤ä»¤è¥ï¼Œè™½ç„¶æˆ‘ä¹Ÿåœ¨ä¿ç ”è¾¹ç¼˜ï¼Œä½†æ˜¯æ˜¯è¾¹ç¼˜ä¹‹å¤–ï¼Œäºæ˜¯æš‘å‡ä¹Ÿå°±å˜çŸ­äº†äº›ã€‚</p><p>å†å›å­¦æ ¡ï¼Œè¾ˆåˆ†å·²ç»æ˜¯æœ€å¤§çš„é‚£ä¸€å±Šã€‚æ²¡æƒ³å¤ªå¤šä¾¿åˆæŠ•å…¥åˆ°å¤‡è€ƒä¸­å»ï¼Œé¡ºä¾¿æ‹¿äº†ä¸€ä¸ªå—ç†å·¥çš„é¢„æ¨å…åé¢ã€‚åæ¥å¾—çŸ¥ï¼ŒåŸæ¥ä»Šå¹´æœ¬ä¸“ä¸šçš„å¤–ä¿åé¢ï¼Œè‡ªå·±æ˜¯å ä¸€ä¸ªçš„ï¼Œé«˜å…´æ˜¯çœŸé«˜å…´ï¼Œåº†å¹¸ä¹Ÿæ˜¯çœŸåº†å¹¸ï¼šè¿˜å¥½å‚åŠ äº†å—ç†çš„ä¸æ¨å…ã€‚</p><p>æ”¾ä¸‹èº«ä¸Šçš„æ‹…å­ï¼Œç»ˆäºå¯ä»¥çœ‹çœ‹å‰æ–¹çš„æ™¯è‰²äº†ï¼›è¿‡å»å› è€ƒç ”æ”¾ä¸‹çš„å…´è¶£ï¼Œä¹Ÿå¯ä»¥æ‹¾èµ·æ¥äº†ã€‚ä½†å´å¹¶ä¸è§‰å¾—è½»æ¾ã€‚</p><p>æˆ‘ä¸çŸ¥é“è¯»äº†ç ”ç©¶ç”Ÿä»¥åï¼Œè¿˜èƒ½ä¸èƒ½å†é‡åˆ°è¿™ä¹ˆä¸€ä¸ªæ¬¢å¿«çš„å®¿èˆ</p><p>ä¸çŸ¥é“çœ‹ç€èº«è¾¹çš„æœ‹å‹åˆ†åˆ†åˆåˆï¼Œè‡ªå·±ä¹Ÿèƒ½ä¸èƒ½å‡ºæ¯ä¸€ç‚¹</p><p>ä¸çŸ¥é“èµ°å‡ºè±¡ç‰™å¡”ä¹‹åï¼Œè‡ªå·±ä¼šå˜æˆä»€ä¹ˆæ ·å­â€¦â€¦</p><p>ä¸æ˜¯ä»€ä¹ˆæ ·å­ç½¢ï¼Œä»å¤§ä¸€å¼€å§‹çš„æ²¡èƒ½å‚åŠ ç¤¾å›¢ï¼Œåˆ°ç°åœ¨çš„åªä¼šæ•²ç‚¹ä»£ç æ…°è—‰äººç”Ÿï¼Œæˆ‘æƒ³åº”è¯¥åšå‡ºç‚¹æ”¹å˜äº†ã€‚</p><p>2024ï¼Œçˆ·æ¥ä¹Ÿï¼</p>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2023 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaæ ¸å¿ƒæŠ€æœ¯I (Version.12)</title>
      <link href="/Blog/2023/10/07/java-he-xin-ji-zhu/"/>
      <url>/Blog/2023/10/07/java-he-xin-ji-zhu/</url>
      
        <content type="html"><![CDATA[<h3 id="IV-å¯¹è±¡ä¸ç±»"><a href="#IV-å¯¹è±¡ä¸ç±»" class="headerlink" title="IV. å¯¹è±¡ä¸ç±»"></a>IV. å¯¹è±¡ä¸ç±»</h3><ol><li><p><strong>è®°å½•</strong></p><p>è®°å½•æ˜¯ä¸€ç§ç‰¹æ®Šå½¢å¼çš„ç±»ï¼Œå…¶çŠ¶æ€ä¸å¯å˜ï¼Œè€Œä¸”å…¬å…±å¯è¯»ã€‚å¦‚æœéœ€è¦å®Œå…¨ç”±ä¸€ç»„å˜é‡è¡¨ç¤ºä¸å¯å˜æ•°æ®ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨è®°å½•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹å­—æ®µxã€yç§°ä¸ºç»„ä»¶</span></span><br><span class="line"><span class="keyword">record</span> <span class="title class_">Point</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span>&#123;</span><br><span class="line">  <span class="comment">//è¿™æ˜¯è‡ªå®šä¹‰æ„é€ å™¨</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Point</span><span class="params">()</span> &#123;<span class="built_in">this</span>(<span class="number">0</span>, <span class="number">0</span>)&#125;   </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//ã€è‡ªåŠ¨å®šä¹‰åœ°ã€‘è®¾ç½®æ‰€æœ‰å®ä¾‹å­—æ®µçš„æ„é€ å™¨ç§°ä¸ºæ ‡å‡†æ„é€ å™¨</span></span><br><span class="line">  <span class="comment">//æ ‡å‡†æ„é€ å™¨ä¹Ÿå¯ä»¥è¢«æä¾›</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Point</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è¿˜æœ‰ç®€æ´å½¢å¼ï¼Œä½†ç®€æ´å½¢å¼çš„ä¸»ä½“æ˜¯æ ‡å‡†æ„é€ å™¨çš„â€œå‰å¥â€</span></span><br><span class="line">  <span class="comment">//å®ƒåªæ˜¯åœ¨ä¸ºå®ä¾‹å­—æ®µèµ‹å€¼å‰ä¿®æ”¹å‚æ•°å˜é‡xã€y</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  *  public Point&#123;</span></span><br><span class="line"><span class="comment">  *     if(x &gt; y) y += x;</span></span><br><span class="line"><span class="comment">  *  &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><br/><h3 id="V-ç»§æ‰¿"><a href="#V-ç»§æ‰¿" class="headerlink" title="V.ç»§æ‰¿"></a>V.ç»§æ‰¿</h3><ol><li><p><strong>å®Œç¾equalsç¼–å†™</strong></p><ol><li>å°†æ˜¾å¼å‚æ•°å‘½åä¸ºotherObjectï¼Œ ç¨åéœ€è¦å°†å®ƒå¼ºè½¬ä¸ºother</li><li>æ£€æµ‹ this ä¸ otherObject æ˜¯å¦ç›¸åŒï¼ˆè¿™å¥åªæ˜¯ä¸€ä¸ªå°ä¼˜åŒ–ï¼‰</li><li>æ£€æµ‹ other0bject æ˜¯å¦ä¸ºnull, å¦‚æœä¸º null, åˆ™è¿”å› false</li><li>æ¯”è¾ƒ this ä¸ otherObject çš„ç±»ã€‚å¦‚æœ <strong>equalsçš„è¯­ä¹‰å¯ä»¥åœ¨å­ç±»ä¸­æ”¹å˜</strong>, å°±ä½¿ç”¨<code>getClass</code>æ£€æµ‹ï¼›å¦‚æœ<strong>æ‰€æœ‰çš„å­ç±»éƒ½æœ‰ç›¸åŒçš„ç›¸ç­‰æ€§è¯­ä¹‰</strong>ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>instanceof</code>æ£€æµ‹</li><li>ç°åœ¨æ ¹æ®ç›¸ç­‰æ€§æ¦‚å¿µçš„è¦æ±‚æ¥æ¯”è¾ƒå­—æ®µã€‚ä½¿ç”¨<code>==</code>æ¯”è¾ƒåŸºæœ¬ç±»å‹å­—æ®µï¼Œä½¿ç”¨<code>Objects.equals()</code> æ¯”è¾ƒå¯¹è±¡å­—æ®µã€‚å¦‚æœæ‰€æœ‰çš„å­—æ®µéƒ½åŒ¹é…, å°±è¿”å› trueã€‚å­ç±»å¦‚æœé‡æ–°å®šä¹‰äº†<code>equals</code>ï¼Œå°±è¦åŒ…å«ä¸€ä¸ª<code>super.equal(other)</code>è°ƒç”¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object otherObject)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span> == otherObject) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(otherObject == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* equals å­ç±»è¯­ä¹‰æœ‰æ”¹å˜</span></span><br><span class="line"><span class="comment">    * if(getClass() != otherObject.getClass()) return false;</span></span><br><span class="line"><span class="comment">    * ClassName other = (ClassName) otherObject;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">/* equals å­ç±»è¯­ä¹‰å‡ä¸€è‡´</span></span><br><span class="line"><span class="comment">    * if(!(otherObject instanceof ClassName other)) return false;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> filed1 == other.filed1</span><br><span class="line">      &amp;&amp; Object.equals(filed2, other.filed2)</span><br><span class="line">      &amp;&amp;...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>super</code>ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œåªæ˜¯ä¸€ä¸ªæŒ‡ç¤ºç¼–è¯‘å™¨è°ƒç”¨è¶…ç±»æ–¹æ³•çš„ç‰¹æ®Šå…³é”®å­—</p></li><li><p>é‡å†™çš„æ–¹æ³•ï¼Œæ–¹æ³•ç­¾åï¼ˆæŒ‡ä¸€ä¸ª<strong>æ–¹æ³•çš„åç§°å’Œå‚æ•°åˆ—è¡¨</strong>ï¼‰å¿…é¡»ä¸€æ ·ï¼Œè€Œè¿”å›ç±»å‹åªéœ€è¦<strong>æ›´ä¸¥æ ¼</strong>å°±è¡Œï¼ˆç§°ä¸ºæœ‰<strong>åå˜</strong>çš„è¿”å›ç±»å‹ï¼‰ï¼Œæ–¹æ³•å¯è§æ€§éœ€è¦æ›´å®½æ¾ã€‚</p></li><li><p><code>protected</code>ç±»å‹ï¼ŒåŒåŒ…å’Œå­ç±»å¯è®¿é—®ã€‚ä½†æ˜¯è€ƒè™‘ä¸‹é¢è¿™ç§æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fa</span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">fun</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Son1</span> <span class="keyword">extends</span> <span class="title class_">Fa</span>&#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Son2åœ¨å¦ä¸€ä¸ªåŒ…ä¸­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son2</span> <span class="keyword">extends</span> <span class="title class_">Fa</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//ok</span></span><br><span class="line">    fun()</span><br><span class="line">    <span class="comment">//error: The method fun() from the type Fa is not visible</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Son1</span>().fun();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åŸå› å°±åœ¨äºï¼ŒSon1ä¸­çš„funæ–¹æ³•æ˜¯ä»Faä¸­ç»§æ‰¿çš„ï¼Œã€å…¶å¯è§æ€§æ˜¯å¯¹äºSon1è€Œè¨€çš„ã€‘</span></span><br><span class="line"><span class="comment">//åªå¯¹Son1åŒåŒ…æˆ–è€…Son1çš„å­ç±»å¯è§ï¼ŒSon2ä¸­è‡ªç„¶ä¸å¯è§</span></span><br></pre></td></tr></table></figure></li></ol><br/><h3 id="VI-æ¥å£ã€lambdaä¸å†…éƒ¨ç±»"><a href="#VI-æ¥å£ã€lambdaä¸å†…éƒ¨ç±»" class="headerlink" title="VI. æ¥å£ã€lambdaä¸å†…éƒ¨ç±»"></a>VI. æ¥å£ã€lambdaä¸å†…éƒ¨ç±»</h3><ol><li><p>å¯¹äº<strong>åŒ¿åç±»</strong>ï¼Œä»¥ä¸‹æµ‹è¯•ä¼šå¤±è´¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//equals</span></span><br><span class="line"><span class="keyword">if</span>(getClass() != other.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å› ä¸ºæ¯ä¸ªåŒ¿åç±»ç±»å‹ï¼šå¤–éƒ¨ç±»ç±»å$1ã€å¤–éƒ¨ç±»ç±»å$2ã€...</span></span><br></pre></td></tr></table></figure></li><li><p>å¦‚ä½•åœ¨é™æ€æ–¹æ³•ä¸­è·å–è°ƒç”¨é™æ€æ–¹æ³•çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.getClass();    <span class="comment">//Error, é™æ€æ–¹æ³•ä¸­æ²¡æœ‰this</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Object</span>()&#123;&#125;.getClass.getEnclosingClass()   <span class="comment">//Success</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Java9åï¼Œæ¥å£ä¸­çš„æ–¹æ³•å¯ä»¥æ˜¯<code>private</code>ï¼Œä½†åªèƒ½ç”¨åšå…¶ä»–æ–¹æ³•çš„è¾…åŠ©</p></li><li><p>Objectä¸­å®šä¹‰äº†<code>protected Object clone()&#123;...&#125;</code>ï¼Œå¦‚æœä»»ä½•ç±»æƒ³è¦å®ç°å…‹éš†è‡ªå·±ï¼Œé‚£ä¹ˆåº”è¯¥åœ¨ç±»ä¸­é‡å†™è¿™ä¸ªæ–¹æ³•<code>public ClassName clone()&#123;...&#125;</code>ï¼ˆè®°å¾—<code>Cloneable</code>ï¼‰ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œåœ¨å…¶ä»–ç±»ä¸­ä¾¿å¯ä»¥è°ƒç”¨è¿™ä¸ªç±»çš„<code>clone</code>æ–¹æ³•è·å–å…¶å…‹éš†å¯¹è±¡ï¼Œå¦åˆ™è°ƒç”¨<code>clone</code>æ˜¯ä¸å¯è§çš„ï¼Œè¯¦è§ V.4</p></li></ol><br/><h3 id="VII-å¼‚å¸¸ã€æ–­è¨€å’Œæ—¥å¿—"><a href="#VII-å¼‚å¸¸ã€æ–­è¨€å’Œæ—¥å¿—" class="headerlink" title="VII.å¼‚å¸¸ã€æ–­è¨€å’Œæ—¥å¿—"></a>VII.å¼‚å¸¸ã€æ–­è¨€å’Œæ—¥å¿—</h3><ol><li><p>ä¸€ä¸ªæ–¹æ³•å¿…é¡»å£°æ˜æ‰€æœ‰å¯èƒ½æŠ›å‡ºçš„<strong>æ£€æŸ¥å‹å¼‚å¸¸</strong>ï¼Œè€Œ<strong>éæ£€æŸ¥å‹å¼‚å¸¸</strong>è¦ä¹ˆåœ¨ä½ çš„æ§åˆ¶ä¹‹å¤–(Errorï¼Œjvmå±‚é¢çš„é”™è¯¯)ï¼Œè¦ä¹ˆä»ä¸€å¼€å§‹å°±åº”è¯¥é¿å…ï¼ˆRuntimeExceptionï¼‰</p></li><li><p>å¼‚å¸¸ä½¿ç”¨æŠ€å·§ï¼š</p><ol><li><strong>æ—©æŠ›å‡ºï¼Œæ™šæ•è·</strong>ã€‚ä¾‹å¦‚ï¼Œå½“æ ˆä¸ºç©ºæ—¶ï¼Œ<code>Stack.pop</code>æ˜¯è¯¥è¿”å›<code>null</code>ï¼Œè¿˜æ˜¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Ÿè‘—è€…è®¤ä¸ºæ˜¯åè€…ï¼Œå› ä¸ºè¿™è¦å¥½äºä»¥åå‡ºç°ä¸€ä¸ª<code>NullPointerException</code>å¼‚å¸¸</li><li><strong>ä½¿ç”¨æ ‡å‡†åŒ–æ–¹å¼æŠ¥å‘Šå¼‚å¸¸</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Objects::</span><br><span class="line">  requireNonNull</span><br><span class="line">  checkIndex</span><br><span class="line">  checkFromIndex</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></li></ol></li><li><p><strong>æ–­è¨€å¤±è´¥</strong>æ˜¯è‡´å‘½çš„ã€ä¸å¯æ¢å¤çš„é”™è¯¯ï¼›ä¸è¦æ•è·æ–­è¨€å¼‚å¸¸ï¼Œæ–­è¨€æ˜¯ç”¨æ¥æµ‹è¯•è€Œä¸æ˜¯ä»ä¸­æ¢å¤ï¼Œåªé€‚ç”¨äºæµ‹è¯•å’Œå¼€å‘ç¯å¢ƒï¼›</p><p>ç§è®¤ä¸ºï¼Œå¯ä»¥ç±»æ¯”äºç”¨<code>printf</code>è¿›è¡Œè°ƒå¼</p></li></ol><br/><h3 id="VIII-æ³›å‹ç¨‹åºè®¾è®¡"><a href="#VIII-æ³›å‹ç¨‹åºè®¾è®¡" class="headerlink" title="VIII.æ³›å‹ç¨‹åºè®¾è®¡"></a>VIII.æ³›å‹ç¨‹åºè®¾è®¡</h3><ol><li><p><strong>PESCåŸåˆ™ï¼š</strong>ï¼ˆå°†æ³›å‹å®¹å™¨çœ‹ä½œPæˆ–è€…Cï¼‰</p><ol><li>é¢‘ç¹å¾€å¤–è¯»å–å†…å®¹çš„ï¼Œé€‚åˆç”¨ä¸Šç•Œ<code>Extends</code></li><li>ç»å¸¸å¾€é‡Œæ’å…¥çš„ï¼Œé€‚åˆç”¨ä¸‹ç•Œ<code>Super</code></li></ol><p>ä¸ºä½•ä¼šå‡ºç°<strong>é€šé…ç¬¦ç±»å‹ï¼š<strong>å‡å®šæœ‰<code>Fruit</code>ç±»å’Œ<code>Apple</code>ç±»ï¼ŒäºŒè€…æœ‰ç»§æ‰¿å…³ç³»ï¼Œç„¶åæœ‰ä¸€ä¸ªç®€å•çš„æ³›å‹å®¹å™¨<code>Plate&lt;T&gt;</code>ï¼Œä»£è¡¨è£…â€¦çš„ç›˜å­ã€‚é—®é¢˜æ¥äº†ï¼š<code>Plate&lt;Fruit&gt;</code>å’Œ<code>Plate&lt;Apple&gt;</code>æ²¡æœ‰ä»»ä½•ç»§æ‰¿å…³ç³»</strong>ï¼ˆå³æ³›å‹æ²¡æœ‰åå˜æ€§ï¼‰</strong>ï¼Œ æ‰€ä»¥ä¸‹è¿°è¯­å¥è™½ç„¶é€»è¾‘ä¸Šæœ‰ç†ï¼Œä½†Javaç¼–è¯‘å™¨ä¸é€šè¿‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plate&lt;Fruit&gt; p= <span class="keyword">new</span> <span class="title class_">Plate</span>&lt;Apple&gt;(<span class="keyword">new</span> <span class="title class_">Apple</span>());</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®©æ³›å‹å®¹å™¨ä¹‹é—´äº§ç”Ÿè”ç³»ï¼Œä¾¿æœ‰äº†ä¸Šç•Œé€šé…ç¬¦<code>&lt;? extends T&gt;</code>å’Œä¸‹ç•Œé€šé…ç¬¦<code>&lt;? super T&gt;</code>ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œ<code>&lt;? extends Fruit&gt;</code>çš„å­ç±»å‹æœ‰<code>&lt;Apple&gt;ã€&lt;Orange&gt;â€¦</code>ï¼Œ <code>&lt;? super Apple&gt;</code>çš„å­ç±»å‹æœ‰<code>&lt;Fruit&gt;ã€&lt;Object&gt;â€¦</code></p></li><li><p><strong>è™šæ‹Ÿæœºä¸­çš„æ³›å‹æ“¦é™¤</strong>ï¼š</p><ol><li><p>è™šæ‹Ÿæœºä¸­æ²¡æœ‰æ³›å‹ï¼Œåªæœ‰æ™®é€šçš„ç±»å’Œæ–¹æ³•</p></li><li><p>æ‰€æœ‰ç±»å‹å‚æ•°éƒ½ä¼šæ›¿æ¢ä¸ºå®ƒä»¬çš„<strong>é™å®šç±»å‹</strong><code>(e.g. T -&gt; Object, U extends Comparable&amp;Runnable -&gt; Comparableï¼Œå¿…è¦æ—¶æ·»åŠ Runnableå¼ºè½¬)</code></p></li><li><p>ä¼š<strong>åˆæˆæ¡¥æ–¹æ³•</strong>æ¥ä¿æŒå¤šæ€</p><p>åœ¨Javaä»£ç ä¸­ï¼Œæ–¹æ³•åç§°å’Œå‚æ•°ç±»å‹æŒ‡å®šä¸€ä¸ªæ–¹æ³•ï¼›è€Œåœ¨<strong>è™šæ‹Ÿæœº</strong>ä¸­ï¼Œ<strong>æ–¹æ³•åç§°</strong>ã€<strong>å‚æ•°ç±»å‹</strong>å’Œ<strong>è¿”å›å€¼</strong>å…±åŒæŒ‡å®šä¸€ä¸ªæ–¹æ³•ã€‚æ•…è€Œæ¡¥æ–¹æ³•å¯ä»¥åˆç†å­˜åœ¨ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&lt;T&gt;&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fun</span><span class="params">(T args1)</span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span>&lt;LocalDate&gt;&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fun</span><span class="params">(LocalDate args1)</span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä¸Šè¿°ä»£ç ç›®çš„æ˜¯é‡å†™funï¼Œä½†ç±»å‹æ“¦é™¤åBä¸­ä¼šæœ‰è¿™ä¿©fun</span></span><br><span class="line"><span class="comment">* public void fun(Object args1)</span></span><br><span class="line"><span class="comment">* public void fun(LoaclDate args1)</span></span><br><span class="line"><span class="comment">* ä¸¤ä¸ªæ–¹æ³•æ˜¾ç„¶ä¸ä¸€æ ·ï¼Œä½†é€»è¾‘ä¸Šåº”è¯¥ä¸€æ ·ï¼Œä»è€Œä¿è¯å¤šæ€</span></span><br><span class="line"><span class="comment">* å› æ­¤ç¼–è¯‘å™¨åœ¨Bä¸­åˆæˆä¸€ä¸ªæ¡¥æ–¹æ³•ï¼Œè¿™æ‰æ˜¯çœŸæ­£é‡å†™funçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">* public void fun(Object args1)&#123;fun((LoaclDate)args1)&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¡¥æ–¹æ³•ä¸åªç”¨äºæ³›å‹ç±»å‹ï¼Œè¿˜å‡ºç°åœ¨æ–¹æ³•é‡å†™</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Employee <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*å®é™…ä¸Šï¼ŒEmployeeæœ‰ä¿©cloneæ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">* Employee clone()    è‡ªå·±å®šä¹‰çš„</span></span><br><span class="line"><span class="comment">* Object clone()      åˆæˆçš„æ¡¥æ–¹æ³•ï¼Œè¦†ç›–äº†Object.clone</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸ºä¿æŒç±»å‹å®‰å…¨æ€§ï¼Œå¿…è¦æ—¶ä¼šæ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢</p></li></ol></li></ol><br/><h3 id="IX-é›†åˆ"><a href="#IX-é›†åˆ" class="headerlink" title="IX.é›†åˆ"></a>IX.é›†åˆ</h3><ol><li><p><code>Iterator</code>è¿­ä»£å™¨ï¼Œä¸è¦æƒ³ç€è¿­ä»£å™¨æŒ‡å‘æŸä¸ªå…ƒç´ ï¼Œè€Œåº”è¯¥è®¤ä¸ºè¿­ä»£å™¨ä½äºä¸¤ä¸ªå…ƒç´ ä¸­é—´ï¼Œå½“è°ƒç”¨<code>next</code>æ—¶ï¼Œè¿­ä»£å™¨å°±ä¼š<strong>è¶Šè¿‡</strong>ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›åˆšåˆšè¶Šè¿‡çš„é‚£ä¸ªå…ƒç´ </p><img src="/Blog/img/d5605913432ca6c83ef602e065f2ed64.jpg" alt="iterator.jpg" style="zoom:10%;" /></li><li><p>åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé›†åˆè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œè¿­ä»£å¤±æ•ˆï¼ŒæŠ›å‡º<code>ConcurrentModificationException</code>å¼‚å¸¸ï¼›ä½†<code>CopyOnWriteArrayList</code>å’Œ<code>CopyOnWriteArraySet</code>é™¤å¤–ï¼Œ<strong>å†™æ—¶æ‹·è´æ•°ç»„</strong>çš„è¿­ä»£å™¨åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå³ä½¿æ•°ç»„è¢«ä¿®æ”¹ä»ç„¶å¯ä»¥æ­£å¸¸è®¿é—®ï¼ˆä½†å¯èƒ½è¿‡æ—¶ï¼‰è§†å›¾ã€‚</p><br/></li></ol><h3 id="XII-å¹¶å‘"><a href="#XII-å¹¶å‘" class="headerlink" title="XII.å¹¶å‘"></a>XII.å¹¶å‘</h3><ol><li><p>javaçº¿ç¨‹æœ‰6ç§çŠ¶æ€ï¼š<code>New</code> <code>Runnable</code> <code>Blocked</code> <code>Waiting</code> <code>Timed waiting</code> <code>Terminated</code></p><img src="/Blog/img/a2ee154e13f7cb642148cfc548521932.jpg" alt="thread.jpg" style="zoom:10%;" /></li><li><p>é™¤äº†å·²ç»åºŸå¼ƒçš„<code>stop</code>æ–¹æ³•ï¼Œæ²¡æœ‰åŠæ³•å¼ºåˆ¶ä¸€ä¸ªçº¿ç¨‹ç»ˆæ­¢ï¼Œä½†å¯ä»¥ç”¨<code>interrupted</code>æ¥è¯·æ±‚ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é˜»å¡å’Œä¸­æ–­ç›¸é‡ï¼Œä¼šæŠ›å‡ºInterruptedException</span></span><br><span class="line">å®ä¾‹æ–¹æ³•isInterrupted è°ƒç”¨åä¸ä¼šæ”¹å˜ä¸­æ–­çŠ¶æ€ </span><br><span class="line">é™æ€æ–¹æ³•interrupted è°ƒç”¨åä¼šæ¸…é™¤ã€å½“å‰æ‰§è¡Œçº¿ç¨‹ã€‘çš„ä¸­æ–­çŠ¶æ€</span><br></pre></td></tr></table></figure></li><li><p>åŒæ­¥æ“ä½œï¼š</p><ol><li><p><strong>Lock&#x2F;Condition</strong></p></li><li><p><strong>synchronized</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç­‰åŒäºä½¿ç”¨è¯¥å¯¹è±¡çš„å†…éƒ¨é”</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è€Œwaitã€notifyAll/notifyç­‰åŒäºä½¿ç”¨å†…éƒ¨é”å…³è”çš„æ¡ä»¶å¯¹è±¡</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„é”æ¥å®ç°é¢å¤–çš„åŸå­æ“ä½œï¼Œç§°ä¸ºå®¢æˆ·ç«¯é”å®š</span></span><br><span class="line"><span class="comment">//ä½†è¿™æ ·å®Œå…¨ä¾èµ–äºï¼šVectorç±»ä¼šå¯¹è‡ªå·±çš„æ‰€æœ‰æ›´æ”¹å™¨æ–¹æ³•ä½¿ç”¨å†…éƒ¨é”</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">(Vector&lt;Integer&gt; vInt, ...)</span>&#123;</span><br><span class="line">    <span class="comment">//åŒæ­¥å—</span></span><br><span class="line">    synchronsized(vInt)&#123;</span><br><span class="line">        vInt.set(...);</span><br><span class="line">        vInt.set(...);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>volatileå­—æ®µ</strong></p><p>é€‚ç”¨äºå…±äº«å˜é‡åªå­˜åœ¨<strong>èµ‹å€¼æ“ä½œ</strong>ï¼Œä¸ä¼šè¿›è¡Œå…¶ä»–æ“ä½œ</p></li><li><p><strong>çº¿ç¨‹å®‰å…¨çš„é›†åˆ</strong></p><p>é˜»å¡é˜Ÿåˆ—ã€å¹¶å‘æ•£åˆ—æ˜ å°„ã€å¹¶å‘é›†ã€å†™æ—¶æ‹·è´æ•°ç»„ã€ä½¿ç”¨åŒæ­¥åŒ…è£…å™¨</p></li></ol></li></ol>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€çŸ¥è¯† </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
